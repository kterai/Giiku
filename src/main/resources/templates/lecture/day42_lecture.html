<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day42: RDBの基礎・PostgreSQL・データベース設計</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        .quiz-answer { display: none; }
        .exercise-answer { display: none; }
        pre code { background: #1e1e1e; color: #d4d4d4; }
        .sql-highlight { background: #f0f9ff; border-left: 4px solid #0ea5e9; padding: 1rem; }
        .fixed-nav {
            backdrop-filter: blur(10px);
            background-color: rgba(255, 255, 255, 0.95);
        }
        .nav-link:hover {
            background-color: rgba(59, 130, 246, 0.1);
        }
        .breadcrumb-separator::after {
            content: ">";
            margin: 0 8px;
            color: #9CA3AF;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 leading-relaxed">
    <nav class="fixed top-0 left-0 right-0 z-50 fixed-nav border-b border-gray-200">
        <div class="bg-blue-600 text-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-12">
                    <div class="flex items-center">
                        <i class="fas fa-graduation-cap mr-2"></i>
                        <span class="font-semibold">ITエンジニア育成カリキュラム</span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <a href="./day41_lecture.html" class="nav-link px-3 py-1 rounded text-sm hover:bg-blue-700 transition-colors">
                            <i class="fas fa-chevron-left mr-1"></i> 前の講義
                        </a>
                        <a href="./day43_lecture.html" class="nav-link px-3 py-1 rounded text-sm hover:bg-blue-700 transition-colors">
                            次の講義 <i class="fas fa-chevron-right ml-1"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="bg-white px-4 py-3">
            <div class="max-w-7xl mx-auto">
                <div class="flex items-center justify-between">
                    <div class="flex items-center text-sm text-gray-600">
                        <a href="../../index.html" class="hover:text-blue-600"><i class="fas fa-home mr-1"></i>ホーム</a>
                        <span class="breadcrumb-separator"></span>
                        <a href="../month/month3.html" class="hover:text-blue-600">3ヶ月目: Webアプリケーション開発実践</a>
                        <span class="breadcrumb-separator"></span>
                        <a href="../week/week10.html" class="hover:text-blue-600">10週目: バックエンド基礎</a>
                        <span class="breadcrumb-separator"></span>
                        <span class="font-semibold text-blue-600">42日目: RDBの基礎・PostgreSQL・データベース設計</span>
                    </div>
                    <div class="flex items-center space-x-3">
                        <a href="../day/day42.html" class="inline-flex items-center px-3 py-1 border border-blue-300 rounded-md text-sm text-blue-600 hover:bg-blue-50 transition-colors">
                            <i class="fas fa-clipboard-list mr-1"></i> 本日の概要
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    <main class="pt-32">
    <div class="container mx-auto px-4 py-8 max-w-5xl">
        <!-- ヘッダー -->
        <header class="bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg p-8 mb-8 shadow-lg">
            <div class="flex items-center mb-6">
                <i class="fas fa-database text-4xl mr-6 text-blue-200"></i>
                <div>
                    <h1 class="text-3xl font-bold mb-2">Day42: RDBの基礎・PostgreSQL・データベース設計</h1>
                    <p class="text-xl text-blue-100">関係データベースの基礎理論から実践的なPostgreSQL操作まで</p>
                </div>
            </div>
            <div class="bg-white bg-opacity-20 rounded-lg p-4">
                <h2 class="text-lg font-semibold mb-2">🎯 ITエンジニア育成カリキュラム</h2>
                <p class="text-blue-100">実用的なデータベース技術を習得し、現場で通用するSQL操作とDB設計スキルを身につける</p>
            </div>
        </header>

        <!-- 学習目標 -->
        <section class="bg-white rounded-lg shadow-lg p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-target text-blue-600 mr-3"></i>本日の学習目標
            </h2>
            <div class="grid md:grid-cols-2 gap-6">
                <div class="space-y-4">
                    <div class="flex items-start">
                        <i class="fas fa-check-circle text-green-500 mr-3 mt-1"></i>
                        <div>
                            <h3 class="font-semibold text-lg mb-2">関係データベースの基本概念を実践レベルで理解</h3>
                            <p class="text-gray-600">RDBMS、ACID特性、正規化の重要性を具体例とともに習得</p>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <i class="fas fa-check-circle text-green-500 mr-3 mt-1"></i>
                        <div>
                            <h3 class="font-semibold text-lg mb-2">PostgreSQLの環境構築と基本操作をマスター</h3>
                            <p class="text-gray-600">インストールからpgAdmin操作、SQL実行まで完全理解</p>
                        </div>
                    </div>
                </div>
                <div class="space-y-4">
                    <div class="flex items-start">
                        <i class="fas fa-check-circle text-green-500 mr-3 mt-1"></i>
                        <div>
                            <h3 class="font-semibold text-lg mb-2">データベース設計の基本原則を習得</h3>
                            <p class="text-gray-600">正規化プロセス、ER図作成、制約設計を実践的に学習</p>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <i class="fas fa-check-circle text-green-500 mr-3 mt-1"></i>
                        <div>
                            <h3 class="font-semibold text-lg mb-2">テーブル作成とCRUD操作を実装</h3>
                            <p class="text-gray-600">実際のプロジェクトでSQL文を作成し、データ操作を完全習得</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 推奨開発環境 -->
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-6 mb-8">
            <h3 class="text-lg font-bold text-blue-800 mb-4">
                <i class="fas fa-tools mr-2"></i>推奨開発環境
            </h3>
            <div class="grid md:grid-cols-3 gap-4">
                <div class="bg-white p-4 rounded-lg">
                    <h4 class="font-semibold mb-2">データベース</h4>
                    <p class="text-sm">PostgreSQL 14+ + pgAdmin 6</p>
                </div>
                <div class="bg-white p-4 rounded-lg">
                    <h4 class="font-semibold mb-2">エディタ</h4>
                    <p class="text-sm">Visual Studio Code + PostgreSQL拡張</p>
                </div>
                <div class="bg-white p-4 rounded-lg">
                    <h4 class="font-semibold mb-2">CLI</h4>
                    <p class="text-sm">psql（PostgreSQLコマンドライン）</p>
                </div>
            </div>
        </div>

        <!-- 1. 関係データベースの完全理解 -->
        <section class="bg-white rounded-lg shadow-lg p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-sitemap text-purple-600 mr-3"></i>1. 関係データベースの完全理解
            </h2>
            
            <!-- RDBMSとは -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold mb-4 text-blue-700">RDBMSの基本概念</h3>
                <div class="bg-blue-50 p-6 rounded-lg mb-4">
                    <p class="text-gray-800 mb-4"><strong>RDBMS（Relational Database Management System - リレーショナルデータベース管理システム）</strong>とは、データを表（テーブル）の形で管理し、表同士の関係性を定義することでデータを効率的に格納・検索できるシステムです。</p>
                    <p class="text-gray-700">まるで図書館の分類システムのように、データを整理して関連付けることで、複雑な情報も素早く見つけることができます。</p>
                </div>
                
                <!-- RDBMS vs NoSQL比較表 -->
                <div class="overflow-x-auto mb-6">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="border border-gray-300 px-4 py-3 text-left">項目</th>
                                <th class="border border-gray-300 px-4 py-3 text-left">RDBMS（PostgreSQL）</th>
                                <th class="border border-gray-300 px-4 py-3 text-left">NoSQL（MongoDB）</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="border border-gray-300 px-4 py-3 font-semibold">データ構造</td>
                                <td class="border border-gray-300 px-4 py-3">テーブル（行・列）</td>
                                <td class="border border-gray-300 px-4 py-3">ドキュメント（JSON形式）</td>
                            </tr>
                            <tr class="bg-gray-50">
                                <td class="border border-gray-300 px-4 py-3 font-semibold">スキーマ</td>
                                <td class="border border-gray-300 px-4 py-3">厳密（事前定義必須）</td>
                                <td class="border border-gray-300 px-4 py-3">柔軟（動的変更可能）</td>
                            </tr>
                            <tr>
                                <td class="border border-gray-300 px-4 py-3 font-semibold">データ整合性</td>
                                <td class="border border-gray-300 px-4 py-3">ACID特性で厳密保証</td>
                                <td class="border border-gray-300 px-4 py-3">結果整合性</td>
                            </tr>
                            <tr class="bg-gray-50">
                                <td class="border border-gray-300 px-4 py-3 font-semibold">適用場面</td>
                                <td class="border border-gray-300 px-4 py-3">金融システム、ECサイト</td>
                                <td class="border border-gray-300 px-4 py-3">ログ収集、リアルタイム分析</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ACID特性 -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold mb-4 text-green-700">ACID特性の実践的重要性</h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-green-50 p-6 rounded-lg">
                        <h4 class="font-semibold text-green-800 mb-3">
                            <i class="fas fa-atom mr-2"></i>Atomicity（原子性）
                        </h4>
                        <p class="text-sm mb-2"><strong>意味：</strong>取引は全て成功するか、全て失敗するかのどちらか</p>
                        <p class="text-sm text-green-700"><strong>例：</strong>銀行振込で「A口座から引き落とし」と「B口座への入金」は必ずセットで実行</p>
                    </div>
                    <div class="bg-blue-50 p-6 rounded-lg">
                        <h4 class="font-semibold text-blue-800 mb-3">
                            <i class="fas fa-shield-alt mr-2"></i>Consistency（一貫性）
                        </h4>
                        <p class="text-sm mb-2"><strong>意味：</strong>データは常にルール（制約）を満たす</p>
                        <p class="text-sm text-blue-700"><strong>例：</strong>在庫数がマイナスになることは許可しない</p>
                    </div>
                    <div class="bg-yellow-50 p-6 rounded-lg">
                        <h4 class="font-semibold text-yellow-800 mb-3">
                            <i class="fas fa-user-lock mr-2"></i>Isolation（独立性）
                        </h4>
                        <p class="text-sm mb-2"><strong>意味：</strong>複数の処理が同時実行されても影響し合わない</p>
                        <p class="text-sm text-yellow-700"><strong>例：</strong>2人が同じ商品を同時購入しても、正しく在庫管理される</p>
                    </div>
                    <div class="bg-red-50 p-6 rounded-lg">
                        <h4 class="font-semibold text-red-800 mb-3">
                            <i class="fas fa-save mr-2"></i>Durability（持続性）
                        </h4>
                        <p class="text-sm mb-2"><strong>意味：</strong>完了した取引は永続的に保存される</p>
                        <p class="text-sm text-red-700"><strong>例：</strong>システム障害が起きても、確定した注文データは失われない</p>
                    </div>
                </div>
            </div>

            <!-- ER図の基礎 -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold mb-4 text-purple-700">エンティティ・リレーションシップ（ER）モデル</h3>
                <div class="bg-purple-50 p-6 rounded-lg mb-4">
                    <p class="text-gray-800 mb-4"><strong>ER図（Entity-Relationship Diagram）</strong>は、データベースの設計図のようなものです。現実世界の「もの」（エンティティ）とその「関係」（リレーションシップ）を視覚的に表現します。</p>
                </div>
                
                <div class="grid md:grid-cols-3 gap-4">
                    <div class="bg-white border-2 border-purple-200 p-4 rounded-lg">
                        <h4 class="font-semibold text-purple-800 mb-2">エンティティ（実体）</h4>
                        <p class="text-sm text-gray-600 mb-2">管理したい「もの」や「こと」</p>
                        <div class="text-sm space-y-1">
                            <p>• 顧客（Customer）</p>
                            <p>• 商品（Product）</p>
                            <p>• 注文（Order）</p>
                        </div>
                    </div>
                    <div class="bg-white border-2 border-green-200 p-4 rounded-lg">
                        <h4 class="font-semibold text-green-800 mb-2">属性（Attribute）</h4>
                        <p class="text-sm text-gray-600 mb-2">エンティティの特徴や性質</p>
                        <div class="text-sm space-y-1">
                            <p>• 顧客名、メールアドレス</p>
                            <p>• 商品名、価格</p>
                            <p>• 注文日、数量</p>
                        </div>
                    </div>
                    <div class="bg-white border-2 border-blue-200 p-4 rounded-lg">
                        <h4 class="font-semibold text-blue-800 mb-2">リレーションシップ（関係）</h4>
                        <p class="text-sm text-gray-600 mb-2">エンティティ間のつながり</p>
                        <div class="text-sm space-y-1">
                            <p>• 顧客が注文する</p>
                            <p>• 注文に商品が含まれる</p>
                            <p>• 1対多、多対多の関係</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 2. PostgreSQL環境構築と基本操作 -->
        <section class="bg-white rounded-lg shadow-lg p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-cogs text-green-600 mr-3"></i>2. PostgreSQL環境構築と基本操作
            </h2>

            <!-- インストール手順 -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold mb-4 text-blue-700">PostgreSQLのインストール</h3>
                
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                    <p class="text-yellow-800"><strong>PostgreSQL（ポストグレスキューエル）</strong>は、オープンソースの高性能なRDBMSです。世界中の企業で使われている信頼性の高いデータベースシステムです。</p>
                </div>

                <!-- OS別インストール -->
                <div class="space-y-6">
                    <div class="border border-gray-200 rounded-lg p-6">
                        <h4 class="font-semibold text-green-700 mb-4 flex items-center">
                            <i class="fab fa-windows mr-2"></i>Windows環境
                        </h4>
                        <ol class="space-y-2 text-sm">
                            <li><strong>1.</strong> PostgreSQL公式サイト（postgresql.org）からインストーラーをダウンロード</li>
                            <li><strong>2.</strong> インストーラーを実行し、以下を設定：
                                <ul class="ml-4 mt-2 space-y-1">
                                    <li>• インストール先：デフォルト（C:\Program Files\PostgreSQL\14）</li>
                                    <li>• ポート番号：5432（デフォルト）</li>
                                    <li>• 管理者パスワード：忘れないよう記録</li>
                                </ul>
                            </li>
                            <li><strong>3.</strong> pgAdmin 4も同時にインストールされることを確認</li>
                            <li><strong>4.</strong> インストール完了後、Windowsメニューから「pgAdmin 4」を起動</li>
                        </ol>
                    </div>

                    <div class="border border-gray-200 rounded-lg p-6">
                        <h4 class="font-semibold text-blue-700 mb-4 flex items-center">
                            <i class="fab fa-apple mr-2"></i>macOS環境
                        </h4>
                        <ol class="space-y-2 text-sm">
                            <li><strong>1.</strong> Homebrewを使用してインストール：
                                <pre class="bg-gray-800 text-green-400 p-3 rounded mt-2"><code>brew install postgresql
brew install --cask pgadmin4</code></pre>
                            </li>
                            <li><strong>2.</strong> PostgreSQLサービスを開始：
                                <pre class="bg-gray-800 text-green-400 p-3 rounded mt-2"><code>brew services start postgresql</code></pre>
                            </li>
                            <li><strong>3.</strong> 初期データベースを作成：
                                <pre class="bg-gray-800 text-green-400 p-3 rounded mt-2"><code>createdb mydb</code></pre>
                            </li>
                        </ol>
                    </div>
                </div>
            </div>

            <!-- pgAdmin vs psql -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold mb-4 text-green-700">pgAdmin（GUI）vs psql（CLI）の使い分け</h3>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-blue-50 p-6 rounded-lg">
                        <h4 class="font-semibold text-blue-800 mb-3 flex items-center">
                            <i class="fas fa-desktop mr-2"></i>pgAdmin（GUI操作）
                        </h4>
                        <div class="space-y-3 text-sm">
                            <p><strong>適用場面：</strong></p>
                            <ul class="ml-4 space-y-1">
                                <li>• データベース構造の視覚的確認</li>
                                <li>• テーブル設計とER図作成</li>
                                <li>• 初心者の学習段階</li>
                                <li>• データの参照・簡単な修正</li>
                            </ul>
                            
                            <p><strong>基本操作手順：</strong></p>
                            <ol class="ml-4 space-y-1">
                                <li>1. pgAdmin起動</li>
                                <li>2. サーバー接続（localhost:5432）</li>
                                <li>3. データベース選択</li>
                                <li>4. Query ToolでSQL実行</li>
                            </ol>
                        </div>
                    </div>
                    
                    <div class="bg-green-50 p-6 rounded-lg">
                        <h4 class="font-semibold text-green-800 mb-3 flex items-center">
                            <i class="fas fa-terminal mr-2"></i>psql（コマンドライン）</h4>
                        <div class="space-y-3 text-sm">
                            <p><strong>適用場面：</strong></p>
                            <ul class="ml-4 space-y-1">
                                <li>• 本番環境でのメンテナンス</li>
                                <li>• バッチ処理・自動化スクリプト</li>
                                <li>• 高速なSQL実行</li>
                                <li>• サーバー管理・監視</li>
                            </ul>
                            
                            <p><strong>基本コマンド：</strong></p>
                            <div class="bg-gray-800 text-green-400 p-3 rounded">
                                <code>psql -U postgres -d mydb<br>
\l    # データベース一覧<br>
\dt   # テーブル一覧<br>
\d table_name  # テーブル構造<br>
\q    # 終了</code>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 基本的な接続とセキュリティ -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold mb-4 text-red-700">接続設定とセキュリティ</h3>
                
                <div class="bg-red-50 p-6 rounded-lg mb-4">
                    <h4 class="font-semibold text-red-800 mb-3">認証方式の設定</h4>
                    <p class="text-sm text-gray-800 mb-3">PostgreSQLの認証設定は <code>pg_hba.conf</code> ファイルで管理されます。</p>
                    
                    <div class="bg-white p-4 rounded border">
                        <p class="text-sm font-semibold mb-2">主な認証方式：</p>
                        <ul class="text-sm space-y-1">
                            <li><strong>trust：</strong>パスワード不要（開発環境でのみ使用）</li>
                            <li><strong>md5：</strong>パスワード認証（基本的な本番環境）</li>
                            <li><strong>scram-sha-256：</strong>強力な暗号化（推奨）</li>
                        </ul>
                    </div>
                </div>

                <div class="sql-highlight">
                    <h4 class="font-semibold mb-2">セキュアな接続の例：</h4>
                    <pre class="bg-gray-800 text-green-400 p-4 rounded"><code class="language-sql">-- 新しいユーザー作成（読み取り専用）
CREATE USER app_user WITH PASSWORD 'secure_password123';

-- データベース作成
CREATE DATABASE ecommerce_db OWNER app_user;

-- 権限設定
GRANT CONNECT ON DATABASE ecommerce_db TO app_user;
GRANT USAGE ON SCHEMA public TO app_user;
GRANT SELECT ON ALL TABLES IN SCHEMA public TO app_user;</code></pre>
                </div>
            </div>
        </section>

        <!-- 3. データベース設計と正規化 -->
        <section class="bg-white rounded-lg shadow-lg p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-project-diagram text-red-600 mr-3"></i>3. データベース設計と正規化
            </h2>

            <!-- 正規化の必要性 -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold mb-4 text-blue-700">なぜ正規化が必要なのか？</h3>
                
                <div class="bg-red-50 border-l-4 border-red-400 p-6 mb-6">
                    <h4 class="font-semibold text-red-800 mb-3">正規化しない場合の問題例</h4>
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse border border-gray-300 text-sm">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="border border-gray-300 px-3 py-2">注文ID</th>
                                    <th class="border border-gray-300 px-3 py-2">顧客名</th>
                                    <th class="border border-gray-300 px-3 py-2">顧客電話</th>
                                    <th class="border border-gray-300 px-3 py-2">商品名</th>
                                    <th class="border border-gray-300 px-3 py-2">商品価格</th>
                                    <th class="border border-gray-300 px-3 py-2">数量</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="border border-gray-300 px-3 py-2">1001</td>
                                    <td class="border border-gray-300 px-3 py-2">田中太郎</td>
                                    <td class="border border-gray-300 px-3 py-2">090-1234-5678</td>
                                    <td class="border border-gray-300 px-3 py-2">ノートPC</td>
                                    <td class="border border-gray-300 px-3 py-2">80000</td>
                                    <td class="border border-gray-300 px-3 py-2">1</td>
                                </tr>
                                <tr class="bg-yellow-50">
                                    <td class="border border-gray-300 px-3 py-2">1002</td>
                                    <td class="border border-gray-300 px-3 py-2">田中太郎</td>
                                    <td class="border border-gray-300 px-3 py-2">090-1234-5678</td>
                                    <td class="border border-gray-300 px-3 py-2">マウス</td>
                                    <td class="border border-gray-300 px-3 py-2">2000</td>
                                    <td class="border border-gray-300 px-3 py-2">2</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="mt-4 space-y-2 text-red-700 text-sm">
                        <p><strong>❌ 問題点：</strong></p>
                        <ul class="ml-4 space-y-1">
                            <li>• <strong>重複データ：</strong>田中太郎の情報が重複している</li>
                            <li>• <strong>更新異常：</strong>電話番号変更時、複数箇所を修正する必要</li>
                            <li>• <strong>削除異常：</strong>注文を削除すると顧客情報も消える</li>
                            <li>• <strong>追加異常：</strong>注文しない顧客の情報を保存できない</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- 正規化プロセス -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold mb-4 text-green-700">段階的な正規化プロセス</h3>
                
                <!-- 第1正規形 -->
                <div class="mb-6">
                    <h4 class="font-semibold text-blue-800 mb-3">第1正規形（1NF）：原子値の原則</h4>
                    <div class="bg-blue-50 p-4 rounded-lg mb-4">
                        <p class="text-sm"><strong>ルール：</strong>各セル（フィールド）には分割できない単一の値のみを格納する</p>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <p class="text-sm font-semibold text-red-600 mb-2">❌ 正規化前（複数の値が混在）</p>
                            <div class="overflow-x-auto">
                                <table class="w-full border-collapse border border-gray-300 text-xs">
                                    <thead class="bg-red-100">
                                        <tr>
                                            <th class="border border-gray-300 px-2 py-1">顧客ID</th>
                                            <th class="border border-gray-300 px-2 py-1">電話番号</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="border border-gray-300 px-2 py-1">1</td>
                                            <td class="border border-gray-300 px-2 py-1">090-1234-5678, 03-5555-6666</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div>
                            <p class="text-sm font-semibold text-green-600 mb-2">✅ 正規化後（原子値のみ）</p>
                            <div class="overflow-x-auto">
                                <table class="w-full border-collapse border border-gray-300 text-xs">
                                    <thead class="bg-green-100">
                                        <tr>
                                            <th class="border border-gray-300 px-2 py-1">顧客ID</th>
                                            <th class="border border-gray-300 px-2 py-1">電話番号</th>
                                            <th class="border border-gray-300 px-2 py-1">番号種別</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td class="border border-gray-300 px-2 py-1">1</td>
                                            <td class="border border-gray-300 px-2 py-1">090-1234-5678</td>
                                            <td class="border border-gray-300 px-2 py-1">携帯</td>
                                        </tr>
                                        <tr>
                                            <td class="border border-gray-300 px-2 py-1">1</td>
                                            <td class="border border-gray-300 px-2 py-1">03-5555-6666</td>
                                            <td class="border border-gray-300 px-2 py-1">固定</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 第2正規形 -->
                <div class="mb-6">
                    <h4 class="font-semibold text-green-800 mb-3">第2正規形（2NF）：部分関数従属の除去</h4>
                    <div class="bg-green-50 p-4 rounded-lg mb-4">
                        <p class="text-sm"><strong>ルール：</strong>1NFかつ、非主キー属性が主キー全体に関数従属する（部分的な依存を排除）</p>
                    </div>
                    
                    <div class="sql-highlight">
                        <p class="text-sm font-semibold mb-2">✅ 第2正規形の実装例：</p>
                        <pre class="bg-gray-800 text-green-400 p-4 rounded"><code class="language-sql">-- 注文テーブル（主キー：注文ID + 商品ID）
CREATE TABLE orders (
    order_id INTEGER,
    product_id INTEGER,
    quantity INTEGER,
    PRIMARY KEY (order_id, product_id)
);

-- 商品テーブル（商品名、価格は商品IDのみに依存）
CREATE TABLE products (
    product_id SERIAL PRIMARY KEY,
    product_name VARCHAR(100) NOT NULL,
    price DECIMAL(10,2) NOT NULL
);</code></pre>
                    </div>
                </div>

                <!-- 第3正規形 -->
                <div class="mb-6">
                    <h4 class="font-semibold text-purple-800 mb-3">第3正規形（3NF）：推移関数従属の除去</h4>
                    <div class="bg-purple-50 p-4 rounded-lg mb-4">
                        <p class="text-sm"><strong>ルール：</strong>2NFかつ、非主キー属性間の推移的な依存関係を排除する</p>
                    </div>
                    
                    <div class="sql-highlight">
                        <p class="text-sm font-semibold mb-2">✅ 第3正規形の完成例：</p>
                        <pre class="bg-gray-800 text-green-400 p-4 rounded"><code class="language-sql">-- 顧客テーブル
CREATE TABLE customers (
    customer_id SERIAL PRIMARY KEY,
    customer_name VARCHAR(100) NOT NULL,
    postal_code VARCHAR(8),
    prefecture_id INTEGER REFERENCES prefectures(id)
);

-- 都道府県テーブル（推移依存を分離）
CREATE TABLE prefectures (
    id SERIAL PRIMARY KEY,
    name VARCHAR(20) NOT NULL
);

-- 注文テーブル
CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    customer_id INTEGER REFERENCES customers(customer_id),
    order_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);</code></pre>
                    </div>
                </div>
            </div>

            <!-- 非正規化の判断 -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold mb-4 text-orange-700">非正規化の実践的判断</h3>
                
                <div class="bg-orange-50 p-6 rounded-lg">
                    <p class="text-gray-800 mb-4">正規化は重要ですが、時にはパフォーマンスのために意図的に非正規化することがあります。</p>
                    
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="bg-white p-4 rounded border-l-4 border-green-500">
                            <h4 class="font-semibold text-green-700 mb-2">正規化のメリット</h4>
                            <ul class="text-sm space-y-1">
                                <li>• データ整合性の保証</li>
                                <li>• 重複排除によるストレージ効率</li>
                                <li>• メンテナンス性の向上</li>
                                <li>• 更新処理の簡素化</li>
                            </ul>
                        </div>
                        <div class="bg-white p-4 rounded border-l-4 border-red-500">
                            <h4 class="font-semibold text-red-700 mb-2">非正規化を検討する場面</h4>
                            <ul class="text-sm space-y-1">
                                <li>• 複雑なJOINによる性能劣化</li>
                                <li>• 大量データの高速検索が必要</li>
                                <li>• 読み取り専用のデータウェアハウス</li>
                                <li>• レポート作成の頻度が高い</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 4. テーブル作成とCRUD操作 -->
        <section class="bg-white rounded-lg shadow-lg p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-table text-yellow-600 mr-3"></i>4. テーブル作成とCRUD操作
            </h2>

            <!-- データ型の選択 -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold mb-4 text-blue-700">適切なデータ型の選択基準</h3>
                
                <div class="overflow-x-auto mb-6">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead class="bg-blue-100">
                            <tr>
                                <th class="border border-gray-300 px-4 py-3 text-left">用途</th>
                                <th class="border border-gray-300 px-4 py-3 text-left">PostgreSQL型</th>
                                <th class="border border-gray-300 px-4 py-3 text-left">理由・特徴</th>
                                <th class="border border-gray-300 px-4 py-3 text-left">実用例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="border border-gray-300 px-4 py-3 font-semibold">主キー</td>
                                <td class="border border-gray-300 px-4 py-3"><code>SERIAL</code></td>
                                <td class="border border-gray-300 px-4 py-3">自動増分、一意性保証</td>
                                <td class="border border-gray-300 px-4 py-3">customer_id, order_id</td>
                            </tr>
                            <tr class="bg-gray-50">
                                <td class="border border-gray-300 px-4 py-3 font-semibold">名前・住所</td>
                                <td class="border border-gray-300 px-4 py-3"><code>VARCHAR(n)</code></td>
                                <td class="border border-gray-300 px-4 py-3">可変長、メモリ効率良い</td>
                                <td class="border border-gray-300 px-4 py-3">氏名100文字、住所200文字</td>
                            </tr>
                            <tr>
                                <td class="border border-gray-300 px-4 py-3 font-semibold">価格・金額</td>
                                <td class="border border-gray-300 px-4 py-3"><code>DECIMAL(10,2)</code></td>
                                <td class="border border-gray-300 px-4 py-3">精密な計算、誤差なし</td>
                                <td class="border border-gray-300 px-4 py-3">商品価格、税額計算</td>
                            </tr>
                            <tr class="bg-gray-50">
                                <td class="border border-gray-300 px-4 py-3 font-semibold">日時</td>
                                <td class="border border-gray-300 px-4 py-3"><code>TIMESTAMP</code></td>
                                <td class="border border-gray-300 px-4 py-3">タイムゾーン対応</td>
                                <td class="border border-gray-300 px-4 py-3">注文日時、更新日時</td>
                            </tr>
                            <tr>
                                <td class="border border-gray-300 px-4 py-3 font-semibold">真偽値</td>
                                <td class="border border-gray-300 px-4 py-3"><code>BOOLEAN</code></td>
                                <td class="border border-gray-300 px-4 py-3">true/false/null対応</td>
                                <td class="border border-gray-300 px-4 py-3">削除フラグ、有効/無効</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 制約設定 -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold mb-4 text-green-700">制約設定による堅牢な設計</h3>
                
                <div class="sql-highlight mb-6">
                    <h4 class="font-semibold mb-3">実用的なテーブル作成例：</h4>
                    <pre class="bg-gray-800 text-green-400 p-4 rounded"><code class="language-sql">-- ECサイトの顧客テーブル
CREATE TABLE customers (
    customer_id SERIAL PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL 
        CHECK (email ~* '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$'),
    customer_name VARCHAR(100) NOT NULL,
    birth_date DATE CHECK (birth_date <= CURRENT_DATE),
    gender CHAR(1) CHECK (gender IN ('M', 'F', 'O')),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    is_active BOOLEAN DEFAULT true
);

-- 商品テーブル
CREATE TABLE products (
    product_id SERIAL PRIMARY KEY,
    product_name VARCHAR(200) NOT NULL,
    price DECIMAL(10,2) NOT NULL CHECK (price >= 0),
    stock_quantity INTEGER NOT NULL CHECK (stock_quantity >= 0),
    category_id INTEGER REFERENCES categories(category_id)
        ON DELETE RESTRICT ON UPDATE CASCADE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 注文テーブル
CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    customer_id INTEGER NOT NULL 
        REFERENCES customers(customer_id) ON DELETE CASCADE,
    order_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    total_amount DECIMAL(12,2) NOT NULL CHECK (total_amount > 0),
    status VARCHAR(20) DEFAULT 'pending' 
        CHECK (status IN ('pending', 'confirmed', 'shipped', 'delivered', 'cancelled'))
);</code></pre>
                </div>

                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-green-800 mb-3">主キー・外部キー制約</h4>
                        <ul class="text-sm space-y-2">
                            <li><strong>PRIMARY KEY：</strong>一意性と非NULL制約を自動設定</li>
                            <li><strong>FOREIGN KEY：</strong>参照整合性を保証</li>
                            <li><strong>ON DELETE CASCADE：</strong>親削除時に子も削除</li>
                            <li><strong>ON UPDATE CASCADE：</strong>親更新時に子も更新</li>
                        </ul>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-blue-800 mb-3">チェック制約</h4>
                        <ul class="text-sm space-y-2">
                            <li><strong>CHECK：</strong>値の範囲や形式を制限</li>
                            <li><strong>UNIQUE：</strong>重複を防止（NULLは複数可）</li>
                            <li><strong>NOT NULL：</strong>必須入力項目を設定</li>
                            <li><strong>DEFAULT：</strong>デフォルト値を自動設定</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- CRUD操作 -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold mb-4 text-purple-700">CRUD操作の実践例</h3>
                
                <!-- Create（作成） -->
                <div class="mb-6">
                    <h4 class="font-semibold text-blue-800 mb-3 flex items-center">
                        <i class="fas fa-plus-circle mr-2"></i>Create（データ作成）
                    </h4>
                    <div class="sql-highlight">
                        <pre class="bg-gray-800 text-green-400 p-4 rounded"><code class="language-sql">-- 単一レコード追加
INSERT INTO customers (email, customer_name, birth_date, gender)
VALUES ('tanaka@example.com', '田中太郎', '1990-05-15', 'M');

-- 複数レコード一括追加
INSERT INTO products (product_name, price, stock_quantity, category_id)
VALUES 
    ('ノートPC', 89800.00, 50, 1),
    ('ワイヤレスマウス', 2980.00, 200, 1),
    ('USB-Cケーブル', 1580.00, 100, 1);

-- サブクエリを使用した追加
INSERT INTO orders (customer_id, total_amount)
SELECT customer_id, 
       (SELECT SUM(price * 2) FROM products WHERE category_id = 1)
FROM customers 
WHERE email = 'tanaka@example.com';</code></pre>
                    </div>
                </div>

                <!-- Read（読み取り） -->
                <div class="mb-6">
                    <h4 class="font-semibold text-green-800 mb-3 flex items-center">
                        <i class="fas fa-search mr-2"></i>Read（データ読み取り）
                    </h4>
                    <div class="sql-highlight">
                        <pre class="bg-gray-800 text-green-400 p-4 rounded"><code class="language-sql">-- 基本的な検索
SELECT customer_name, email, created_at
FROM customers
WHERE is_active = true
ORDER BY created_at DESC
LIMIT 10;

-- JOINを使用した関連データ取得
SELECT 
    c.customer_name,
    o.order_id,
    o.order_date,
    o.total_amount,
    o.status
FROM customers c
INNER JOIN orders o ON c.customer_id = o.customer_id
WHERE o.order_date >= CURRENT_DATE - INTERVAL '30 days'
ORDER BY o.order_date DESC;

-- 集計クエリ
SELECT 
    c.customer_name,
    COUNT(o.order_id) as order_count,
    SUM(o.total_amount) as total_spent,
    AVG(o.total_amount) as avg_order_value
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id, c.customer_name
HAVING COUNT(o.order_id) > 5;</code></pre>
                    </div>
                </div>

                <!-- Update（更新） -->
                <div class="mb-6">
                    <h4 class="font-semibold text-orange-800 mb-3 flex items-center">
                        <i class="fas fa-edit mr-2"></i>Update（データ更新）
                    </h4>
                    <div class="sql-highlight">
                        <pre class="bg-gray-800 text-green-400 p-4 rounded"><code class="language-sql">-- 単一レコード更新
UPDATE customers
SET customer_name = '田中一郎',
    updated_at = CURRENT_TIMESTAMP
WHERE customer_id = 1;

-- 条件に基づく一括更新
UPDATE products
SET price = price * 1.1  -- 10%値上げ
WHERE category_id = 1 
  AND price < 5000;

-- JOINを使用した更新
UPDATE orders
SET status = 'shipped'
FROM customers c
WHERE orders.customer_id = c.customer_id
  AND c.email LIKE '%@premium.com'
  AND orders.status = 'confirmed';</code></pre>
                    </div>
                </div>

                <!-- Delete（削除） -->
                <div class="mb-6">
                    <h4 class="font-semibold text-red-800 mb-3 flex items-center">
                        <i class="fas fa-trash mr-2"></i>Delete（データ削除）
                    </h4>
                    <div class="sql-highlight">
                        <pre class="bg-gray-800 text-green-400 p-4 rounded"><code class="language-sql">-- 論理削除（推奨）
UPDATE customers
SET is_active = false,
    updated_at = CURRENT_TIMESTAMP
WHERE customer_id = 1;

-- 条件に基づく削除
DELETE FROM orders
WHERE status = 'cancelled'
  AND order_date < CURRENT_DATE - INTERVAL '1 year';

-- 関連データの整合性を保った削除
BEGIN;
  DELETE FROM order_items WHERE order_id = 1001;
  DELETE FROM orders WHERE order_id = 1001;
COMMIT;</code></pre>
                    </div>
                </div>
            </div>

            <!-- インデックス戦略 -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold mb-4 text-indigo-700">パフォーマンス向上のためのインデックス戦略</h3>
                
                <div class="bg-indigo-50 p-6 rounded-lg mb-6">
                    <p class="text-gray-800 mb-4"><strong>インデックス（Index - 索引）</strong>は、本の目次のようにデータの検索速度を向上させる仕組みです。適切なインデックスにより、大量データからの検索が飛躍的に高速化されます。</p>
                </div>

                <div class="sql-highlight">
                    <h4 class="font-semibold mb-3">実用的なインデックス作成例：</h4>
                    <pre class="bg-gray-800 text-green-400 p-4 rounded"><code class="language-sql">-- 単一カラムインデックス（検索頻度の高いカラム）
CREATE INDEX idx_customers_email ON customers(email);
CREATE INDEX idx_orders_customer_id ON orders(customer_id);
CREATE INDEX idx_orders_order_date ON orders(order_date);

-- 複合インデックス（複数条件での検索）
CREATE INDEX idx_orders_customer_date ON orders(customer_id, order_date);
CREATE INDEX idx_products_category_price ON products(category_id, price);

-- 部分インデックス（条件を満たすレコードのみ）
CREATE INDEX idx_active_customers ON customers(customer_id) 
WHERE is_active = true;

-- ユニークインデックス（重複防止+高速検索）
CREATE UNIQUE INDEX idx_customers_email_unique ON customers(email);

-- 関数インデックス（計算結果に対するインデックス）
CREATE INDEX idx_customers_name_lower ON customers(LOWER(customer_name));</code></pre>
                </div>

                <div class="grid md:grid-cols-2 gap-6 mt-6">
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-green-800 mb-3">インデックス作成の指針</h4>
                        <ul class="text-sm space-y-1">
                            <li>• WHERE句で頻繁に使用するカラム</li>
                            <li>• JOIN条件で使用するカラム</li>
                            <li>• ORDER BY句で使用するカラム</li>
                            <li>• 一意性制約が必要なカラム</li>
                        </ul>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-red-800 mb-3">インデックス作成時の注意点</h4>
                        <ul class="text-sm space-y-1">
                            <li>• 更新処理のオーバーヘッド増加</li>
                            <li>• ストレージ容量の追加消費</li>
                            <li>• 過度なインデックスは逆効果</li>
                            <li>• 定期的なメンテナンス必要</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- 5. PostgreSQL固有機能の活用 -->
        <section class="bg-white rounded-lg shadow-lg p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-rocket text-purple-600 mr-3"></i>5. PostgreSQL固有機能の活用
            </h2>

            <!-- 配列型・JSON型 -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold mb-4 text-blue-700">モダンなデータ構造の活用</h3>
                
                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-blue-50 p-6 rounded-lg">
                        <h4 class="font-semibold text-blue-800 mb-3 flex items-center">
                            <i class="fas fa-list mr-2"></i>配列型（Array）の活用
                        </h4>
                        <p class="text-sm text-gray-700 mb-3">複数の値を1つのカラムに格納可能。タグ、カテゴリ、電話番号リストなどに最適。</p>
                        
                        <div class="sql-highlight">
                            <pre class="bg-gray-800 text-green-400 p-3 rounded text-xs"><code class="language-sql">-- 配列型の使用例
CREATE TABLE articles (
    id SERIAL PRIMARY KEY,
    title VARCHAR(200),
    tags TEXT[],  -- 配列型
    categories INTEGER[]
);

-- データ挿入
INSERT INTO articles (title, tags, categories)
VALUES ('PostgreSQL入門', 
        ARRAY['database', 'sql', 'tutorial'],
        ARRAY[1, 3, 5]);

-- 配列検索
SELECT * FROM articles 
WHERE 'database' = ANY(tags);</code></pre>
                        </div>
                    </div>
                    
                    <div class="bg-green-50 p-6 rounded-lg">
                        <h4 class="font-semibold text-green-800 mb-3 flex items-center">
                            <i class="fas fa-code mr-2"></i>JSON型の活用
                        </h4>
                        <p class="text-sm text-gray-700 mb-3">構造化データを柔軟に格納。設定情報、属性データ、APIレスポンスの保存に便利。</p>
                        
                        <div class="sql-highlight">
                            <pre class="bg-gray-800 text-green-400 p-3 rounded text-xs"><code class="language-sql">-- JSON型の使用例
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    attributes JSONB  -- バイナリJSON
);

-- データ挿入
INSERT INTO products (name, attributes)
VALUES ('ノートPC', '{
    "brand": "ACME",
    "specs": {
        "cpu": "Intel i7",
        "memory": "16GB",
        "storage": "512GB SSD"
    },
    "colors": ["black", "silver"]
}');

-- JSON検索
SELECT * FROM products
WHERE attributes->>'brand' = 'ACME';</code></pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 拡張機能 -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold mb-4 text-green-700">拡張機能による機能強化</h3>
                
                <div class="space-y-6">
                    <div class="bg-green-50 p-6 rounded-lg">
                        <h4 class="font-semibold text-green-800 mb-3">PostGIS（地理情報システム）</h4>
                        <p class="text-sm text-gray-700 mb-3">位置情報、地図データ、距離計算などの地理空間処理が可能になります。</p>
                        
                        <div class="sql-highlight">
                            <pre class="bg-gray-800 text-green-400 p-3 rounded"><code class="language-sql">-- PostGIS拡張機能を有効化
CREATE EXTENSION postgis;

-- 店舗テーブル（位置情報付き）
CREATE TABLE stores (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    location POINT  -- 緯度経度
);

-- 半径5km以内の店舗を検索
SELECT name, location
FROM stores
WHERE ST_DWithin(location, ST_MakePoint(139.7673, 35.6809)::geography, 5000);</code></pre>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 p-6 rounded-lg">
                        <h4 class="font-semibold text-blue-800 mb-3">全文検索（Full-text Search）</h4>
                        <p class="text-sm text-gray-700 mb-3">高速で柔軟な文章検索が可能。ブログ、商品説明、ドキュメント検索に最適。</p>
                        
                        <div class="sql-highlight">
                            <pre class="bg-gray-800 text-green-400 p-3 rounded"><code class="language-sql">-- 全文検索インデックス作成
CREATE TABLE documents (
    id SERIAL PRIMARY KEY,
    title VARCHAR(200),
    content TEXT,
    search_vector TSVECTOR
);

-- 検索ベクトル更新トリガー
CREATE TRIGGER update_search_vector
BEFORE INSERT OR UPDATE ON documents
FOR EACH ROW EXECUTE FUNCTION
tsvector_update_trigger(search_vector, 'pg_catalog.japanese', title, content);

-- 全文検索実行
SELECT title, content
FROM documents
WHERE search_vector @@ to_tsquery('japanese', 'データベース & 設計');</code></pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- パフォーマンス最適化 -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold mb-4 text-red-700">パフォーマンス最適化</h3>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-red-50 p-6 rounded-lg">
                        <h4 class="font-semibold text-red-800 mb-3 flex items-center">
                            <i class="fas fa-chart-line mr-2"></i>EXPLAIN（実行計画分析）
                        </h4>
                        <p class="text-sm text-gray-700 mb-3">クエリの実行方法を可視化し、ボトルネックを特定します。</p>
                        
                        <div class="sql-highlight">
                            <pre class="bg-gray-800 text-green-400 p-3 rounded text-xs"><code class="language-sql">-- 実行計画の確認
EXPLAIN ANALYZE
SELECT c.customer_name, COUNT(o.order_id)
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
GROUP BY c.customer_id, c.customer_name;</code></pre>
                        </div>
                    </div>
                    
                    <div class="bg-yellow-50 p-6 rounded-lg">
                        <h4 class="font-semibold text-yellow-800 mb-3 flex items-center">
                            <i class="fas fa-broom mr-2"></i>VACUUM（メンテナンス）
                        </h4>
                        <p class="text-sm text-gray-700 mb-3">不要な領域を解放し、統計情報を更新してパフォーマンスを維持します。</p>
                        
                        <div class="sql-highlight">
                            <pre class="bg-gray-800 text-green-400 p-3 rounded text-xs"><code class="language-sql">-- 定期メンテナンス
VACUUM ANALYZE customers;

-- 完全なVACUUM（時間がかかる）
VACUUM FULL orders;</code></pre>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 演習問題 -->
        <section class="bg-white rounded-lg shadow-lg p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-dumbbell text-orange-600 mr-3"></i>演習問題
            </h2>

            <!-- 演習1 -->
            <div class="mb-8 bg-orange-50 p-6 rounded-lg">
                <h3 class="text-lg font-semibold mb-4 text-orange-800">演習1: ECサイトデータベース設計</h3>
                <p class="text-gray-700 mb-4">以下の要件を満たすECサイトのデータベースを設計し、PostgreSQLで実装してください。</p>
                
                <div class="bg-white p-4 rounded-lg mb-4">
                    <h4 class="font-semibold mb-2">要件:</h4>
                    <ul class="space-y-1 text-sm">
                        <li>• 顧客情報（ID、名前、メールアドレス、生年月日、住所）</li>
                        <li>• 商品情報（ID、商品名、価格、在庫数、カテゴリ）</li>
                        <li>• 注文情報（ID、顧客ID、注文日、合計金額、ステータス）</li>
                        <li>• 注文明細（注文ID、商品ID、数量、単価）</li>
                        <li>• 適切な制約とインデックスを設定すること</li>
                    </ul>
                </div>

                <button onclick="toggleAnswer('exercise1')" class="bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700">
                    回答例を表示
                </button>
                
                <div id="exercise1" class="exercise-answer mt-4">
                    <div class="bg-gray-800 text-green-400 p-4 rounded">
                        <pre><code class="language-sql">-- カテゴリテーブル
CREATE TABLE categories (
    category_id SERIAL PRIMARY KEY,
    category_name VARCHAR(50) NOT NULL UNIQUE
);

-- 顧客テーブル
CREATE TABLE customers (
    customer_id SERIAL PRIMARY KEY,
    customer_name VARCHAR(100) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    birth_date DATE,
    address TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 商品テーブル
CREATE TABLE products (
    product_id SERIAL PRIMARY KEY,
    product_name VARCHAR(200) NOT NULL,
    price DECIMAL(10,2) NOT NULL CHECK (price >= 0),
    stock_quantity INTEGER NOT NULL CHECK (stock_quantity >= 0),
    category_id INTEGER REFERENCES categories(category_id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 注文テーブル
CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    customer_id INTEGER NOT NULL REFERENCES customers(customer_id),
    order_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    total_amount DECIMAL(12,2) NOT NULL CHECK (total_amount > 0),
    status VARCHAR(20) DEFAULT 'pending' 
        CHECK (status IN ('pending', 'confirmed', 'shipped', 'delivered', 'cancelled'))
);

-- 注文明細テーブル
CREATE TABLE order_items (
    order_id INTEGER REFERENCES orders(order_id) ON DELETE CASCADE,
    product_id INTEGER REFERENCES products(product_id),
    quantity INTEGER NOT NULL CHECK (quantity > 0),
    unit_price DECIMAL(10,2) NOT NULL CHECK (unit_price >= 0),
    PRIMARY KEY (order_id, product_id)
);

-- インデックス作成
CREATE INDEX idx_customers_email ON customers(email);
CREATE INDEX idx_orders_customer_id ON orders(customer_id);
CREATE INDEX idx_orders_date ON orders(order_date);
CREATE INDEX idx_products_category ON products(category_id);
CREATE INDEX idx_order_items_order_id ON order_items(order_id);</code></pre>
                    </div>
                </div>
            </div>

            <!-- 演習2 -->
            <div class="mb-8 bg-blue-50 p-6 rounded-lg">
                <h3 class="text-lg font-semibold mb-4 text-blue-800">演習2: 複雑なSQLクエリ作成</h3>
                <p class="text-gray-700 mb-4">上記のECサイトデータベースに対して、以下のビジネス要件を満たすSQLクエリを作成してください。</p>
                
                <div class="bg-white p-4 rounded-lg mb-4">
                    <h4 class="font-semibold mb-2">要件:</h4>
                    <ul class="space-y-1 text-sm">
                        <li>• 過去3ヶ月間の売上上位10商品を表示</li>
                        <li>• 顧客別の累計購入金額と購入回数を表示</li>
                        <li>• 在庫が10個以下の商品をカテゴリ別に表示</li>
                        <li>• 月別売上推移レポートを作成</li>
                    </ul>
                </div>

                <button onclick="toggleAnswer('exercise2')" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                    回答例を表示
                </button>
                
                <div id="exercise2" class="exercise-answer mt-4">
                    <div class="bg-gray-800 text-green-400 p-4 rounded">
                        <pre><code class="language-sql">-- 1) 過去3ヶ月間の売上上位10商品
SELECT 
    p.product_name,
    SUM(oi.quantity) as total_sold,
    SUM(oi.quantity * oi.unit_price) as total_revenue
FROM products p
JOIN order_items oi ON p.product_id = oi.product_id
JOIN orders o ON oi.order_id = o.order_id
WHERE o.order_date >= CURRENT_DATE - INTERVAL '3 months'
  AND o.status IN ('confirmed', 'shipped', 'delivered')
GROUP BY p.product_id, p.product_name
ORDER BY total_revenue DESC
LIMIT 10;

-- 2) 顧客別の累計購入金額と購入回数
SELECT 
    c.customer_name,
    c.email,
    COUNT(DISTINCT o.order_id) as order_count,
    COALESCE(SUM(o.total_amount), 0) as total_spent,
    COALESCE(AVG(o.total_amount), 0) as avg_order_value
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id 
    AND o.status IN ('confirmed', 'shipped', 'delivered')
GROUP BY c.customer_id, c.customer_name, c.email
ORDER BY total_spent DESC;

-- 3) 在庫が10個以下の商品をカテゴリ別に表示
SELECT 
    cat.category_name,
    p.product_name,
    p.stock_quantity,
    p.price
FROM products p
JOIN categories cat ON p.category_id = cat.category_id
WHERE p.stock_quantity <= 10
ORDER BY cat.category_name, p.stock_quantity ASC;

-- 4) 月別売上推移レポート
SELECT 
    DATE_TRUNC('month', o.order_date) as month,
    COUNT(DISTINCT o.order_id) as order_count,
    COUNT(DISTINCT o.customer_id) as unique_customers,
    SUM(o.total_amount) as monthly_revenue,
    AVG(o.total_amount) as avg_order_value
FROM orders o
WHERE o.status IN ('confirmed', 'shipped', 'delivered')
  AND o.order_date >= CURRENT_DATE - INTERVAL '12 months'
GROUP BY DATE_TRUNC('month', o.order_date)
ORDER BY month DESC;</code></pre>
                    </div>
                </div>
            </div>
        </section>

        <!-- 理解度クイズ -->
        <section class="bg-white rounded-lg shadow-lg p-8 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <i class="fas fa-question-circle text-purple-600 mr-3"></i>理解度クイズ
            </h2>

            <!-- クイズ1 -->
            <div class="mb-6 bg-purple-50 p-6 rounded-lg">
                <h3 class="text-lg font-semibold mb-4 text-purple-800">クイズ1: ACID特性について</h3>
                <p class="text-gray-700 mb-4">以下のうち、ACID特性の「Consistency（一貫性）」を正しく説明しているものはどれでしょうか？</p>
                
                <div class="space-y-2 mb-4">
                    <label class="flex items-center">
                        <input type="radio" name="quiz1" value="a" class="mr-3">
                        A) トランザクションは全て成功するか、全て失敗するかのどちらかである
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="quiz1" value="b" class="mr-3">
                        B) データは常にデータベースのルール（制約）を満たしている
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="quiz1" value="c" class="mr-3">
                        C) 複数のトランザクションが同時実行されても互いに影響しない
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="quiz1" value="d" class="mr-3">
                        D) 完了したトランザクションは永続的に保存される
                    </label>
                </div>

                <button onclick="showAnswer('quiz1', 'b', 'B) データは常にデータベースのルール（制約）を満たしている<br><br><strong>解説:</strong> Consistency（一貫性）は、データベースが常に整合性制約を満たした状態を維持することを意味します。A)はAtomicity、C)はIsolation、D)はDurabilityの説明です。')" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
                    回答を表示
                </button>
                
                <div id="quiz1-answer" class="quiz-answer mt-4 p-4 bg-green-100 rounded-lg"></div>
            </div>

            <!-- クイズ2 -->
            <div class="mb-6 bg-blue-50 p-6 rounded-lg">
                <h3 class="text-lg font-semibold mb-4 text-blue-800">クイズ2: 正規化について</h3>
                <p class="text-gray-700 mb-4">第2正規形（2NF）の条件として正しいものはどれでしょうか？</p>
                
                <div class="space-y-2 mb-4">
                    <label class="flex items-center">
                        <input type="radio" name="quiz2" value="a" class="mr-3">
                        A) 各セルには分割できない単一の値のみを格納する
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="quiz2" value="b" class="mr-3">
                        B) 1NFかつ、非主キー属性が主キー全体に関数従属する
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="quiz2" value="c" class="mr-3">
                        C) 2NFかつ、非主キー属性間の推移的依存関係を排除する
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="quiz2" value="d" class="mr-3">
                        D) すべての属性が主キーに直接依存する
                    </label>
                </div>

                <button onclick="showAnswer('quiz2', 'b', 'B) 1NFかつ、非主キー属性が主キー全体に関数従属する<br><br><strong>解説:</strong> 第2正規形は第1正規形の条件を満たしており、かつ部分関数従属を排除した形です。A)は1NF、C)は3NFの説明です。')" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                    回答を表示
                </button>
                
                <div id="quiz2-answer" class="quiz-answer mt-4 p-4 bg-green-100 rounded-lg"></div>
            </div>

            <!-- クイズ3 -->
            <div class="mb-6 bg-green-50 p-6 rounded-lg">
                <h3 class="text-lg font-semibold mb-4 text-green-800">クイズ3: PostgreSQL固有機能</h3>
                <p class="text-gray-700 mb-4">PostgreSQLでJSON型のデータから特定のキーの値を取得する演算子はどれでしょうか？</p>
                
                <div class="space-y-2 mb-4">
                    <label class="flex items-center">
                        <input type="radio" name="quiz3" value="a" class="mr-3">
                        A) #>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="quiz3" value="b" class="mr-3">
                        B) ->>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="quiz3" value="c" class="mr-3">
                        C) @>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="quiz3" value="d" class="mr-3">
                        D) ?
                    </label>
                </div>

                <button onclick="showAnswer('quiz3', 'b', 'B) ->><br><br><strong>解説:</strong> ->>演算子はJSONの値をテキストとして取得します。->はJSON型として取得、#>はパス指定、@>は包含チェック、?はキー存在チェックに使用されます。')" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                    回答を表示
                </button>
                
                <div id="quiz3-answer" class="quiz-answer mt-4 p-4 bg-green-100 rounded-lg"></div>
            </div>
        </section>

        <!-- まとめ -->
        <section class="bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg p-8 mb-8">
            <h2 class="text-2xl font-bold mb-6 flex items-center">
                <i class="fas fa-graduation-cap mr-3"></i>まとめ
            </h2>

            <div class="grid md:grid-cols-2 gap-8">
                <div>
                    <h3 class="text-xl font-semibold mb-4">習得した重要ポイント</h3>
                    
                    <div class="space-y-4">
                        <div class="bg-white bg-opacity-20 p-4 rounded-lg">
                            <h4 class="font-semibold mb-2 flex items-center">
                                <i class="fas fa-database mr-2"></i>関係データベースの基礎
                            </h4>
                            <p class="text-sm text-blue-100">RDBMS、ACID特性、ER図によるデータモデリングの理解により、堅牢なデータベース設計の基盤を確立</p>
                        </div>

                        <div class="bg-white bg-opacity-20 p-4 rounded-lg">
                            <h4 class="font-semibold mb-2 flex items-center">
                                <i class="fas fa-cogs mr-2"></i>PostgreSQL実践技術
                            </h4>
                            <p class="text-sm text-blue-100">環境構築からSQL操作、インデックス設計まで、現場で即戦力となる技術スタックを完全習得</p>
                        </div>

                        <div class="bg-white bg-opacity-20 p-4 rounded-lg">
                            <h4 class="font-semibold mb-2 flex items-center">
                                <i class="fas fa-project-diagram mr-2"></i>データベース設計技法
                            </h4>
                            <p class="text-sm text-blue-100">正規化理論による論理設計と制約設計により、保守性・拡張性の高いシステム構築を実現</p>
                        </div>
                    </div>
                </div>

                <div>
                    <h3 class="text-xl font-semibold mb-4">実務的なメリット</h3>
                    
                    <div class="space-y-4">
                        <div class="bg-white bg-opacity-20 p-4 rounded-lg">
                            <h4 class="font-semibold mb-2 flex items-center">
                                <i class="fas fa-rocket mr-2"></i>開発効率の向上
                            </h4>
                            <p class="text-sm text-blue-100">PostgreSQLの高度な機能（JSON、配列、拡張機能）により、複雑な要件にも柔軟に対応可能</p>
                        </div>

                        <div class="bg-white bg-opacity-20 p-4 rounded-lg">
                            <h4 class="font-semibold mb-2 flex items-center">
                                <i class="fas fa-shield-alt mr-2"></i>データ品質の保証
                            </h4>
                            <p class="text-sm text-blue-100">制約設計とトランザクション管理により、ビジネスクリティカルなシステムでも安心してデータを管理</p>
                        </div>

                        <div class="bg-white bg-opacity-20 p-4 rounded-lg">
                            <h4 class="font-semibold mb-2 flex items-center">
                                <i class="fas fa-chart-line mr-2"></i>スケーラビリティ
                            </h4>
                            <p class="text-sm text-blue-100">インデックス戦略とパフォーマンス最適化により、大規模データにも対応できる設計力を獲得</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-8 p-6 bg-white bg-opacity-10 rounded-lg">
                <h3 class="text-lg font-semibold mb-3">次回予告: モダンJavaScript・Web制作実習</h3>
                <p class="text-blue-100">ES6+の新機能、非同期処理、API連携を学び、今回習得したデータベース技術と組み合わせた本格的なWebアプリケーション開発に挑戦します。</p>
            </div>
        </section>

        <!-- フッター -->
        <footer class="text-center py-8 text-gray-600">
            <p>© 2025 APSA Co.,Ltd. All Rights Reserved.</p>
        </footer>
    </div>

    <script>
        function toggleAnswer(id) {
            const element = document.getElementById(id);
            if (element.style.display === 'none' || element.style.display === '') {
                element.style.display = 'block';
            } else {
                element.style.display = 'none';
            }
        }

        function showAnswer(quizId, correctAnswer, explanation) {
            const answerDiv = document.getElementById(quizId + '-answer');
            const selectedAnswer = document.querySelector(`input[name="${quizId}"]:checked`);
            
            if (!selectedAnswer) {
                answerDiv.innerHTML = '<p class="text-red-600">回答を選択してください。</p>';
                answerDiv.style.display = 'block';
                return;
            }
            
            const isCorrect = selectedAnswer.value === correctAnswer;
            const resultClass = isCorrect ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
            const resultIcon = isCorrect ? '✅' : '❌';
            const resultText = isCorrect ? '正解です！' : '不正解です。';
            
            answerDiv.className = `quiz-answer mt-4 p-4 rounded-lg ${resultClass}`;
            answerDiv.innerHTML = `
                <p class="font-semibold mb-2">${resultIcon} ${resultText}</p>
                <p><strong>正解:</strong> ${explanation}</p>
            `;
            answerDiv.style.display = 'block';
        }
    </script>
    </div>
    </main>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDgEJf%2BSl0FPEAxD0qkChJ0XwXZjP%2FlxTgSqsCUqyT89Y58Vl%2Bohne9cdwupFsMrfaBQdPsQdYjHpzklSJ1A4O6ooDP9gNvNVNSGrXteZROGKZ6PiBJ9HTjroZ67dQWmoREJtxXcLFfl%2F5Q53sJG%2BYn6l59fwwUtNCZOqAzmLIUfm4wiXSnCkyMtgAshHARPMW60xUVSY08xjkEG4ErTA9ZWr4NKKMNoC0j4jhk4XjdTmxNjMZtSp9qUnqRUeIk8wnuu4lIv5lishSSeLOjeQga83M6JQfZ%2FVSzq94w0upqSVgO4sn024QNCeWh8FQAKffOsgGapT1%2F0gf0DFeAZs8wMbZTkPxHS12StcMgw5RvcoYCNBkJWwNF%2FYl4s2wIBMpas4aFyuGZBaHRPZF5S9%2FayryrvQhD1jUJGAEy8DWElxI2Br7%2FPESfveNXLrq9nGbfsXFi2QX6hJw28ulRpeT0FgCgonnSYoG1GAbQl7LUYS1ONWGX9zzo3h9wNfQqb2Mw%3D%3D";
        window.__genspark_locale = "ja-JP";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDgEJf+Sl0FPEAxD0qkChJ0XwXZjP/lxTgSqsCUqyT89Y58Vl+ohne9cdwupFsMrfaBQdPsQdYjHpzklSJ1A4O6ooDP9gNvNVNSGrXteZROGKZ6PiBJ9HTjroZ67dQWmoREJtxXcLFfl/5Q53sJG+Yn6l59fwwUtNCZOqAzmLIUfm4wiXSnCkyMtgAshHARPMW60xUVSY08xjkEG4ErTA9ZWr4NKKMNoC0j4jhk4XjdTmxNjMZtSp9qUnqRUeIk8wnuu4lIv5lishSSeLOjeQga83M6JQfZ/VSzq94w0upqSVgO4sn024QNCeWh8FQAKffOsgGapT1/0gf0DFeAZs8wMbZTkPxHS12StcMgw5RvcoYCNBkJWwNF/Yl4s2wIBMpas4aFyuGZBaHRPZF5S9/ayryrvQhD1jUJGAEy8DWElxI2Br7/PESfveNXLrq9nGbfsXFi2QX6hJw28ulRpeT0FgCgonnSYoG1GAbQl7LUYS1ONWGX9zzo3h9wNfQqb2Mw==";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    