<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day43: PostgreSQL・応用SQL・トランザクション管理</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        .code-block {
            background-color: #f8f9fa;
            border-left: 4px solid #0066cc;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0.375rem;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        }
        .highlight-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 0.75rem;
            margin: 1rem 0;
        }
        .warning-box {
            background-color: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0.375rem;
        }
        .success-box {
            background-color: #d1fae5;
            border-left: 4px solid #10b981;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0.375rem;
        }
        .table-container {
            overflow-x: auto;
            margin: 1rem 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        th, td {
            border: 1px solid #e5e7eb;
            padding: 0.75rem;
            text-align: left;
        }
        th {
            background-color: #f3f4f6;
            font-weight: 600;
        }
        .quiz-answer {
            display: none;
            background-color: #e0f2fe;
            padding: 1rem;
            margin: 0.5rem 0;
            border-radius: 0.375rem;
            border-left: 4px solid #0288d1;
        }
        .fixed-nav {
            backdrop-filter: blur(10px);
            background-color: rgba(255, 255, 255, 0.95);
        }
        .nav-link:hover {
            background-color: rgba(59, 130, 246, 0.1);
        }
        .breadcrumb-separator::after {
            content: ">";
            margin: 0 8px;
            color: #9CA3AF;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">
    <nav class="fixed top-0 left-0 right-0 z-50 fixed-nav border-b border-gray-200">
        <div class="bg-blue-600 text-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-12">
                    <div class="flex items-center">
                        <i class="fas fa-graduation-cap mr-2"></i>
                        <span class="font-semibold">ITエンジニア育成カリキュラム</span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <a href="./lecture42.html" class="nav-link px-3 py-1 rounded text-sm hover:bg-blue-700 transition-colors">
                            <i class="fas fa-chevron-left mr-1"></i> 前の講義
                        </a>
                        <a href="./lecture44.html" class="nav-link px-3 py-1 rounded text-sm hover:bg-blue-700 transition-colors">
                            次の講義 <i class="fas fa-chevron-right ml-1"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="bg-white px-4 py-3">
            <div class="max-w-7xl mx-auto">
                <div class="flex items-center justify-between">
                    <div class="flex items-center text-sm text-gray-600">
                        <a href="../index.html" class="hover:text-blue-600"><i class="fas fa-home mr-1"></i>ホーム</a>
                        <span class="breadcrumb-separator"></span>
                        <a href="../month/month3.html" class="hover:text-blue-600">3ヶ月目: Webアプリケーション開発実践</a>
                        <span class="breadcrumb-separator"></span>
                        <a href="../week/week10.html" class="hover:text-blue-600">10週目: バックエンド基礎</a>
                        <span class="breadcrumb-separator"></span>
                        <span class="font-semibold text-blue-600">43日目: PostgreSQL・応用SQL・トランザクション管理</span>
                    </div>
                    <div class="flex items-center space-x-3">
                        <a href="../day/day43.html" class="inline-flex items-center px-3 py-1 border border-blue-300 rounded-md text-sm text-blue-600 hover:bg-blue-50 transition-colors">
                            <i class="fas fa-clipboard-list mr-1"></i> 本日の概要
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    <main class="pt-32">
    <div class="max-w-6xl mx-auto p-6">
        <!-- ヘッダー -->
        <header class="text-center mb-8">
            <div class="highlight-box">
                <h1 class="text-4xl font-bold mb-2">
                    <i class="fas fa-database mr-3"></i>
                    ITエンジニア育成カリキュラム
                </h1>
                <h2 class="text-2xl font-semibold">Day43: PostgreSQL・応用SQL・トランザクション管理</h2>
                <p class="mt-4 text-lg">高度なSQL技術と実践的なデータベース運用技術</p>
            </div>
        </header>

        <!-- 学習目標 -->
        <section class="mb-8">
            <h2 class="text-3xl font-bold mb-4 text-blue-600">
                <i class="fas fa-target mr-2"></i>本日の学習目標
            </h2>
            <div class="grid md:grid-cols-2 gap-4">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold mb-3 text-green-600">
                        <i class="fas fa-code mr-2"></i>応用SQL技術の習得
                    </h3>
                    <p>複雑な結合、集計、サブクエリを使いこなし、効率的なデータ操作を実現</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold mb-3 text-purple-600">
                        <i class="fas fa-lock mr-2"></i>トランザクション管理
                    </h3>
                    <p>ACID特性を理解し、データ整合性を保つトランザクション制御を実装</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold mb-3 text-orange-600">
                        <i class="fas fa-tachometer-alt mr-2"></i>パフォーマンス最適化
                    </h3>
                    <p>インデックス戦略とクエリ最適化でデータベースの性能を向上</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold mb-3 text-red-600">
                        <i class="fas fa-shield-alt mr-2"></i>セキュリティ対策
                    </h3>
                    <p>SQLインジェクション対策とアクセス制御で安全なDB運用を実現</p>
                </div>
            </div>
        </section>

        <!-- 1. 応用SQL技術 -->
        <section class="mb-8">
            <h2 class="text-3xl font-bold mb-6 text-blue-600">
                <i class="fas fa-code mr-2"></i>1. 応用SQL技術の完全マスター
            </h2>

            <div class="mb-6">
                <h3 class="text-2xl font-semibold mb-4 text-gray-700">1.1 複雑な結合（JOIN）の実践</h3>
                
                <div class="success-box">
                    <h4 class="font-semibold mb-2">
                        <i class="fas fa-info-circle mr-2"></i>結合の種類と使い分け
                    </h4>
                    <p>効率的なデータ取得のために、適切な結合方法を選択することが重要です。</p>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>結合タイプ</th>
                                <th>用途</th>
                                <th>特徴</th>
                                <th>実用例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>INNER JOIN</td>
                                <td>完全一致データ</td>
                                <td>両テーブルに存在するレコードのみ</td>
                                <td>注文と顧客の紐付け</td>
                            </tr>
                            <tr>
                                <td>LEFT JOIN</td>
                                <td>主テーブル全件取得</td>
                                <td>左テーブルの全レコードを保持</td>
                                <td>全顧客と注文履歴（未注文含む）</td>
                            </tr>
                            <tr>
                                <td>RIGHT JOIN</td>
                                <td>従テーブル全件取得</td>
                                <td>右テーブルの全レコードを保持</td>
                                <td>全商品と売上データ</td>
                            </tr>
                            <tr>
                                <td>FULL OUTER JOIN</td>
                                <td>両テーブル全件</td>
                                <td>両テーブルの全レコードを保持</td>
                                <td>データ統合・差分分析</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h4 class="text-xl font-semibold mb-3 text-gray-600">複雑な結合の実例</h4>
                <div class="code-block">
<pre>-- ECサイトの売上分析クエリ
SELECT 
    c.customer_name,
    c.email,
    COUNT(o.order_id) as total_orders,
    SUM(oi.quantity * p.price) as total_amount,
    AVG(oi.quantity * p.price) as avg_order_value,
    MAX(o.order_date) as last_order_date
FROM customers c
LEFT JOIN orders o ON c.customer_id = o.customer_id
LEFT JOIN order_items oi ON o.order_id = oi.order_id
LEFT JOIN products p ON oi.product_id = p.product_id
WHERE c.created_at >= '2024-01-01'
GROUP BY c.customer_id, c.customer_name, c.email
HAVING COUNT(o.order_id) > 0
ORDER BY total_amount DESC, last_order_date DESC;</pre>
                </div>
            </div>

            <div class="mb-6">
                <h3 class="text-2xl font-semibold mb-4 text-gray-700">1.2 高度な集計とウィンドウ関数</h3>
                
                <div class="warning-box">
                    <h4 class="font-semibold mb-2">
                        <i class="fas fa-exclamation-triangle mr-2"></i>ウィンドウ関数の活用ポイント
                    </h4>
                    <p>GROUP BYとは異なり、ウィンドウ関数は元の行数を保持しながら集計値を取得できます。</p>
                </div>

                <div class="code-block">
<pre>-- 売上ランキングと前年同月比の算出
SELECT 
    product_name,
    sales_date,
    monthly_sales,
    -- 月次売上ランキング
    ROW_NUMBER() OVER (
        PARTITION BY DATE_TRUNC('month', sales_date) 
        ORDER BY monthly_sales DESC
    ) as monthly_rank,
    -- 累積売上
    SUM(monthly_sales) OVER (
        PARTITION BY product_id 
        ORDER BY sales_date 
        ROWS UNBOUNDED PRECEDING
    ) as cumulative_sales,
    -- 前年同月との比較
    LAG(monthly_sales, 12) OVER (
        PARTITION BY product_id 
        ORDER BY sales_date
    ) as prev_year_same_month,
    -- 前年同月比（％）
    CASE 
        WHEN LAG(monthly_sales, 12) OVER (
            PARTITION BY product_id 
            ORDER BY sales_date
        ) > 0 THEN 
            ROUND(
                (monthly_sales - LAG(monthly_sales, 12) OVER (
                    PARTITION BY product_id 
                    ORDER BY sales_date
                )) * 100.0 / LAG(monthly_sales, 12) OVER (
                    PARTITION BY product_id 
                    ORDER BY sales_date
                ), 2
            )
        ELSE NULL 
    END as yoy_growth_rate
FROM monthly_product_sales
ORDER BY sales_date, monthly_rank;</pre>
                </div>
            </div>

            <div class="mb-6">
                <h3 class="text-2xl font-semibold mb-4 text-gray-700">1.3 サブクエリとCTE（Common Table Expression）</h3>

                <div class="code-block">
<pre>-- 複雑なビジネスロジックをCTEで整理
WITH customer_segments AS (
    -- 顧客セグメント分類
    SELECT 
        customer_id,
        customer_name,
        total_amount,
        CASE 
            WHEN total_amount >= 100000 THEN 'VIP'
            WHEN total_amount >= 50000 THEN 'Premium'
            WHEN total_amount >= 10000 THEN 'Regular'
            ELSE 'Basic'
        END as segment
    FROM (
        SELECT 
            c.customer_id,
            c.customer_name,
            COALESCE(SUM(oi.quantity * p.price), 0) as total_amount
        FROM customers c
        LEFT JOIN orders o ON c.customer_id = o.customer_id
        LEFT JOIN order_items oi ON o.order_id = oi.order_id
        LEFT JOIN products p ON oi.product_id = p.product_id
        WHERE o.order_date >= CURRENT_DATE - INTERVAL '1 year'
        GROUP BY c.customer_id, c.customer_name
    ) customer_totals
),
segment_stats AS (
    -- セグメント別統計
    SELECT 
        segment,
        COUNT(*) as customer_count,
        AVG(total_amount) as avg_amount,
        MIN(total_amount) as min_amount,
        MAX(total_amount) as max_amount
    FROM customer_segments
    GROUP BY segment
)
-- 最終結果：セグメント別詳細レポート
SELECT 
    cs.segment,
    cs.customer_name,
    cs.total_amount,
    ss.customer_count,
    ss.avg_amount,
    ROUND(cs.total_amount / ss.avg_amount * 100, 2) as relative_performance
FROM customer_segments cs
JOIN segment_stats ss ON cs.segment = ss.segment
ORDER BY cs.segment, cs.total_amount DESC;</pre>
                </div>
            </div>
        </section>

        <!-- 2. トランザクション管理 -->
        <section class="mb-8">
            <h2 class="text-3xl font-bold mb-6 text-purple-600">
                <i class="fas fa-lock mr-2"></i>2. トランザクション管理の実践
            </h2>

            <div class="mb-6">
                <h3 class="text-2xl font-semibold mb-4 text-gray-700">2.1 ACID特性の理解と実装</h3>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>ACID特性</th>
                                <th>意味</th>
                                <th>PostgreSQLでの実装</th>
                                <th>実用例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>A</strong>tomicity<br>（原子性）</td>
                                <td>全実行 or 全取消</td>
                                <td>BEGIN/COMMIT/ROLLBACK</td>
                                <td>銀行振込処理</td>
                            </tr>
                            <tr>
                                <td><strong>C</strong>onsistency<br>（一貫性）</td>
                                <td>制約条件の維持</td>
                                <td>CHECK制約、FOREIGN KEY</td>
                                <td>在庫数の非負制約</td>
                            </tr>
                            <tr>
                                <td><strong>I</strong>solation<br>（独立性）</td>
                                <td>同時実行の分離</td>
                                <td>分離レベル設定</td>
                                <td>予約システムの重複防止</td>
                            </tr>
                            <tr>
                                <td><strong>D</strong>urability<br>（永続性）</td>
                                <td>障害時の保持</td>
                                <td>WAL（Write-Ahead Logging）</td>
                                <td>決済完了後の保証</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <h4 class="text-xl font-semibold mb-3 text-gray-600">実践的なトランザクション例</h4>
                <div class="code-block">
<pre>-- ECサイトの注文処理トランザクション
BEGIN;

-- 1. 在庫確認と更新
UPDATE products 
SET stock_quantity = stock_quantity - 2
WHERE product_id = 101 AND stock_quantity >= 2;

-- 在庫不足の場合はエラー
IF NOT FOUND THEN
    ROLLBACK;
    RAISE EXCEPTION '在庫不足: 商品ID 101';
END IF;

-- 2. 注文レコード作成
INSERT INTO orders (customer_id, order_date, status)
VALUES (1001, CURRENT_TIMESTAMP, 'processing')
RETURNING order_id INTO @order_id;

-- 3. 注文明細作成
INSERT INTO order_items (order_id, product_id, quantity, unit_price)
SELECT 
    @order_id,
    101,
    2,
    price
FROM products 
WHERE product_id = 101;

-- 4. 顧客ポイント更新
UPDATE customers 
SET points = points + (
    SELECT price * 2 * 0.01 -- 1%還元
    FROM products 
    WHERE product_id = 101
)
WHERE customer_id = 1001;

-- 5. 全ての処理が成功した場合のみコミット
COMMIT;</pre>
                </div>
            </div>

            <div class="mb-6">
                <h3 class="text-2xl font-semibold mb-4 text-gray-700">2.2 分離レベルとロック制御</h3>

                <div class="warning-box">
                    <h4 class="font-semibold mb-2">
                        <i class="fas fa-exclamation-triangle mr-2"></i>分離レベルの選択指針
                    </h4>
                    <p>パフォーマンスとデータ整合性のバランスを考慮して適切な分離レベルを選択しましょう。</p>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>分離レベル</th>
                                <th>ダーティリード</th>
                                <th>非再現読み取り</th>
                                <th>ファントムリード</th>
                                <th>適用場面</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>READ UNCOMMITTED</td>
                                <td>可能</td>
                                <td>可能</td>
                                <td>可能</td>
                                <td>ログ分析・レポート生成</td>
                            </tr>
                            <tr>
                                <td>READ COMMITTED</td>
                                <td>不可</td>
                                <td>可能</td>
                                <td>可能</td>
                                <td>一般的なWebアプリ</td>
                            </tr>
                            <tr>
                                <td>REPEATABLE READ</td>
                                <td>不可</td>
                                <td>不可</td>
                                <td>可能</td>
                                <td>バッチ処理・集計</td>
                            </tr>
                            <tr>
                                <td>SERIALIZABLE</td>
                                <td>不可</td>
                                <td>不可</td>
                                <td>不可</td>
                                <td>金融取引・在庫管理</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="code-block">
<pre>-- 在庫管理での排他制御例
BEGIN TRANSACTION ISOLATION LEVEL SERIALIZABLE;

-- 明示的ロック取得
SELECT stock_quantity 
FROM products 
WHERE product_id = 101 
FOR UPDATE;

-- 在庫チェックと更新
UPDATE products 
SET stock_quantity = stock_quantity - 1
WHERE product_id = 101 AND stock_quantity > 0;

-- 更新件数チェック
GET DIAGNOSTICS affected_rows = ROW_COUNT;
IF affected_rows = 0 THEN
    ROLLBACK;
    RAISE EXCEPTION '在庫不足または商品が存在しません';
END IF;

COMMIT;</pre>
                </div>
            </div>
        </section>

        <!-- 3. パフォーマンス最適化 -->
        <section class="mb-8">
            <h2 class="text-3xl font-bold mb-6 text-orange-600">
                <i class="fas fa-tachometer-alt mr-2"></i>3. パフォーマンス最適化戦略
            </h2>

            <div class="mb-6">
                <h3 class="text-2xl font-semibold mb-4 text-gray-700">3.1 インデックス設計と最適化</h3>

                <div class="success-box">
                    <h4 class="font-semibold mb-2">
                        <i class="fas fa-lightbulb mr-2"></i>インデックス設計の原則
                    </h4>
                    <ul class="list-disc list-inside space-y-1">
                        <li>検索条件に使用される列にインデックスを作成</li>
                        <li>複合インデックスの列順序は選択性の高い順</li>
                        <li>更新頻度の高いテーブルでは慎重に判断</li>
                        <li>定期的なメンテナンス（REINDEX）を実施</li>
                    </ul>
                </div>

                <div class="code-block">
<pre>-- 効果的なインデックス作成例

-- 1. 単一列インデックス（高い選択性）
CREATE INDEX idx_orders_customer_id ON orders(customer_id);
CREATE INDEX idx_products_category_id ON products(category_id);

-- 2. 複合インデックス（検索条件の組み合わせ）
CREATE INDEX idx_orders_date_status ON orders(order_date, status);
CREATE INDEX idx_order_items_order_product ON order_items(order_id, product_id);

-- 3. 部分インデックス（条件付きインデックス）
CREATE INDEX idx_orders_processing 
ON orders(order_date) 
WHERE status = 'processing';

-- 4. 関数インデックス（計算結果に基づく検索）
CREATE INDEX idx_customers_upper_email 
ON customers(UPPER(email));

-- 5. GINインデックス（全文検索）
CREATE INDEX idx_products_search 
ON products 
USING GIN(to_tsvector('japanese', product_name || ' ' || description));</pre>
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>インデックスタイプ</th>
                                <th>用途</th>
                                <th>利点</th>
                                <th>注意点</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>B-tree（デフォルト）</td>
                                <td>一般的な検索・ソート</td>
                                <td>範囲検索に効果的</td>
                                <td>NULL値は末尾に配置</td>
                            </tr>
                            <tr>
                                <td>Hash</td>
                                <td>等価検索のみ</td>
                                <td>等価条件で高速</td>
                                <td>範囲検索不可</td>
                            </tr>
                            <tr>
                                <td>GIN</td>
                                <td>全文検索・配列</td>
                                <td>複数値の検索</td>
                                <td>更新コストが高い</td>
                            </tr>
                            <tr>
                                <td>GiST</td>
                                <td>地理情報・範囲データ</td>
                                <td>拡張可能</td>
                                <td>設定が複雑</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="mb-6">
                <h3 class="text-2xl font-semibold mb-4 text-gray-700">3.2 クエリ最適化とEXPLAIN分析</h3>

                <div class="code-block">
<pre>-- クエリ実行計画の詳細分析
EXPLAIN (ANALYZE, BUFFERS, FORMAT JSON)
SELECT 
    c.customer_name,
    COUNT(o.order_id) as order_count,
    SUM(oi.quantity * p.price) as total_amount
FROM customers c
JOIN orders o ON c.customer_id = o.customer_id
JOIN order_items oi ON o.order_id = oi.order_id  
JOIN products p ON oi.product_id = p.product_id
WHERE o.order_date >= CURRENT_DATE - INTERVAL '3 months'
GROUP BY c.customer_id, c.customer_name
HAVING SUM(oi.quantity * p.price) > 10000
ORDER BY total_amount DESC;</pre>
                </div>

                <div class="warning-box">
                    <h4 class="font-semibold mb-2">
                        <i class="fas fa-exclamation-triangle mr-2"></i>パフォーマンス問題の特定ポイント
                    </h4>
                    <ul class="list-disc list-inside space-y-1">
                        <li><strong>Seq Scan:</strong> テーブル全体スキャン（インデックス不足）</li>
                        <li><strong>高いcost値:</strong> 処理時間が長い操作</li>
                        <li><strong>多いbuffers:</strong> I/O負荷が高い</li>
                        <li><strong>Hash Join:</strong> 大量データの結合（メモリ不足の可能性）</li>
                    </ul>
                </div>

                <div class="code-block">
<pre>-- パフォーマンス統計とメンテナンス

-- 1. テーブル統計の更新
ANALYZE customers;
ANALYZE orders;
ANALYZE order_items;
ANALYZE products;

-- 2. インデックス使用状況の確認
SELECT 
    schemaname,
    tablename,
    indexname,
    idx_tup_read,
    idx_tup_fetch,
    idx_scan
FROM pg_stat_user_indexes
ORDER BY idx_scan DESC;

-- 3. 未使用インデックスの特定
SELECT 
    schemaname,
    tablename,
    indexname,
    idx_scan
FROM pg_stat_user_indexes
WHERE idx_scan = 0
AND indexname NOT LIKE '%_pkey';

-- 4. インデックスサイズの確認
SELECT 
    indexname,
    pg_size_pretty(pg_relation_size(indexname::regclass)) as size
FROM pg_indexes
WHERE schemaname = 'public'
ORDER BY pg_relation_size(indexname::regclass) DESC;</pre>
                </div>
            </div>

            <div class="mb-6">
                <h3 class="text-2xl font-semibold mb-4 text-gray-700">3.3 PostgreSQL固有の最適化機能</h3>

                <div class="code-block">
<pre>-- PostgreSQL固有機能の活用

-- 1. パーティショニング（範囲分割）
CREATE TABLE orders_partitioned (
    order_id SERIAL,
    customer_id INTEGER,
    order_date DATE,
    status VARCHAR(20)
) PARTITION BY RANGE (order_date);

-- 月別パーティション作成
CREATE TABLE orders_2024_01 PARTITION OF orders_partitioned
FOR VALUES FROM ('2024-01-01') TO ('2024-02-01');

CREATE TABLE orders_2024_02 PARTITION OF orders_partitioned
FOR VALUES FROM ('2024-02-01') TO ('2024-03-01');

-- 2. マテリアライズドビュー（高速集計）
CREATE MATERIALIZED VIEW monthly_sales_summary AS
SELECT 
    DATE_TRUNC('month', o.order_date) as sales_month,
    COUNT(DISTINCT o.customer_id) as unique_customers,
    COUNT(o.order_id) as total_orders,
    SUM(oi.quantity * p.price) as total_sales
FROM orders o
JOIN order_items oi ON o.order_id = oi.order_id
JOIN products p ON oi.product_id = p.product_id
GROUP BY DATE_TRUNC('month', o.order_date);

-- インデックス作成
CREATE INDEX idx_monthly_sales_month ON monthly_sales_summary(sales_month);

-- 定期更新設定
REFRESH MATERIALIZED VIEW CONCURRENTLY monthly_sales_summary;

-- 3. 高度なデータ型活用
-- JSON型での柔軟なデータ格納
CREATE TABLE product_attributes (
    product_id INTEGER,
    attributes JSONB,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- JSONBインデックス
CREATE INDEX idx_product_attrs_gin ON product_attributes USING GIN(attributes);

-- JSON検索例
SELECT product_id, attributes
FROM product_attributes
WHERE attributes @> '{"color": "red", "size": "large"}';

-- 4. 配列型の活用
CREATE TABLE product_tags (
    product_id INTEGER,
    tags TEXT[],
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- 配列検索
SELECT product_id, tags
FROM product_tags
WHERE tags @> ARRAY['electronics', 'smartphone'];</pre>
                </div>
            </div>
        </section>

        <!-- 4. セキュリティ対策 -->
        <section class="mb-8">
            <h2 class="text-3xl font-bold mb-6 text-red-600">
                <i class="fas fa-shield-alt mr-2"></i>4. データベースセキュリティ対策
            </h2>

            <div class="mb-6">
                <h3 class="text-2xl font-semibold mb-4 text-gray-700">4.1 SQLインジェクション対策</h3>

                <div class="warning-box">
                    <h4 class="font-semibold mb-2">
                        <i class="fas fa-exclamation-triangle mr-2"></i>危険なSQL例（絶対に避ける）
                    </h4>
                    <div class="code-block">
<pre>-- ❌ 危険: 直接文字列結合
query = "SELECT * FROM users WHERE email = '" + user_input + "'";

-- 攻撃例: user_input = "admin@example.com'; DROP TABLE users; --"</pre>
                    </div>
                </div>

                <div class="success-box">
                    <h4 class="font-semibold mb-2">
                        <i class="fas fa-check-circle mr-2"></i>安全なSQL実装
                    </h4>
                    <div class="code-block">
<pre>-- ✅ 安全: プリペアドステートメント使用
PREPARE user_search (TEXT) AS
SELECT user_id, username, email, created_at
FROM users 
WHERE email = $1 AND active = true;

EXECUTE user_search('user@example.com');

-- ✅ 安全: パラメータ化クエリ（アプリケーション側）
-- Python例
cursor.execute(
    "SELECT * FROM users WHERE email = %s AND active = %s",
    (email, True)
)

-- ✅ 安全: 関数を使用した入力検証
CREATE OR REPLACE FUNCTION safe_user_search(p_email TEXT)
RETURNS TABLE(user_id INTEGER, username VARCHAR, email VARCHAR, created_at TIMESTAMP WITH TIME ZONE)
LANGUAGE plpgsql
AS $$
BEGIN
    -- 入力値検証
    IF p_email IS NULL OR LENGTH(p_email) = 0 THEN
        RAISE EXCEPTION 'Email address is required';
    END IF;
    
    IF p_email !~ '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$' THEN
        RAISE EXCEPTION 'Invalid email format';
    END IF;
    
    RETURN QUERY
    SELECT u.user_id, u.username, u.email, u.created_at
    FROM users u
    WHERE u.email = p_email AND u.active = true;
END;
$$;</pre>
                    </div>
                </div>
            </div>

            <div class="mb-6">
                <h3 class="text-2xl font-semibold mb-4 text-gray-700">4.2 アクセス制御とロール管理</h3>

                <div class="code-block">
<pre>-- ロールベースアクセス制御の実装

-- 1. 基本ロールの作成
CREATE ROLE app_readonly;
CREATE ROLE app_readwrite;
CREATE ROLE app_admin;

-- 2. 読み取り専用権限設定
GRANT CONNECT ON DATABASE ecommerce TO app_readonly;
GRANT USAGE ON SCHEMA public TO app_readonly;
GRANT SELECT ON ALL TABLES IN SCHEMA public TO app_readonly;
-- 新規テーブルにも自動適用
ALTER DEFAULT PRIVILEGES IN SCHEMA public 
    GRANT SELECT ON TABLES TO app_readonly;

-- 3. 読み書き権限設定
GRANT app_readonly TO app_readwrite;
GRANT INSERT, UPDATE, DELETE ON ALL TABLES IN SCHEMA public TO app_readwrite;
GRANT USAGE, SELECT ON ALL SEQUENCES IN SCHEMA public TO app_readwrite;

-- 4. 管理者権限設定
GRANT app_readwrite TO app_admin;
GRANT CREATE ON SCHEMA public TO app_admin;

-- 5. 具体的なユーザー作成
CREATE USER api_user WITH PASSWORD 'secure_password_123!';
CREATE USER report_user WITH PASSWORD 'report_pass_456!';
CREATE USER admin_user WITH PASSWORD 'admin_pass_789!';

-- 6. ロール割り当て
GRANT app_readwrite TO api_user;
GRANT app_readonly TO report_user;
GRANT app_admin TO admin_user;

-- 7. 行レベルセキュリティ（RLS）の実装
ALTER TABLE orders ENABLE ROW LEVEL SECURITY;

-- 顧客は自分の注文のみ閲覧可能
CREATE POLICY customer_orders ON orders
    FOR ALL TO app_readwrite
    USING (customer_id = current_setting('app.current_customer_id')::INTEGER);

-- 管理者は全件アクセス可能
CREATE POLICY admin_all_orders ON orders
    FOR ALL TO app_admin
    USING (true);</pre>
                </div>
            </div>

            <div class="mb-6">
                <h3 class="text-2xl font-semibold mb-4 text-gray-700">4.3 データ暗号化と監査</h3>

                <div class="code-block">
<pre>-- データ暗号化の実装

-- 1. 機密データの暗号化（pgcrypto拡張使用）
CREATE EXTENSION IF NOT EXISTS pgcrypto;

-- 暗号化関数の作成
CREATE OR REPLACE FUNCTION encrypt_sensitive_data(data TEXT)
RETURNS TEXT
LANGUAGE SQL
AS $$
    SELECT encode(
        pgp_sym_encrypt(data, current_setting('app.encryption_key', true)),
        'base64'
    );
$$;

-- 復号化関数の作成
CREATE OR REPLACE FUNCTION decrypt_sensitive_data(encrypted_data TEXT)
RETURNS TEXT
LANGUAGE SQL
AS $$
    SELECT pgp_sym_decrypt(
        decode(encrypted_data, 'base64'),
        current_setting('app.encryption_key', true)
    );
$$;

-- 2. 個人情報テーブルの設計
CREATE TABLE customer_pii (
    customer_id INTEGER PRIMARY KEY,
    encrypted_ssn TEXT, -- 暗号化された社会保障番号
    encrypted_phone TEXT, -- 暗号化された電話番号
    encrypted_address TEXT, -- 暗号化された住所
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- 3. 監査ログテーブルの作成
CREATE TABLE audit_log (
    log_id SERIAL PRIMARY KEY,
    table_name VARCHAR(50) NOT NULL,
    operation VARCHAR(10) NOT NULL, -- INSERT, UPDATE, DELETE
    old_values JSONB,
    new_values JSONB,
    user_name VARCHAR(100),
    client_ip INET,
    executed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 4. 監査トリガー関数
CREATE OR REPLACE FUNCTION audit_trigger_function()
RETURNS TRIGGER
LANGUAGE plpgsql
AS $$
BEGIN
    IF TG_OP = 'DELETE' THEN
        INSERT INTO audit_log (
            table_name, operation, old_values, user_name, client_ip
        ) VALUES (
            TG_TABLE_NAME,
            TG_OP,
            row_to_json(OLD),
            current_user,
            inet_client_addr()
        );
        RETURN OLD;
    ELSIF TG_OP = 'UPDATE' THEN
        INSERT INTO audit_log (
            table_name, operation, old_values, new_values, user_name, client_ip
        ) VALUES (
            TG_TABLE_NAME,
            TG_OP,
            row_to_json(OLD),
            row_to_json(NEW),
            current_user,
            inet_client_addr()
        );
        RETURN NEW;
    ELSIF TG_OP = 'INSERT' THEN
        INSERT INTO audit_log (
            table_name, operation, new_values, user_name, client_ip
        ) VALUES (
            TG_TABLE_NAME,
            TG_OP,
            row_to_json(NEW),
            current_user,
            inet_client_addr()
        );
        RETURN NEW;
    END IF;
    RETURN NULL;
END;
$$;

-- 5. 監査トリガーの設定
CREATE TRIGGER customers_audit
    AFTER INSERT OR UPDATE OR DELETE ON customers
    FOR EACH ROW EXECUTE FUNCTION audit_trigger_function();

CREATE TRIGGER orders_audit
    AFTER INSERT OR UPDATE OR DELETE ON orders
    FOR EACH ROW EXECUTE FUNCTION audit_trigger_function();</pre>
                </div>
            </div>
        </section>

        <!-- 5. 実践演習 -->
        <section class="mb-8">
            <h2 class="text-3xl font-bold mb-6 text-green-600">
                <i class="fas fa-laptop-code mr-2"></i>5. 実践演習問題
            </h2>

            <div class="mb-6">
                <h3 class="text-2xl font-semibold mb-4 text-gray-700">演習1: 複雑な売上分析クエリ</h3>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h4 class="font-semibold mb-3 text-blue-600">課題内容</h4>
                    <p class="mb-4">以下の要件を満たすSQLクエリを作成してください：</p>
                    <ul class="list-disc list-inside space-y-2 mb-4">
                        <li>過去12ヶ月の月別売上を取得</li>
                        <li>前年同月比の成長率を計算</li>
                        <li>売上上位10商品のランキング</li>
                        <li>顧客セグメント別の売上構成比</li>
                    </ul>
                    
                    <button onclick="toggleAnswer('answer1')" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                        解答例を表示
                    </button>
                    <div sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" id="answer1" class="quiz-answer">
                        <div class="code-block">
<pre>WITH monthly_sales AS (
    SELECT 
        DATE_TRUNC('month', o.order_date) as sales_month,
        SUM(oi.quantity * p.price) as monthly_total,
        COUNT(DISTINCT o.customer_id) as unique_customers
    FROM orders o
    JOIN order_items oi ON o.order_id = oi.order_id
    JOIN products p ON oi.product_id = p.product_id
    WHERE o.order_date >= CURRENT_DATE - INTERVAL '24 months'
    GROUP BY DATE_TRUNC('month', o.order_date)
),
monthly_growth AS (
    SELECT 
        sales_month,
        monthly_total,
        unique_customers,
        LAG(monthly_total, 12) OVER (ORDER BY sales_month) as prev_year_total,
        CASE 
            WHEN LAG(monthly_total, 12) OVER (ORDER BY sales_month) > 0 THEN
                ROUND(
                    (monthly_total - LAG(monthly_total, 12) OVER (ORDER BY sales_month)) * 100.0 
                    / LAG(monthly_total, 12) OVER (ORDER BY sales_month), 
                    2
                )
            ELSE NULL 
        END as yoy_growth_rate
    FROM monthly_sales
)
SELECT 
    TO_CHAR(sales_month, 'YYYY-MM') as month,
    monthly_total,
    unique_customers,
    yoy_growth_rate
FROM monthly_growth
WHERE sales_month >= CURRENT_DATE - INTERVAL '12 months'
ORDER BY sales_month;</pre>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mb-6">
                <h3 class="text-2xl font-semibold mb-4 text-gray-700">演習2: トランザクション設計</h3>
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h4 class="font-semibold mb-3 text-purple-600">課題内容</h4>
                    <p class="mb-4">在庫管理システムで以下の処理を行う安全なトランザクションを設計してください：</p>
                    <ul class="list-disc list-inside space-y-2 mb-4">
                        <li>複数商品の同時購入処理</li>
                        <li>在庫不足時の適切なエラーハンドリング</li>
                        <li>顧客ポイントの自動付与</li>
                        <li>デッドロック防止対策</li>
                    </ul>
                    
                    <button onclick="toggleAnswer('answer2')" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                        解答例を表示
                    </button>
                    <div sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" id="answer2" class="quiz-answer">
                        <div class="code-block">
<pre>-- 複数商品購入の安全なトランザクション
CREATE OR REPLACE FUNCTION process_multi_item_order(
    p_customer_id INTEGER,
    p_items JSONB -- [{"product_id": 101, "quantity": 2}, ...]
)
RETURNS TABLE(order_id INTEGER, total_amount DECIMAL)
LANGUAGE plpgsql
AS $$
DECLARE
    v_order_id INTEGER;
    v_item JSONB;
    v_product_id INTEGER;
    v_quantity INTEGER;
    v_price DECIMAL;
    v_total_amount DECIMAL := 0;
    v_points_earned INTEGER := 0;
BEGIN
    -- 分離レベル設定
    SET TRANSACTION ISOLATION LEVEL SERIALIZABLE;
    
    -- 1. 注文レコード作成
    INSERT INTO orders (customer_id, order_date, status)
    VALUES (p_customer_id, CURRENT_TIMESTAMP, 'processing')
    RETURNING orders.order_id INTO v_order_id;
    
    -- 2. 商品ID順でロック取得（デッドロック防止）
    FOR v_item IN 
        SELECT value 
        FROM jsonb_array_elements(p_items) 
        ORDER BY (value->>'product_id')::INTEGER
    LOOP
        v_product_id := (v_item->>'product_id')::INTEGER;
        v_quantity := (v_item->>'quantity')::INTEGER;
        
        -- 在庫確認と更新（排他ロック）
        SELECT price INTO v_price
        FROM products 
        WHERE product_id = v_product_id 
        FOR UPDATE;
        
        IF NOT FOUND THEN
            RAISE EXCEPTION '商品が存在しません: ID %', v_product_id;
        END IF;
        
        -- 在庫更新
        UPDATE products 
        SET stock_quantity = stock_quantity - v_quantity
        WHERE product_id = v_product_id 
        AND stock_quantity >= v_quantity;
        
        IF NOT FOUND THEN
            RAISE EXCEPTION '在庫不足: 商品ID % (必要数: %)', v_product_id, v_quantity;
        END IF;
        
        -- 注文明細追加
        INSERT INTO order_items (order_id, product_id, quantity, unit_price)
        VALUES (v_order_id, v_product_id, v_quantity, v_price);
        
        -- 合計金額計算
        v_total_amount := v_total_amount + (v_quantity * v_price);
    END LOOP;
    
    -- 3. ポイント計算・付与
    v_points_earned := FLOOR(v_total_amount * 0.01); -- 1%還元
    
    UPDATE customers 
    SET points = points + v_points_earned
    WHERE customer_id = p_customer_id;
    
    -- 4. 注文合計金額更新
    UPDATE orders 
    SET total_amount = v_total_amount
    WHERE orders.order_id = v_order_id;
    
    RETURN QUERY SELECT v_order_id, v_total_amount;
    
EXCEPTION
    WHEN OTHERS THEN
        -- エラー時は自動的にロールバック
        RAISE;
END;
$$;</pre>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 6. 理解度クイズ -->
        <section class="mb-8">
            <h2 class="text-3xl font-bold mb-6 text-indigo-600">
                <i class="fas fa-question-circle mr-2"></i>6. 理解度クイズ
            </h2>

            <div class="space-y-6">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold mb-4 text-gray-700">
                        Q1. 以下のEXPLAIN結果で最も問題となる箇所はどれですか？
                    </h3>
                    <div class="code-block text-sm">
<pre>Seq Scan on orders  (cost=0.00..25000.00 rows=1000000 width=24)
  Filter: (order_date >= '2024-01-01'::date)
  Rows Removed by Filter: 999000</pre>
                    </div>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="radio" name="q1" value="a" class="mr-2">
                            <span>A) コストが高い</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="q1" value="b" class="mr-2">
                            <span>B) Seq Scanが使用されている</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="q1" value="c" class="mr-2">
                            <span>C) フィルター条件で99.9%の行が除外されている</span>
                        </label>
                    </div>
                    <button onclick="toggleAnswer('quiz1')" class="mt-4 bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600">
                        解答を表示
                    </button>
                    <div sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" id="quiz1" class="quiz-answer">
                        <p><strong>正解: C</strong></p>
                        <p>フィルター条件で99.9%の行が除外されているのが最大の問題です。order_date列にインデックスを作成することで、必要な行のみを効率的に取得できます。</p>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold mb-4 text-gray-700">
                        Q2. SERIALIZABLE分離レベルで防げるのはどの現象ですか？
                    </h3>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="radio" name="q2" value="a" class="mr-2">
                            <span>A) ダーティリードのみ</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="q2" value="b" class="mr-2">
                            <span>B) ダーティリードと非再現読み取り</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="q2" value="c" class="mr-2">
                            <span>C) ダーティリード、非再現読み取り、ファントムリード</span>
                        </label>
                    </div>
                    <button onclick="toggleAnswer('quiz2')" class="mt-4 bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600">
                        解答を表示
                    </button>
                    <div sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" id="quiz2" class="quiz-answer">
                        <p><strong>正解: C</strong></p>
                        <p>SERIALIZABLE分離レベルは最も厳密で、ダーティリード、非再現読み取り、ファントムリードのすべてを防ぎます。完全な直列化を保証します。</p>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-semibold mb-4 text-gray-700">
                        Q3. SQLインジェクション対策として最も効果的なのは？
                    </h3>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="radio" name="q3" value="a" class="mr-2">
                            <span>A) 入力値の文字列エスケープ</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="q3" value="b" class="mr-2">
                            <span>B) プリペアドステートメントの使用</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="q3" value="c" class="mr-2">
                            <span>C) ストアドプロシージャの使用</span>
                        </label>
                    </div>
                    <button onclick="toggleAnswer('quiz3')" class="mt-4 bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600">
                        解答を表示
                    </button>
                    <div sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" id="quiz3" class="quiz-answer">
                        <p><strong>正解: B</strong></p>
                        <p>プリペアドステートメント（パラメータ化クエリ）の使用が最も効果的です。SQLとデータを分離することで、悪意のあるSQLコードの実行を根本的に防げます。</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 7. まとめ -->
        <section class="mb-8">
            <h2 class="text-3xl font-bold mb-6 text-gray-700">
                <i class="fas fa-check-circle mr-2"></i>7. まとめ
            </h2>

            <div class="highlight-box">
                <h3 class="text-2xl font-bold mb-4">本日習得した重要ポイント</h3>
                
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="text-xl font-semibold mb-3">
                            <i class="fas fa-code mr-2"></i>応用SQL技術
                        </h4>
                        <ul class="list-disc list-inside space-y-2">
                            <li>複雑な結合とウィンドウ関数の活用</li>
                            <li>CTEによる可読性の高いクエリ作成</li>
                            <li>集計・分析クエリの最適化</li>
                            <li>サブクエリの効果的な使用</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 class="text-xl font-semibold mb-3">
                            <i class="fas fa-lock mr-2"></i>トランザクション管理
                        </h4>
                        <ul class="list-disc list-inside space-y-2">
                            <li>ACID特性の理解と実装</li>
                            <li>分離レベルの適切な選択</li>
                            <li>デッドロック防止策の実践</li>
                            <li>エラーハンドリングの重要性</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 class="text-xl font-semibold mb-3">
                            <i class="fas fa-tachometer-alt mr-2"></i>パフォーマンス最適化
                        </h4>
                        <ul class="list-disc list-inside space-y-2">
                            <li>インデックス設計の原則</li>
                            <li>EXPLAIN分析による問題特定</li>
                            <li>PostgreSQL固有機能の活用</li>
                            <li>定期メンテナンスの重要性</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 class="text-xl font-semibold mb-3">
                            <i class="fas fa-shield-alt mr-2"></i>セキュリティ対策
                        </h4>
                        <ul class="list-disc list-inside space-y-2">
                            <li>SQLインジェクション完全防御</li>
                            <li>ロールベースアクセス制御</li>
                            <li>データ暗号化の実装</li>
                            <li>監査ログの活用</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="success-box mt-6">
                <h3 class="text-xl font-semibold mb-3">
                    <i class="fas fa-graduation-cap mr-2"></i>実務への応用
                </h3>
                <p class="mb-3">本日学んだ技術は以下のような実務場面で活用できます：</p>
                <ul class="list-disc list-inside space-y-1">
                    <li><strong>ECサイト:</strong> 複雑な売上分析と在庫管理システムの構築</li>
                    <li><strong>金融システム:</strong> 厳格なトランザクション管理による取引の安全性確保</li>
                    <li><strong>大規模Webサービス:</strong> パフォーマンス最適化による高速レスポンス実現</li>
                    <li><strong>企業システム:</strong> セキュリティ対策による機密データの保護</li>
                </ul>
            </div>

            <div class="warning-box mt-6">
                <h3 class="text-xl font-semibold mb-3">
                    <i class="fas fa-lightbulb mr-2"></i>継続学習のポイント
                </h3>
                <ul class="list-disc list-inside space-y-1">
                    <li>定期的なパフォーマンス監視と改善活動の実施</li>
                    <li>PostgreSQLの新機能・ベストプラクティスの継続学習</li>
                    <li>実際のプロジェクトでの適用とフィードバック収集</li>
                    <li>セキュリティ脅威の最新情報に基づく対策更新</li>
                </ul>
            </div>
        </section>

        <!-- フッター -->
        <footer class="text-center py-6 border-t border-gray-200">
            <p class="text-gray-600">
                <i class="fas fa-book mr-2"></i>
                ITエンジニア育成カリキュラム - Day43完了
            </p>
            <p class="text-sm text-gray-500 mt-2">
                次回：Day44 サーバーサイド開発入門（Servlet・JSP・JDBC）
            </p>
        </footer>
    </div>

    <script>
        function toggleAnswer(id) {
            const answer = document.getElementById(id);
            if (answer.style.display === 'none' || answer.style.display === '') {
                answer.style.display = 'block';
            } else {
                answer.style.display = 'none';
            }
        }

        // ページ読み込み時にすべての解答を非表示
        document.addEventListener('DOMContentLoaded', function() {
            const answers = document.querySelectorAll('.quiz-answer');
            answers.forEach(answer => {
                answer.style.display = 'none';
            });
        });
    </script>
    </div>
    </main>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDofBwPYXpWxEZvbHS5J6t9J5lQvrkCXGbTVUQv2Lp3g2mHOUtBYpg7IBIyXwcG0jZnT3uOKyvgjGMuNMAoGceBwYagsoNJHVCAb%2FPaqvLYV5na%2BIMsQR3YSXAmFQCBj5ZyE0fjtiTn56F1bU5SxChIU5GmJaJkNt1BrTDSD4UD6fEU8LMmVpILge3HtUXo2mVHDfHsdh2lg6umj%2FbDPmBinQjDfJdWhuKuoQHO0wxJpfVmw1Y5n%2BgZO8YcBrsbqHNozkHY1LWLGZH%2FnG9iPwLdQpRYjxPiw6uFBeWnodyJ5PT0%2FiFo6r0Mm5no%2Fk2TzlMLAhTXRc%2BunsnS3qadQEWI20CzLEVG0n3p%2B81sWOyqXBxn6Drden%2Bw0J93KSgbvkMTg7ZB6%2FqvXA87cfq1u%2FmWTmiUBa%2FxhCryi0VCEhLPCwdAXULyPTgD1Letedc9lRxFycuL%2B6AogH9lge894hixz7%2FPCyYhFEvCLP0gCpRq%2Be0prW%2BdPWC6ZQodGkNMzf1A%3D%3D";
        window.__genspark_locale = "ja-JP";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDofBwPYXpWxEZvbHS5J6t9J5lQvrkCXGbTVUQv2Lp3g2mHOUtBYpg7IBIyXwcG0jZnT3uOKyvgjGMuNMAoGceBwYagsoNJHVCAb/PaqvLYV5na+IMsQR3YSXAmFQCBj5ZyE0fjtiTn56F1bU5SxChIU5GmJaJkNt1BrTDSD4UD6fEU8LMmVpILge3HtUXo2mVHDfHsdh2lg6umj/bDPmBinQjDfJdWhuKuoQHO0wxJpfVmw1Y5n+gZO8YcBrsbqHNozkHY1LWLGZH/nG9iPwLdQpRYjxPiw6uFBeWnodyJ5PT0/iFo6r0Mm5no/k2TzlMLAhTXRc+unsnS3qadQEWI20CzLEVG0n3p+81sWOyqXBxn6Drden+w0J93KSgbvkMTg7ZB6/qvXA87cfq1u/mWTmiUBa/xhCryi0VCEhLPCwdAXULyPTgD1Letedc9lRxFycuL+6AogH9lge894hixz7/PCyYhFEvCLP0gCpRq+e0prW+dPWC6ZQodGkNMzf1A==";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    