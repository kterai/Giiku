<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day17: I/Oストリームとファイル操作</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        .highlight {
            background-color: #fef08a;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 600;
        }
        .code-block {
            background-color: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
        }
        .answer-section {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background-color: #f0fdf4;
            border-radius: 8px;
            border-left: 4px solid #22c55e;
        }
        .instructor-note {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-left: 4px solid #f59e0b;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 8px;
        }
        .student-support {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border-left: 4px solid #3b82f6;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 8px;
        }
        .fixed-nav {
            backdrop-filter: blur(10px);
            background-color: rgba(255, 255, 255, 0.95);
        }
        .nav-link:hover {
            background-color: rgba(59, 130, 246, 0.1);
        }
        .breadcrumb-separator::after {
            content: ">";
            margin: 0 8px;
            color: #9CA3AF;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <nav class="fixed top-0 left-0 right-0 z-50 fixed-nav border-b border-gray-200">
        <div class="bg-blue-600 text-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-12">
                    <div class="flex items-center">
                        <i class="fas fa-graduation-cap mr-2"></i>
                        <span class="font-semibold">ITエンジニア育成カリキュラム</span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <a href="./lecture16.html" class="nav-link px-3 py-1 rounded text-sm hover:bg-blue-700 transition-colors">
                            <i class="fas fa-chevron-left mr-1"></i> 前の講義
                        </a>
                        <a href="./lecture18.html" class="nav-link px-3 py-1 rounded text-sm hover:bg-blue-700 transition-colors">
                            次の講義 <i class="fas fa-chevron-right ml-1"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="bg-white px-4 py-3">
            <div class="max-w-7xl mx-auto">
                <div class="flex items-center justify-between">
                    <div class="flex items-center text-sm text-gray-600">
                        <a href="../index.html" class="hover:text-blue-600"><i class="fas fa-home mr-1"></i>ホーム</a>
                        <span class="breadcrumb-separator"></span>
                        <a href="../month/month1.html" class="hover:text-blue-600">1ヶ月目: Java基礎</a>
                        <span class="breadcrumb-separator"></span>
                        <a href="../week/week4.html" class="hover:text-blue-600">4週目: 総仕上げ</a>
                        <span class="breadcrumb-separator"></span>
                        <span class="font-semibold text-blue-600">17日目: I/Oストリームとファイル操作</span>
                    </div>
                    <div class="flex items-center space-x-3">
                        <a href="../day/day17.html" class="inline-flex items-center px-3 py-1 border border-blue-300 rounded-md text-sm text-blue-600 hover:bg-blue-50 transition-colors">
                            <i class="fas fa-clipboard-list mr-1"></i> 本日の概要
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    <main class="pt-32">
    <header class="bg-blue-800 text-white py-4 shadow-lg">
        <div class="container mx-auto px-4">
            <h1 class="text-2xl md:text-3xl font-bold text-center mb-2">
                <i class="fas fa-file-alt mr-3"></i>
                Day17: I/Oストリームとファイル操作
            </h1>
            <p class="text-center text-blue-200 text-lg">I/Oストリームとファイル操作</p>
            <div class="mt-3 text-center text-sm">
                <span class="bg-blue-700 px-3 py-1 rounded-full mr-2">所要時間: 4時間</span>
                <span class="bg-blue-700 px-3 py-1 rounded-full">対象: 中級者</span>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8">
        <!-- 学習目標 -->
        <section class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">
                <i class="fas fa-target text-green-600 mr-2"></i>本日の学習目標
            </h2>
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <h3 class="text-lg font-semibold text-blue-600 mb-3">知識目標</h3>
                    <ul class="space-y-2">
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mr-2 mt-1"></i>
                            <span><strong>I/Oストリーム</strong>（入出力の流れ）の基本概念を理解</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mr-2 mt-1"></i>
                            <span><strong>バイトストリーム</strong>と<strong>文字ストリーム</strong>の違いと使い分け</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mr-2 mt-1"></i>
                            <span><strong>ファイル操作</strong>（読み取り・書き込み・作成・削除）の実装方法</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-check-circle text-green-500 mr-2 mt-1"></i>
                            <span><strong>try-with-resources</strong>文による適切なリソース管理</span>
                        </li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-purple-600 mb-3">実践目標</h3>
                    <ul class="space-y-2">
                        <li class="flex items-start">
                            <i class="fas fa-code text-purple-500 mr-2 mt-1"></i>
                            <span>テキストファイルの読み書きプログラムを作成できる</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-code text-purple-500 mr-2 mt-1"></i>
                            <span>CSVファイルの処理プログラムを実装できる</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-code text-purple-500 mr-2 mt-1"></i>
                            <span>例外処理を含む安全なファイル操作を実装できる</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-code text-purple-500 mr-2 mt-1"></i>
                            <span>実務で使える汎用的なファイル処理クラスを設計できる</span>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- ITエンジニア豆知識 -->
        <section class="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">
                <i class="fas fa-lightbulb text-yellow-500 mr-2"></i>ITエンジニア豆知識
            </h2>
            <div class="bg-white rounded-lg p-5">
                <h3 class="text-lg font-semibold text-blue-600 mb-3">なぜI/Oストリームが重要なのか？</h3>
                <p class="text-gray-700 mb-4">
                    実際のソフトウェア開発では、データの<span class="highlight">永続化</span>（データを保存すること）や
                    <span class="highlight">外部システムとの連携</span>が不可欠です。Webアプリケーションでは設定ファイルの読み込み、
                    ログファイルの出力、CSVデータのインポート・エクスポートなど、ファイル操作は日常的に使用される技術です。
                </p>
                <div class="bg-blue-50 p-4 rounded-lg">
                    <p class="text-blue-800 font-medium">
                        <i class="fas fa-info-circle mr-2"></i>
                        現代のプログラミングでは「データはメモリではなくファイルに保存する」ことが基本原則。
                        これにより、プログラム終了後もデータが残り、他のプログラムとの連携も可能になります。
                    </p>
                </div>
            </div>
        </section>

        <!-- メイン講義 -->
        <section class="space-y-8">
            <!-- 1. I/Oストリームの基本概念 -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-stream text-blue-600 mr-2"></i>1. I/Oストリームの基本概念
                </h2>
                
                <div class="instructor-note">
                    <h4 class="font-semibold text-orange-800 mb-2">
                        <i class="fas fa-chalkboard-teacher mr-2"></i>講師向け指導ポイント
                    </h4>
                    <p class="text-orange-700">
                        「ストリーム」という概念は初学者には抽象的で理解が困難です。
                        <strong>「川の流れ」のような具体的な比喩</strong>を使って説明し、
                        データが一方向に流れる様子をイメージさせることが重要です。
                    </p>
                </div>

                <h3 class="text-lg font-semibold text-blue-600 mb-3">ストリームとは何か？</h3>
                <p class="text-gray-700 mb-4">
                    <span class="highlight">ストリーム（Stream）</span>とは、データの<strong>「流れ」</strong>を表現する概念です。
                    川の水が上流から下流に向かって流れるように、データもプログラムから外部（ファイルなど）へ、
                    または外部からプログラムへと一方向に流れていきます。
                </p>

                <div class="student-support">
                    <h4 class="font-semibold text-blue-800 mb-2">
                        <i class="fas fa-graduation-cap mr-2"></i>初心者向けの理解のコツ
                    </h4>
                    <p class="text-blue-700 mb-2">
                        <strong>水道の蛇口</strong>をイメージしてください：
                    </p>
                    <ul class="list-disc list-inside text-blue-700 space-y-1">
                        <li><strong>蛇口をひねる</strong> → ストリームを開く（open）</li>
                        <li><strong>水が流れる</strong> → データが流れる（read/write）</li>
                        <li><strong>蛇口を閉める</strong> → ストリームを閉じる（close）</li>
                    </ul>
                </div>

                <h3 class="text-lg font-semibold text-blue-600 mb-3">I/Oストリームの種類比較表</h3>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="border border-gray-300 px-4 py-2 text-left">種類</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">扱うデータ</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">主な用途</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">代表的なクラス</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">実際の使用例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="border border-gray-300 px-4 py-2 font-medium">
                                    <span class="highlight">バイトストリーム</span><br>
                                    <small class="text-gray-600">（生のデータを扱う）</small>
                                </td>
                                <td class="border border-gray-300 px-4 py-2">
                                    バイト単位<br>
                                    <small class="text-gray-600">（0〜255の数値）</small>
                                </td>
                                <td class="border border-gray-300 px-4 py-2">
                                    画像・動画・音声ファイル<br>
                                    バイナリデータ全般
                                </td>
                                <td class="border border-gray-300 px-4 py-2">
                                    FileInputStream<br>
                                    FileOutputStream
                                </td>
                                <td class="border border-gray-300 px-4 py-2">
                                    画像ファイルのコピー<br>
                                    ログファイルの出力
                                </td>
                            </tr>
                            <tr class="bg-gray-50">
                                <td class="border border-gray-300 px-4 py-2 font-medium">
                                    <span class="highlight">文字ストリーム</span><br>
                                    <small class="text-gray-600">（文字を扱う）</small>
                                </td>
                                <td class="border border-gray-300 px-4 py-2">
                                    文字単位<br>
                                    <small class="text-gray-600">（Unicode文字）</small>
                                </td>
                                <td class="border border-gray-300 px-4 py-2">
                                    テキストファイル<br>
                                    設定ファイル（XML, JSON等）
                                </td>
                                <td class="border border-gray-300 px-4 py-2">
                                    FileReader<br>
                                    FileWriter
                                </td>
                                <td class="border border-gray-300 px-4 py-2">
                                    CSVファイルの読み込み<br>
                                    設定ファイルの更新
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="mt-4 p-4 bg-yellow-50 border-l-4 border-yellow-400 rounded">
                    <p class="text-yellow-800">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        <strong>重要：</strong>文字ストリームは内部的にバイトストリームを使用し、
                        文字エンコーディング（UTF-8, Shift_JIS等）の変換を自動で行います。
                        日本語を含むテキストファイルの場合は文字ストリームを使用しましょう。
                    </p>
                </div>
            </div>

            <!-- 2. ファイル読み取り操作 -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-file-import text-green-600 mr-2"></i>2. ファイル読み取り操作
                </h2>

                <div class="instructor-note">
                    <h4 class="font-semibold text-orange-800 mb-2">
                        <i class="fas fa-chalkboard-teacher mr-2"></i>講師向け指導ポイント
                    </h4>
                    <p class="text-orange-700">
                        ファイル読み取りでは<strong>例外処理が必須</strong>であることを強調してください。
                        ファイルが存在しない場合、権限がない場合など、実際の開発で遭遇する問題を具体例で示すことが重要です。
                    </p>
                </div>

                <h3 class="text-lg font-semibold text-blue-600 mb-3">基本的なファイル読み取り</h3>
                
                <h4 class="font-medium text-gray-800 mb-2">1. BufferedReaderを使った行単位の読み取り</h4>
                <div class="code-block mb-4">
<pre>import java.io.*;

public class FileReadExample {
    public static void main(String[] args) {
        // ファイルパスを指定（相対パスまたは絶対パス）
        String filePath = "data/sample.txt";
        
        // try-with-resources文で自動的にリソースを閉じる
        try (BufferedReader reader = new BufferedReader(new FileReader(filePath))) {
            String line;
            int lineNumber = 1;
            
            // 1行ずつ読み取り（nullが返されるまで繰り返し）
            while ((line = reader.readLine()) != null) {
                System.out.println(lineNumber + ": " + line);
                lineNumber++;
            }
            
        } catch (FileNotFoundException e) {
            System.err.println("ファイルが見つかりません: " + filePath);
        } catch (IOException e) {
            System.err.println("ファイル読み取りエラー: " + e.getMessage());
        }
    }
}</pre>
                </div>

                <div class="student-support">
                    <h4 class="font-semibold text-blue-800 mb-2">
                        <i class="fas fa-graduation-cap mr-2"></i>コードの詳細解説
                    </h4>
                    <ul class="list-disc list-inside text-blue-700 space-y-2">
                        <li><strong>BufferedReader</strong>：メモリ上にデータをバッファリング（一時保存）して効率的に読み取る</li>
                        <li><strong>FileReader</strong>：ファイルから文字データを読み取る基本クラス</li>
                        <li><strong>readLine()</strong>：1行を読み取り、ファイル終端に達するとnullを返す</li>
                        <li><strong>try-with-resources</strong>：tryブロック終了時に自動的にclose()メソッドを呼び出す</li>
                    </ul>
                </div>

                <h4 class="font-medium text-gray-800 mb-2 mt-6">2. Files.readAllLines()を使った簡潔な読み取り（Java 7以降）</h4>
                <div class="code-block mb-4">
<pre>import java.nio.file.*;
import java.util.List;

public class ModernFileReadExample {
    public static void main(String[] args) {
        Path filePath = Paths.get("data/sample.txt");
        
        try {
            // ファイル全体を一度にList&lt;String&gt;として読み取り
            List&lt;String&gt; lines = Files.readAllLines(filePath);
            
            // 拡張for文で各行を処理
            for (String line : lines) {
                System.out.println(line);
            }
            
            // または Stream APIを使用（Java 8以降）
            lines.stream()
                 .filter(line -&gt; !line.isEmpty())  // 空行を除外
                 .forEach(System.out::println);
                 
        } catch (IOException e) {
            System.err.println("ファイル読み取りエラー: " + e.getMessage());
        }
    }
}</pre>
                </div>

                <div class="bg-green-50 p-4 rounded-lg border-l-4 border-green-400">
                    <h4 class="font-semibold text-green-800 mb-2">実務での使い分け</h4>
                    <ul class="text-green-700 space-y-1">
                        <li><strong>小さなファイル（数MB以下）</strong>：Files.readAllLines()が簡潔で推奨</li>
                        <li><strong>大きなファイル（数十MB以上）</strong>：BufferedReaderで行単位処理してメモリ効率を重視</li>
                        <li><strong>リアルタイム処理</strong>：BufferedReaderでストリーミング処理</li>
                    </ul>
                </div>
            </div>

            <!-- 3. ファイル書き込み操作 -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-file-export text-red-600 mr-2"></i>3. ファイル書き込み操作
                </h2>

                <h3 class="text-lg font-semibold text-blue-600 mb-3">安全なファイル書き込みの実装</h3>
                
                <h4 class="font-medium text-gray-800 mb-2">1. BufferedWriterを使った効率的な書き込み</h4>
                <div class="code-block mb-4">
<pre>import java.io.*;
import java.time.LocalDateTime;
import java.time.format.DateTimeFormatter;

public class FileWriteExample {
    public static void main(String[] args) {
        String filePath = "output/log.txt";
        
        try (BufferedWriter writer = new BufferedWriter(new FileWriter(filePath, true))) {
            // 追記モード（append = true）でファイルを開く
            
            // 現在時刻を取得してログに記録
            String timestamp = LocalDateTime.now()
                .format(DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss"));
            
            // データを書き込み
            writer.write("[" + timestamp + "] アプリケーション開始");
            writer.newLine(); // 改行を追加
            
            writer.write("[" + timestamp + "] 初期化完了");
            writer.newLine();
            
            // バッファをフラッシュして確実にファイルに書き込み
            writer.flush();
            
            System.out.println("ログファイルに書き込み完了: " + filePath);
            
        } catch (IOException e) {
            System.err.println("ファイル書き込みエラー: " + e.getMessage());
        }
    }
}</pre>
                </div>

                <div class="student-support">
                    <h4 class="font-semibold text-blue-800 mb-2">
                        <i class="fas fa-graduation-cap mr-2"></i>書き込みモードの違い
                    </h4>
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse border border-gray-300 text-sm">
                            <thead class="bg-blue-50">
                                <tr>
                                    <th class="border border-gray-300 px-3 py-2">コード</th>
                                    <th class="border border-gray-300 px-3 py-2">動作</th>
                                    <th class="border border-gray-300 px-3 py-2">既存ファイルがある場合</th>
                                    <th class="border border-gray-300 px-3 py-2">使用場面</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="border border-gray-300 px-3 py-2 font-mono">new FileWriter(path)</td>
                                    <td class="border border-gray-300 px-3 py-2">上書きモード</td>
                                    <td class="border border-gray-300 px-3 py-2 text-red-600">既存内容を削除</td>
                                    <td class="border border-gray-300 px-3 py-2">設定ファイルの更新</td>
                                </tr>
                                <tr class="bg-gray-50">
                                    <td class="border border-gray-300 px-3 py-2 font-mono">new FileWriter(path, true)</td>
                                    <td class="border border-gray-300 px-3 py-2">追記モード</td>
                                    <td class="border border-gray-300 px-3 py-2 text-green-600">既存内容を保持</td>
                                    <td class="border border-gray-300 px-3 py-2">ログファイルの出力</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <h4 class="font-medium text-gray-800 mb-2 mt-6">2. CSVファイルの書き込み例</h4>
                <div class="code-block mb-4">
<pre>import java.io.*;
import java.util.Arrays;
import java.util.List;

public class CSVWriteExample {
    public static void main(String[] args) {
        String csvFilePath = "data/employees.csv";
        
        // 従業員データのリスト
        List&lt;String[]&gt; employees = Arrays.asList(
            new String[]{"ID", "名前", "部署", "年齢"},  // ヘッダー行
            new String[]{"001", "田中太郎", "開発部", "28"},
            new String[]{"002", "佐藤花子", "営業部", "25"},
            new String[]{"003", "山田次郎", "管理部", "35"}
        );
        
        try (BufferedWriter writer = new BufferedWriter(
                new OutputStreamWriter(new FileOutputStream(csvFilePath), "UTF-8"))) {
            
            // BOM（Byte Order Mark）を追加してExcelで正しく表示
            writer.write('\uFEFF');
            
            for (String[] row : employees) {
                // カンマ区切りで行を作成
                writer.write(String.join(",", row));
                writer.newLine();
            }
            
            System.out.println("CSVファイルを作成しました: " + csvFilePath);
            
        } catch (IOException e) {
            System.err.println("CSVファイル作成エラー: " + e.getMessage());
        }
    }
}</pre>
                </div>

                <div class="bg-yellow-50 p-4 rounded-lg border-l-4 border-yellow-400">
                    <p class="text-yellow-800">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        <strong>文字エンコーディングの注意点：</strong>
                        日本語を含むファイルを作成する場合は、OutputStreamWriterで明示的にUTF-8を指定し、
                        Excel対応のためBOM（\uFEFF）を先頭に追加することを推奨します。
                    </p>
                </div>
            </div>

            <!-- 4. try-with-resources文 -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-shield-alt text-purple-600 mr-2"></i>4. try-with-resources文による安全なリソース管理
                </h2>

                <div class="instructor-note">
                    <h4 class="font-semibold text-orange-800 mb-2">
                        <i class="fas fa-chalkboard-teacher mr-2"></i>講師向け指導ポイント
                    </h4>
                    <p class="text-orange-700">
                        リソースリークは実務で重大な問題となります。従来のtry-finally文の問題点を具体例で示し、
                        try-with-resourcesの利点を<strong>メモリ管理</strong>と<strong>パフォーマンス</strong>の観点から説明してください。
                    </p>
                </div>

                <h3 class="text-lg font-semibold text-blue-600 mb-3">リソース管理の重要性</h3>
                <p class="text-gray-700 mb-4">
                    ファイルやネットワーク接続などの<span class="highlight">リソース</span>は、使用後に必ず解放する必要があります。
                    リソースを適切に閉じないと、<strong>メモリリーク</strong>や<strong>ファイルハンドルの枯渇</strong>といった
                    深刻な問題が発生します。
                </p>

                <h4 class="font-medium text-gray-800 mb-2">❌ 従来の方法（推奨されない）</h4>
                <div class="code-block mb-4">
<pre>// 問題のあるコード例
public void badExample() {
    FileReader reader = null;
    try {
        reader = new FileReader("data.txt");
        // ファイル処理...
        
    } catch (IOException e) {
        System.err.println("エラー: " + e.getMessage());
    } finally {
        // nullチェックとclose()が必要
        if (reader != null) {
            try {
                reader.close();  // ここでも例外が発生する可能性
            } catch (IOException e) {
                System.err.println("ファイルクローズエラー: " + e.getMessage());
            }
        }
    }
}</pre>
                </div>

                <h4 class="font-medium text-gray-800 mb-2">✅ try-with-resources（推奨）</h4>
                <div class="code-block mb-4">
<pre>// 推奨されるコード例
public void goodExample() {
    // AutoCloseableを実装したリソースを自動管理
    try (FileReader reader = new FileReader("data.txt");
         BufferedReader bufferedReader = new BufferedReader(reader)) {
        
        // ファイル処理...
        String line = bufferedReader.readLine();
        System.out.println(line);
        
    } catch (IOException e) {
        System.err.println("ファイル処理エラー: " + e.getMessage());
    }
    // try文を抜ける時、自動的にclose()が呼ばれる
}</pre>
                </div>

                <div class="student-support">
                    <h4 class="font-semibold text-blue-800 mb-2">
                        <i class="fas fa-graduation-cap mr-2"></i>try-with-resourcesの利点
                    </h4>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="bg-green-50 p-4 rounded-lg">
                            <h5 class="font-medium text-green-800 mb-2">自動リソース管理</h5>
                            <ul class="text-green-700 text-sm space-y-1">
                                <li>• close()の呼び忘れを防止</li>
                                <li>• 例外発生時も確実にクローズ</li>
                                <li>• 複数リソースの一括管理</li>
                            </ul>
                        </div>
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h5 class="font-medium text-blue-800 mb-2">コードの簡潔性</h5>
                            <ul class="text-blue-700 text-sm space-y-1">
                                <li>• finallyブロックが不要</li>
                                <li>• nullチェックが不要</li>
                                <li>• 可読性の向上</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <h4 class="font-medium text-gray-800 mb-2 mt-6">複数リソースの管理例</h4>
                <div class="code-block mb-4">
<pre>public void copyFile(String sourcePath, String targetPath) {
    // 読み取り用と書き込み用のリソースを同時に管理
    try (FileInputStream input = new FileInputStream(sourcePath);
         FileOutputStream output = new FileOutputStream(targetPath);
         BufferedInputStream bufferedInput = new BufferedInputStream(input);
         BufferedOutputStream bufferedOutput = new BufferedOutputStream(output)) {
        
        byte[] buffer = new byte[1024];
        int bytesRead;
        
        // ファイルをバイト単位でコピー
        while ((bytesRead = bufferedInput.read(buffer)) != -1) {
            bufferedOutput.write(buffer, 0, bytesRead);
        }
        
        System.out.println("ファイルコピー完了: " + sourcePath + " → " + targetPath);
        
    } catch (IOException e) {
        System.err.println("ファイルコピーエラー: " + e.getMessage());
    }
    // 4つのリソースが全て自動的にクローズされる
}</pre>
                </div>
            </div>

            <!-- 5. 実践的なファイル処理例 -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-tools text-indigo-600 mr-2"></i>5. 実践的なファイル処理例
                </h2>

                <h3 class="text-lg font-semibold text-blue-600 mb-3">汎用ファイル処理クラスの設計</h3>
                
                <div class="code-block mb-4">
<pre>import java.io.*;
import java.nio.file.*;
import java.util.List;
import java.util.ArrayList;

/**
 * ファイル処理のユーティリティクラス
 * 実務でよく使用されるファイル操作をまとめたクラス
 */
public class FileUtils {
    
    /**
     * テキストファイルを読み取ってList&lt;String&gt;として返す
     * @param filePath ファイルパス
     * @return 各行をリストとして返す
     * @throws IOException ファイル読み取りエラー
     */
    public static List&lt;String&gt; readTextFile(String filePath) throws IOException {
        List&lt;String&gt; lines = new ArrayList&lt;&gt;();
        
        try (BufferedReader reader = Files.newBufferedReader(Paths.get(filePath))) {
            String line;
            while ((line = reader.readLine()) != null) {
                lines.add(line);
            }
        }
        
        return lines;
    }
    
    /**
     * テキストファイルにList&lt;String&gt;を書き込む
     * @param filePath ファイルパス
     * @param lines 書き込む行のリスト
     * @param append 追記モードの場合true
     * @throws IOException ファイル書き込みエラー
     */
    public static void writeTextFile(String filePath, List&lt;String&gt; lines, boolean append) 
            throws IOException {
        
        Path path = Paths.get(filePath);
        
        // 親ディレクトリが存在しない場合は作成
        Files.createDirectories(path.getParent());
        
        try (BufferedWriter writer = Files.newBufferedWriter(
                path, 
                append ? StandardOpenOption.CREATE, StandardOpenOption.APPEND 
                       : StandardOpenOption.CREATE, StandardOpenOption.TRUNCATE_EXISTING)) {
            
            for (String line : lines) {
                writer.write(line);
                writer.newLine();
            }
        }
    }
    
    /**
     * CSVファイルを読み取って2次元のリストとして返す
     * @param filePath CSVファイルパス
     * @return 各行をString[]のリストとして返す
     * @throws IOException ファイル読み取りエラー
     */
    public static List&lt;String[]&gt; readCSV(String filePath) throws IOException {
        List&lt;String[]&gt; csvData = new ArrayList&lt;&gt;();
        
        try (BufferedReader reader = Files.newBufferedReader(Paths.get(filePath))) {
            String line;
            while ((line = reader.readLine()) != null) {
                // 簡易的なCSV分割（実際はApache Commons CSVなどを使用推奨）
                String[] fields = line.split(",");
                
                // 各フィールドのトリム（前後の空白除去）
                for (int i = 0; i < fields.length; i++) {
                    fields[i] = fields[i].trim();
                }
                
                csvData.add(fields);
            }
        }
        
        return csvData;
    }
    
    /**
     * ファイルの存在確認とサイズ取得
     * @param filePath ファイルパス
     * @return ファイル情報を含む文字列
     */
    public static String getFileInfo(String filePath) {
        Path path = Paths.get(filePath);
        
        if (!Files.exists(path)) {
            return "ファイルが存在しません: " + filePath;
        }
        
        try {
            long size = Files.size(path);
            String readable = Files.isReadable(path) ? "読み取り可能" : "読み取り不可";
            String writable = Files.isWritable(path) ? "書き込み可能" : "書き込み不可";
            
            return String.format("ファイル: %s\nサイズ: %d bytes\n権限: %s, %s", 
                                filePath, size, readable, writable);
                                
        } catch (IOException e) {
            return "ファイル情報取得エラー: " + e.getMessage();
        }
    }
}</pre>
                </div>

                <h4 class="font-medium text-gray-800 mb-2">使用例</h4>
                <div class="code-block mb-4">
<pre>public class FileUtilsExample {
    public static void main(String[] args) {
        try {
            // ファイル情報の確認
            System.out.println(FileUtils.getFileInfo("data/sample.txt"));
            
            // テキストファイルの読み取り
            List&lt;String&gt; lines = FileUtils.readTextFile("data/sample.txt");
            System.out.println("読み取った行数: " + lines.size());
            
            // 処理結果をログファイルに出力
            List&lt;String&gt; logLines = Arrays.asList(
                "[INFO] ファイル処理開始",
                "[INFO] " + lines.size() + "行を処理しました",
                "[INFO] ファイル処理完了"
            );
            
            FileUtils.writeTextFile("logs/process.log", logLines, true);
            
            // CSVファイルの読み取り
            List&lt;String[]&gt; csvData = FileUtils.readCSV("data/employees.csv");
            System.out.println("CSV行数: " + csvData.size());
            
        } catch (IOException e) {
            System.err.println("ファイル処理エラー: " + e.getMessage());
        }
    }
}</pre>
                </div>

                <div class="bg-indigo-50 p-4 rounded-lg border-l-4 border-indigo-400">
                    <h4 class="font-semibold text-indigo-800 mb-2">実務での活用場面</h4>
                    <ul class="text-indigo-700 space-y-1">
                        <li><strong>Webアプリケーション</strong>：設定ファイルの読み込み、ログファイルの出力</li>
                        <li><strong>データ処理</strong>：CSVファイルのインポート・エクスポート</li>
                        <li><strong>バッチ処理</strong>：大量ファイルの一括処理</li>
                        <li><strong>システム監視</strong>：ログファイルの解析とレポート生成</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- 演習問題 -->
        <section class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">
                <i class="fas fa-code text-blue-600 mr-2"></i>演習問題
            </h2>

            <!-- 演習問題1 -->
            <div class="mb-6 p-4 border rounded-lg">
                <h3 class="text-lg font-semibold text-blue-600 mb-3">演習問題1: テキストファイルの統計処理</h3>
                <p class="text-gray-700 mb-3">
                    テキストファイルを読み込んで以下の統計情報を出力するプログラムを作成してください：
                </p>
                <ul class="list-disc list-inside text-gray-700 mb-3 space-y-1">
                    <li>総行数</li>
                    <li>空行の数</li>
                    <li>総文字数（空白含む）</li>
                    <li>最も長い行の文字数</li>
                </ul>
                <p class="text-gray-700 mb-3">
                    <strong>ファイル例:</strong> "sample.txt" に複数行のテキストが含まれているとします。
                    try-with-resources文を使用して安全にファイルを処理してください。
                </p>
                
                <button sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" onclick="showExerciseAnswer(1)" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                    回答例を表示
                </button>
                
                <div sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" id="exerciseAnswer1" class="answer-section">
                    <h4 class="font-semibold text-green-800 mb-2">回答例</h4>
                    <div class="code-block">
<pre>import java.io.*;

public class TextFileStatistics {
    public static void main(String[] args) {
        String filePath = "sample.txt";
        
        int totalLines = 0;
        int emptyLines = 0;
        int totalCharacters = 0;
        int maxLineLength = 0;
        
        try (BufferedReader reader = new BufferedReader(new FileReader(filePath))) {
            String line;
            
            while ((line = reader.readLine()) != null) {
                totalLines++;
                totalCharacters += line.length();
                
                if (line.trim().isEmpty()) {
                    emptyLines++;
                }
                
                if (line.length() > maxLineLength) {
                    maxLineLength = line.length();
                }
            }
            
            // 統計情報の出力
            System.out.println("=== ファイル統計情報 ===");
            System.out.println("ファイル名: " + filePath);
            System.out.println("総行数: " + totalLines);
            System.out.println("空行数: " + emptyLines);
            System.out.println("総文字数: " + totalCharacters);
            System.out.println("最長行の文字数: " + maxLineLength);
            
        } catch (FileNotFoundException e) {
            System.err.println("ファイルが見つかりません: " + filePath);
        } catch (IOException e) {
            System.err.println("ファイル読み取りエラー: " + e.getMessage());
        }
    }
}</pre>
                    </div>
                    <p class="text-green-700 text-sm mt-2">
                        <strong>ポイント:</strong> 
                        line.trim().isEmpty()で空行判定、各行の長さを比較して最大値を記録しています。
                    </p>
                </div>
            </div>

            <!-- 演習問題2 -->
            <div class="mb-6 p-4 border rounded-lg">
                <h3 class="text-lg font-semibold text-blue-600 mb-3">演習問題2: CSVファイルの処理</h3>
                <p class="text-gray-700 mb-3">
                    以下の要件を満たすCSV処理プログラムを作成してください：
                </p>
                <ul class="list-disc list-inside text-gray-700 mb-3 space-y-1">
                    <li>「students.csv」ファイルから学生データ（ID,名前,数学,英語,国語）を読み込み</li>
                    <li>各学生の平均点を計算</li>
                    <li>平均点が80点以上の学生を「results.csv」に出力</li>
                    <li>結果ファイルには「ID,名前,平均点」の形式で保存</li>
                </ul>
                
                <button sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" onclick="showExerciseAnswer(2)" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                    回答例を表示
                </button>
                
                <div sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" id="exerciseAnswer2" class="answer-section">
                    <h4 class="font-semibold text-green-800 mb-2">回答例</h4>
                    <div class="code-block">
<pre>import java.io.*;
import java.util.ArrayList;
import java.util.List;

public class CSVProcessor {
    public static void main(String[] args) {
        String inputFile = "students.csv";
        String outputFile = "results.csv";
        
        List&lt;String&gt; highScoreStudents = new ArrayList&lt;&gt;();
        
        try (BufferedReader reader = new BufferedReader(new FileReader(inputFile))) {
            String line;
            boolean isFirstLine = true;
            
            while ((line = reader.readLine()) != null) {
                // ヘッダー行をスキップ
                if (isFirstLine) {
                    isFirstLine = false;
                    continue;
                }
                
                String[] fields = line.split(",");
                if (fields.length >= 5) {
                    String id = fields[0].trim();
                    String name = fields[1].trim();
                    
                    try {
                        int math = Integer.parseInt(fields[2].trim());
                        int english = Integer.parseInt(fields[3].trim());
                        int japanese = Integer.parseInt(fields[4].trim());
                        
                        // 平均点を計算
                        double average = (math + english + japanese) / 3.0;
                        
                        // 80点以上の学生を結果リストに追加
                        if (average >= 80.0) {
                            String result = String.format("%s,%s,%.1f", id, name, average);
                            highScoreStudents.add(result);
                        }
                        
                    } catch (NumberFormatException e) {
                        System.err.println("数値変換エラー: " + line);
                    }
                }
            }
            
        } catch (IOException e) {
            System.err.println("入力ファイル読み取りエラー: " + e.getMessage());
            return;
        }
        
        // 結果をファイルに出力
        try (BufferedWriter writer = new BufferedWriter(new FileWriter(outputFile))) {
            // ヘッダー行を書き込み
            writer.write("ID,名前,平均点");
            writer.newLine();
            
            // 高得点学生のデータを書き込み
            for (String student : highScoreStudents) {
                writer.write(student);
                writer.newLine();
            }
            
            System.out.println("処理完了: " + highScoreStudents.size() + 
                             "名の高得点学生を " + outputFile + " に出力しました");
                             
        } catch (IOException e) {
            System.err.println("出力ファイル書き込みエラー: " + e.getMessage());
        }
    }
}</pre>
                    </div>
                    <p class="text-green-700 text-sm mt-2">
                        <strong>ポイント:</strong> 
                        NumberFormatExceptionをキャッチして不正なデータをスキップ、
                        String.formatで小数点以下1桁の平均点を整形しています。
                    </p>
                </div>
            </div>

            <!-- 演習問題3 -->
            <div class="mb-6 p-4 border rounded-lg">
                <h3 class="text-lg font-semibold text-blue-600 mb-3">演習問題3: ログファイル解析ツール</h3>
                <p class="text-gray-700 mb-3">
                    Webサーバーのアクセスログファイル「access.log」を解析して、以下の情報を抽出するプログラムを作成してください：
                </p>
                <ul class="list-disc list-inside text-gray-700 mb-3 space-y-1">
                    <li>総アクセス数</li>
                    <li>エラー（4xx, 5xx）のアクセス数</li>
                    <li>最もアクセスが多いIPアドレス（上位3つ）</li>
                    <li>解析結果を「analysis_report.txt」に出力</li>
                </ul>
                <p class="text-gray-700 mb-3 text-sm">
                    <strong>※</strong> ログ形式例: "192.168.1.1 - - [25/Dec/2023:10:00:00 +0000] \"GET /index.html HTTP/1.1\" 200 1024"
                </p>
                
                <button sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" onclick="showExerciseAnswer(3)" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                    回答例を表示
                </button>
                
                <div sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" id="exerciseAnswer3" class="answer-section">
                    <h4 class="font-semibold text-green-800 mb-2">回答例</h4>
                    <div class="code-block">
<pre>import java.io.*;
import java.util.*;
import java.util.stream.Collectors;

public class LogAnalyzer {
    public static void main(String[] args) {
        String logFile = "access.log";
        String reportFile = "analysis_report.txt";
        
        int totalAccess = 0;
        int errorAccess = 0;
        Map&lt;String, Integer&gt; ipCounts = new HashMap&lt;&gt;();
        
        // ログファイルの解析
        try (BufferedReader reader = new BufferedReader(new FileReader(logFile))) {
            String line;
            
            while ((line = reader.readLine()) != null) {
                totalAccess++;
                
                // IPアドレスを抽出（最初のスペースまで）
                String ip = line.split(" ")[0];
                ipCounts.put(ip, ipCounts.getOrDefault(ip, 0) + 1);
                
                // ステータスコードを抽出（" で囲まれた部分の後の数字）
                String[] parts = line.split("\"");
                if (parts.length >= 3) {
                    String[] statusParts = parts[2].trim().split(" ");
                    if (statusParts.length >= 1) {
                        try {
                            int statusCode = Integer.parseInt(statusParts[0]);
                            if (statusCode >= 400) {
                                errorAccess++;
                            }
                        } catch (NumberFormatException e) {
                            // ステータスコード解析失敗時はスキップ
                        }
                    }
                }
            }
            
        } catch (IOException e) {
            System.err.println("ログファイル読み取りエラー: " + e.getMessage());
            return;
        }
        
        // 上位3つのIPアドレスを取得（Stream APIを使用）
        List&lt;Map.Entry&lt;String, Integer&gt;&gt; topIPs = ipCounts.entrySet().stream()
                .sorted(Map.Entry.&lt;String, Integer&gt;comparingByValue().reversed())
                .limit(3)
                .collect(Collectors.toList());
        
        // レポートファイルに結果を出力
        try (BufferedWriter writer = new BufferedWriter(new FileWriter(reportFile))) {
            writer.write("=== アクセスログ解析レポート ===");
            writer.newLine();
            writer.write("解析日時: " + new Date());
            writer.newLine();
            writer.newLine();
            
            writer.write("総アクセス数: " + totalAccess);
            writer.newLine();
            writer.write("エラーアクセス数: " + errorAccess + 
                        String.format(" (%.1f%%)", (double)errorAccess/totalAccess*100));
            writer.newLine();
            writer.newLine();
            
            writer.write("=== 上位IPアドレス ===");
            writer.newLine();
            for (int i = 0; i < topIPs.size(); i++) {
                Map.Entry&lt;String, Integer&gt; entry = topIPs.get(i);
                writer.write(String.format("%d位: %s (%d回)", 
                           i+1, entry.getKey(), entry.getValue()));
                writer.newLine();
            }
            
            System.out.println("解析完了: レポートを " + reportFile + " に出力しました");
            
        } catch (IOException e) {
            System.err.println("レポートファイル書き込みエラー: " + e.getMessage());
        }
    }
}</pre>
                    </div>
                    <p class="text-green-700 text-sm mt-2">
                        <strong>ポイント:</strong> 
                        MapでIPアドレスの出現回数をカウント、Stream APIでソートして上位3つを取得。
                        正規表現を使わずにsplit()で簡易的にログを解析しています。
                    </p>
                </div>
            </div>
        </section>

        <!-- 理解度クイズ -->
        <section class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">
                <i class="fas fa-question-circle text-purple-600 mr-2"></i>理解度クイズ
            </h2>

            <!-- クイズ1 -->
            <div class="mb-6 p-4 border rounded-lg">
                <h3 class="text-lg font-semibold text-purple-600 mb-3">問題1: ストリームの種類</h3>
                <p class="text-gray-700 mb-3">
                    画像ファイル（JPEG）をコピーするプログラムを作成する場合、どのストリームを使用するのが適切ですか？
                </p>
                <div class="space-y-2">
                    <label class="flex items-center">
                        <input type="radio" name="q1" value="a" class="mr-2">
                        <span>A. FileReader と FileWriter</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="q1" value="b" class="mr-2">
                        <span>B. FileInputStream と FileOutputStream</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="q1" value="c" class="mr-2">
                        <span>C. BufferedReader と BufferedWriter</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="q1" value="d" class="mr-2">
                        <span>D. Scanner と PrintWriter</span>
                    </label>
                </div>
                
                <button sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" onclick="showAnswer(1)" class="mt-3 bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
                    回答を表示
                </button>
                
                <div sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" id="answer1" class="answer-section">
                    <h4 class="font-semibold text-green-800 mb-2">正解: B</h4>
                    <p class="text-gray-700">
                        <strong>解説:</strong> 画像ファイルはバイナリデータ（0と1の組み合わせ）なので、
                        <span class="highlight">バイトストリーム</span>を使用する必要があります。
                        FileInputStream/FileOutputStreamはバイト単位でデータを扱うため、
                        画像・音声・動画などのバイナリファイルの処理に適しています。
                        文字ストリーム（A, C, D）はテキストファイル専用です。
                    </p>
                </div>
            </div>

            <!-- クイズ2 -->
            <div class="mb-6 p-4 border rounded-lg">
                <h3 class="text-lg font-semibold text-purple-600 mb-3">問題2: try-with-resources文</h3>
                <p class="text-gray-700 mb-3">
                    try-with-resources文について、正しい説明はどれですか？
                </p>
                <div class="space-y-2">
                    <label class="flex items-center">
                        <input type="radio" name="q2" value="a" class="mr-2">
                        <span>A. finallyブロックでclose()を明示的に呼ぶ必要がある</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="q2" value="b" class="mr-2">
                        <span>B. AutoCloseableを実装したリソースのみ使用可能</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="q2" value="c" class="mr-2">
                        <span>C. 例外が発生してもclose()は呼ばれない</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="q2" value="d" class="mr-2">
                        <span>D. Java 6以前のバージョンでも使用可能</span>
                    </label>
                </div>
                
                <button sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" onclick="showAnswer(2)" class="mt-3 bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
                    回答を表示
                </button>
                
                <div sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" id="answer2" class="answer-section">
                    <h4 class="font-semibold text-green-800 mb-2">正解: B</h4>
                    <p class="text-gray-700">
                        <strong>解説:</strong> try-with-resources文では、
                        <span class="highlight">AutoCloseable</span>インターフェースを実装したリソースのみ使用できます。
                        このインターフェースを実装したクラス（FileReader, FileWriter, BufferedReader等）は、
                        tryブロックを抜ける際に自動的にclose()メソッドが呼ばれます。
                        例外発生時でも確実にクローズされ、finallyブロックでの明示的なclose()は不要です。
                        Java 7以降の機能です。
                    </p>
                </div>
            </div>

            <!-- クイズ3 -->
            <div class="mb-6 p-4 border rounded-lg">
                <h3 class="text-lg font-semibold text-purple-600 mb-3">問題3: ファイル書き込みモード</h3>
                <p class="text-gray-700 mb-3">
                    以下のコードを実行した場合の動作として正しいものはどれですか？
                </p>
                <div class="code-block text-sm mb-3">
<pre>FileWriter writer = new FileWriter("log.txt", true);
writer.write("新しいログエントリ");
writer.close();</pre>
                </div>
                <div class="space-y-2">
                    <label class="flex items-center">
                        <input type="radio" name="q3" value="a" class="mr-2">
                        <span>A. 既存ファイルの内容を削除して新しい内容を書き込む</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="q3" value="b" class="mr-2">
                        <span>B. 既存ファイルの末尾に新しい内容を追加する</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="q3" value="c" class="mr-2">
                        <span>C. ファイルが存在しない場合はエラーが発生する</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="q3" value="d" class="mr-2">
                        <span>D. 書き込み処理は実行されない</span>
                    </label>
                </div>
                
                <button sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" onclick="showAnswer(3)" class="mt-3 bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
                    回答を表示
                </button>
                
                <div sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" id="answer3" class="answer-section">
                    <h4 class="font-semibold text-green-800 mb-2">正解: B</h4>
                    <p class="text-gray-700">
                        <strong>解説:</strong> FileWriterコンストラクタの第2引数に<code>true</code>を指定すると、
                        <span class="highlight">追記モード（append mode）</span>になります。
                        これにより既存ファイルの内容を保持したまま、ファイルの末尾に新しい内容が追加されます。
                        <code>false</code>または引数なしの場合は上書きモードとなり、既存内容は削除されます。
                        ファイルが存在しない場合は自動的に新規作成されます。
                    </p>
                </div>
            </div>

            <!-- クイズ4 -->
            <div class="mb-6 p-4 border rounded-lg">
                <h3 class="text-lg font-semibold text-purple-600 mb-3">問題4: 文字エンコーディング</h3>
                <p class="text-gray-700 mb-3">
                    日本語を含むCSVファイルをExcelで正しく表示するために必要な対応はどれですか？
                </p>
                <div class="space-y-2">
                    <label class="flex items-center">
                        <input type="radio" name="q4" value="a" class="mr-2">
                        <span>A. Shift_JISエンコーディングで保存する</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="q4" value="b" class="mr-2">
                        <span>B. UTF-8エンコーディングでBOM付きで保存する</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="q4" value="c" class="mr-2">
                        <span>C. ASCII文字のみ使用する</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="q4" value="d" class="mr-2">
                        <span>D. 特別な対応は不要</span>
                    </label>
                </div>
                
                <button sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" onclick="showAnswer(4)" class="mt-3 bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
                    回答を表示
                </button>
                
                <div sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" id="answer4" class="answer-section">
                    <h4 class="font-semibold text-green-800 mb-2">正解: B</h4>
                    <p class="text-gray-700">
                        <strong>解説:</strong> Excelで日本語CSVを正しく表示するには、
                        <span class="highlight">UTF-8エンコーディング + BOM（Byte Order Mark）</span>が最も確実です。
                        BOM（\uFEFF）をファイルの先頭に追加することで、Excelが文字エンコーディングを正しく認識します。
                        Shift_JISも可能ですが、文字化けのリスクがあり、UTF-8の方が国際的な標準です。
                        <code>writer.write('\uFEFF');</code>をファイル書き込みの最初に追加しましょう。
                    </p>
                </div>
            </div>

            <!-- クイズ5 -->
            <div class="mb-6 p-4 border rounded-lg">
                <h3 class="text-lg font-semibold text-purple-600 mb-3">問題5: ファイル処理の例外</h3>
                <p class="text-gray-700 mb-3">
                    大きなファイルを処理する際に最も重要な考慮事項はどれですか？
                </p>
                <div class="space-y-2">
                    <label class="flex items-center">
                        <input type="radio" name="q5" value="a" class="mr-2">
                        <span>A. ファイル全体をメモリに読み込んで一括処理する</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="q5" value="b" class="mr-2">
                        <span>B. 行単位または小さなブロック単位で逐次処理する</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="q5" value="c" class="mr-2">
                        <span>C. 処理速度を優先してBufferedReaderを使わない</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="q5" value="d" class="mr-2">
                        <span>D. 例外処理は不要</span>
                    </label>
                </div>
                
                <button sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" onclick="showAnswer(5)" class="mt-3 bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
                    回答を表示
                </button>
                
                <div sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" id="answer5" class="answer-section">
                    <h4 class="font-semibold text-green-800 mb-2">正解: B</h4>
                    <p class="text-gray-700">
                        <strong>解説:</strong> 大きなファイル（数十MB以上）を処理する場合、
                        <span class="highlight">メモリ効率</span>を重視した逐次処理が重要です。
                        ファイル全体をメモリに読み込むとOutOfMemoryErrorの原因となります。
                        BufferedReaderのreadLine()で1行ずつ処理するか、
                        バイトストリームで固定サイズのバッファを使って小さなブロック単位で処理することで、
                        メモリ使用量を一定に保ちながら安全に処理できます。
                    </p>
                </div>
            </div>
        </section>

        <!-- まとめ -->
        <section class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">
                <i class="fas fa-check-circle text-green-600 mr-2"></i>本日のまとめ
            </h2>
            
            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-white p-5 rounded-lg">
                    <h3 class="text-lg font-semibold text-blue-600 mb-3">重要な概念</h3>
                    <ul class="space-y-2 text-gray-700">
                        <li class="flex items-start">
                            <i class="fas fa-arrow-right text-blue-500 mr-2 mt-1"></i>
                            <span><strong>ストリーム</strong>：データの流れを表現する抽象概念</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-arrow-right text-blue-500 mr-2 mt-1"></i>
                            <span><strong>バイト vs 文字</strong>：バイナリデータとテキストデータの適切な使い分け</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-arrow-right text-blue-500 mr-2 mt-1"></i>
                            <span><strong>リソース管理</strong>：try-with-resourcesによる安全なクローズ処理</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-arrow-right text-blue-500 mr-2 mt-1"></i>
                            <span><strong>例外処理</strong>：ファイル操作で発生する可能性のある例外への対応</span>
                        </li>
                    </ul>
                </div>

                <div class="bg-white p-5 rounded-lg">
                    <h3 class="text-lg font-semibold text-green-600 mb-3">実践で使える技術</h3>
                    <ul class="space-y-2 text-gray-700">
                        <li class="flex items-start">
                            <i class="fas fa-code text-green-500 mr-2 mt-1"></i>
                            <span><strong>CSVファイル処理</strong>：ビジネスデータの読み書き</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-code text-green-500 mr-2 mt-1"></i>
                            <span><strong>ログファイル解析</strong>：システム監視とトラブルシューティング</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-code text-green-500 mr-2 mt-1"></i>
                            <span><strong>大容量ファイル処理</strong>：メモリ効率を考慮した実装</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-code text-green-500 mr-2 mt-1"></i>
                            <span><strong>文字エンコーディング</strong>：国際化対応のファイル処理</span>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="mt-6 p-4 bg-blue-100 rounded-lg">
                <h3 class="text-lg font-semibold text-blue-800 mb-2">次回への準備</h3>
                <p class="text-blue-700">
                    <strong>Day18: データベース接続（JDBC）基礎</strong>では、ファイル処理で学んだリソース管理の概念を応用して、
                    データベースとの接続・SQL実行・結果セット処理を学習します。
                    特に<span class="highlight">Connection, Statement, ResultSetの適切なクローズ処理</span>が重要になります。
                </p>
            </div>
        </section>

        <!-- JavaSilver試験対策 -->
        <section class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">
                <i class="fas fa-certificate text-yellow-600 mr-2"></i>JavaSilver試験対策ポイント
            </h2>
            
            <div class="grid md:grid-cols-2 gap-6">
                <div class="p-4 border-l-4 border-yellow-400 bg-yellow-50">
                    <h3 class="font-semibold text-yellow-800 mb-2">頻出問題パターン</h3>
                    <ul class="text-yellow-700 space-y-1 text-sm">
                        <li>• try-with-resourcesの構文と動作</li>
                        <li>• FileReader/FileWriter vs InputStream/OutputStream</li>
                        <li>• リソースクローズのタイミング</li>
                        <li>• 例外処理の記述方法</li>
                        <li>• ファイルパスの指定方法</li>
                    </ul>
                </div>

                <div class="p-4 border-l-4 border-green-400 bg-green-50">
                    <h3 class="font-semibold text-green-800 mb-2">試験対策のコツ</h3>
                    <ul class="text-green-700 space-y-1 text-sm">
                        <li>• バイト/文字ストリームの使い分けを明確に</li>
                        <li>• AutoCloseableインターフェースの理解</li>
                        <li>• 例外の種類（checked/unchecked）を把握</li>
                        <li>• ファイル操作の基本パターンを暗記</li>
                        <li>• 実際にコードを書いて動作確認</li>
                    </ul>
                </div>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-6 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2025 APSA Co.,Ltd. All Rights Reserved.</p>
        </div>
    </footer>
    </main>

    <script>
        function showExerciseAnswer(questionNumber) {
            const answerDiv = document.getElementById('exerciseAnswer' + questionNumber);
            const button = event.target;
            
            if (answerDiv.style.display === 'none' || answerDiv.style.display === '') {
                answerDiv.style.display = 'block';
                button.textContent = '回答例を非表示';
                button.classList.remove('bg-blue-500', 'hover:bg-blue-700');
                button.classList.add('bg-gray-500', 'hover:bg-gray-700');
            } else {
                answerDiv.style.display = 'none';
                button.textContent = '回答例を表示';
                button.classList.remove('bg-gray-500', 'hover:bg-gray-700');
                button.classList.add('bg-blue-500', 'hover:bg-blue-700');
            }
        }

        function showAnswer(questionNumber) {
            const answerDiv = document.getElementById('answer' + questionNumber);
            const button = event.target;
            
            if (answerDiv.style.display === 'none' || answerDiv.style.display === '') {
                answerDiv.style.display = 'block';
                button.textContent = '回答を非表示';
                button.classList.remove('bg-purple-500', 'hover:bg-purple-700');
                button.classList.add('bg-gray-500', 'hover:bg-gray-700');
            } else {
                answerDiv.style.display = 'none';
                button.textContent = '回答を表示';
                button.classList.remove('bg-gray-500', 'hover:bg-gray-700');
                button.classList.add('bg-purple-500', 'hover:bg-purple-700');
            }
        }
    </script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDqvy2USMyz27xq3k%2B7KBcs6D8RS1h7A5ucfJi8%2FnXiBcUxf5byFErh3GufkHT%2Fg66%2B6ovVREOI1dhBdPqxWdfV%2BZ2x3WKA5Af6nYH8aOyV5YXu8U2dBB%2BtdcRiKtxqrLdKU4WfjeNrZ7%2FvH2PaI4lJXit6V%2BNrPHUwJlFPvsIK2yUz1CAxgOqWPKpYgCHQVzVpNnNCCjIlP%2FPqlFR1B%2BCWW0E398RufuVtNIaOqgGhvL5aXrGDrZrQgLobkhzTjCk5m6UUd7ebJhDARS03bTW2nCHGpeq%2BgSoAR7NibCX3bzLVmToz1p00fgtKaVynD%2FyTUyPTCYkjh4aQzReCuPT5cWxqANApda%2FF6UozR%2BdMbD%2FF6HNkkDmDyWEtAKhepzd8IpN3tb8%2F7ueRku0drE4jzk9u1Tep2XRB3kpscmHbpf14Bmq91WNN7GEs5RJ8U7%2FcVJUsVReRyB3QcI4PI2n5dUdF9BGewBWbh985tvxg%2BbnHVJ2Xk2qj4Fh0EIkzNRc2dC5BUNrPojTDnNWCO9JO4%3D";
        window.__genspark_locale = "ja-JP";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDqvy2USMyz27xq3k+7KBcs6D8RS1h7A5ucfJi8/nXiBcUxf5byFErh3GufkHT/g66+6ovVREOI1dhBdPqxWdfV+Z2x3WKA5Af6nYH8aOyV5YXu8U2dBB+tdcRiKtxqrLdKU4WfjeNrZ7/vH2PaI4lJXit6V+NrPHUwJlFPvsIK2yUz1CAxgOqWPKpYgCHQVzVpNnNCCjIlP/PqlFR1B+CWW0E398RufuVtNIaOqgGhvL5aXrGDrZrQgLobkhzTjCk5m6UUd7ebJhDARS03bTW2nCHGpeq+gSoAR7NibCX3bzLVmToz1p00fgtKaVynD/yTUyPTCYkjh4aQzReCuPT5cWxqANApda/F6UozR+dMbD/F6HNkkDmDyWEtAKhepzd8IpN3tb8/7ueRku0drE4jzk9u1Tep2XRB3kpscmHbpf14Bmq91WNN7GEs5RJ8U7/cVJUsVReRyB3QcI4PI2n5dUdF9BGewBWbh985tvxg+bnHVJ2Xk2qj4Fh0EIkzNRc2dC5BUNrPojTDnNWCO9JO4=";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    