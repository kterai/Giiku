<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day52: テスト駆動開発・JUnit・統合テスト</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        .code-block {
            background-color: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 0.375rem;
            padding: 1rem;
            margin: 0.5rem 0;
            overflow-x: auto;
        }
        .hidden {
            display: none;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .fixed-nav {
            backdrop-filter: blur(10px);
            background-color: rgba(255, 255, 255, 0.95);
        }
        .nav-link:hover {
            background-color: rgba(59, 130, 246, 0.1);
        }
        .breadcrumb-separator::after {
            content: ">";
            margin: 0 8px;
            color: #9CA3AF;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <nav class="fixed top-0 left-0 right-0 z-50 fixed-nav border-b border-gray-200">
        <div class="bg-blue-600 text-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-12">
                    <div class="flex items-center">
                        <i class="fas fa-graduation-cap mr-2"></i>
                        <span class="font-semibold">ITエンジニア育成カリキュラム</span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <a href="./lecture51.html" class="nav-link px-3 py-1 rounded text-sm hover:bg-blue-700 transition-colors">
                            <i class="fas fa-chevron-left mr-1"></i> 前の講義
                        </a>
                        <a href="./lecture53.html" class="nav-link px-3 py-1 rounded text-sm hover:bg-blue-700 transition-colors">
                            次の講義 <i class="fas fa-chevron-right ml-1"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="bg-white px-4 py-3">
            <div class="max-w-7xl mx-auto">
                <div class="flex items-center justify-between">
                    <div class="flex items-center text-sm text-gray-600">
                        <a href="../index.html" class="hover:text-blue-600"><i class="fas fa-home mr-1"></i>ホーム</a>
                        <span class="breadcrumb-separator"></span>
                        <a href="../month/month3.html" class="hover:text-blue-600">3ヶ月目: Webアプリケーション開発実践</a>
                        <span class="breadcrumb-separator"></span>
                        <a href="../week/week12.html" class="hover:text-blue-600">12週目: 総合開発</a>
                        <span class="breadcrumb-separator"></span>
                        <span class="font-semibold text-blue-600">52日目: テスト駆動開発・JUnit・統合テスト</span>
                    </div>
                    <div class="flex items-center space-x-3">
                        <a href="../day/day52.html" class="inline-flex items-center px-3 py-1 border border-blue-300 rounded-md text-sm text-blue-600 hover:bg-blue-50 transition-colors">
                            <i class="fas fa-clipboard-list mr-1"></i> 本日の概要
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    <main class="pt-32">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold text-blue-600 mb-4">
                <i class="fas fa-vial mr-3"></i>
                テスト駆動開発・JUnit・統合テスト
            </h1>
            <p class="text-xl text-gray-600">高品質ソフトウェア開発のためのテスト技術完全マスター</p>
            <div class="mt-4 p-4 bg-blue-100 rounded-lg">
                <p class="text-blue-800 font-semibold">
                    <i class="fas fa-graduation-cap mr-2"></i>
                    テストファースト開発で品質向上とバグ削減を実現
                </p>
            </div>
        </header>

        <!-- 推奨開発環境 -->
        <section class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-blue-800 mb-4">
                <i class="fas fa-tools mr-2"></i>推奨開発環境
            </h2>
            <div class="grid md:grid-cols-3 gap-4">
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="font-semibold text-gray-700 mb-2">
                        <i class="fas fa-code mr-2"></i>エディタ
                    </h3>
                    <p class="text-gray-600">IntelliJ IDEA + JUnit 5拡張機能</p>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="font-semibold text-gray-700 mb-2">
                        <i class="fas fa-coffee mr-2"></i>実行環境
                    </h3>
                    <p class="text-gray-600">Java 17 + Maven/Gradle</p>
                </div>
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h3 class="font-semibold text-gray-700 mb-2">
                        <i class="fas fa-vial mr-2"></i>テストツール
                    </h3>
                    <p class="text-gray-600">JUnit 5 + AssertJ + Mockito</p>
                </div>
            </div>
        </section>

        <!-- 本日の学習目標 -->
        <section class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-blue-800 mb-4">
                <i class="fas fa-target mr-2"></i>本日の学習目標
            </h2>
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <h3 class="text-lg font-semibold text-green-700 mb-3">
                        <i class="fas fa-cycle mr-2"></i>TDD（テスト駆動開発）の理念と実践手法
                    </h3>
                    <p class="text-gray-700">Red-Green-Refactorサイクルを<strong>具体例とともに</strong>習得する</p>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-blue-700 mb-3">
                        <i class="fas fa-flask mr-2"></i>JUnit 5（テスティングフレームワーク）の完全活用
                    </h3>
                    <p class="text-gray-700">単体テスト・統合テストを<strong>実際にコーディング</strong>できる</p>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-purple-700 mb-3">
                        <i class="fas fa-robot mr-2"></i>モックテスト・スタブテストの実装技術
                    </h3>
                    <p class="text-gray-700">外部依存を切り離した<strong>実践的なテスト</strong>を作成する</p>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-red-700 mb-3">
                        <i class="fas fa-chart-line mr-2"></i>テストカバレッジとCI/CD統合
                    </h3>
                    <p class="text-gray-700">品質指標の測定と<strong>継続的改善サイクル</strong>を構築する</p>
                </div>
            </div>
        </section>

        <!-- 1. TDD基礎概念とレッド・グリーン・リファクタサイクル -->
        <section class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-blue-800 mb-4">
                <i class="fas fa-recycle mr-2"></i>1. TDD基礎概念とレッド・グリーン・リファクタサイクル
            </h2>
            
            <div class="bg-blue-50 p-4 rounded-lg mb-6">
                <h3 class="text-lg font-semibold text-blue-800 mb-3">TDD (Test-Driven Development - テスト駆動開発) とは？</h3>
                <p class="text-gray-700 mb-4">
                    <strong>TDD（Test-Driven Development：テスト駆動開発）</strong>とは、実装コードを書く前にテストコードを先に書く開発手法です。
                    まるで設計図を先に描いてから建物を建てるように、「期待する動作」を明確にしてからコードを書きます。
                </p>
                
                <div class="grid md:grid-cols-3 gap-4">
                    <div class="bg-red-100 p-4 rounded-lg text-center">
                        <div class="text-red-600 text-2xl mb-2">🔴</div>
                        <h4 class="font-semibold text-red-800 mb-2">Red（レッド）</h4>
                        <p class="text-sm text-gray-700">失敗するテストを書く<br>（まだ存在しない機能をテスト）</p>
                    </div>
                    <div class="bg-green-100 p-4 rounded-lg text-center">
                        <div class="text-green-600 text-2xl mb-2">🟢</div>
                        <h4 class="font-semibold text-green-800 mb-2">Green（グリーン）</h4>
                        <p class="text-sm text-gray-700">最小限のコードでテストを通す<br>（とりあえず動かす）</p>
                    </div>
                    <div class="bg-blue-100 p-4 rounded-lg text-center">
                        <div class="text-blue-600 text-2xl mb-2">♻️</div>
                        <h4 class="font-semibold text-blue-800 mb-2">Refactor（リファクタ）</h4>
                        <p class="text-sm text-gray-700">重複を除去し、コードを改善<br>（美しく整理する）</p>
                    </div>
                </div>
            </div>

            <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 mb-6">
                <h3 class="text-lg font-semibold text-yellow-800 mb-3">TDDの具体例：計算機クラスの開発</h3>
                <div class="space-y-4">
                    <div>
                        <h4 class="font-semibold text-red-700 mb-2">🔴 Red フェーズ：失敗するテストを書く</h4>
                        <div class="code-block">
                            <pre><code class="language-java">@Test
void shouldAddTwoNumbers() {
    Calculator calculator = new Calculator(); // まだ存在しないクラス
    int result = calculator.add(2, 3);        // まだ存在しないメソッド
    assertEquals(5, result);                  // 期待値：5
}</code></pre>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold text-green-700 mb-2">🟢 Green フェーズ：最小限のコードでテストを通す</h4>
                        <div class="code-block">
                            <pre><code class="language-java">public class Calculator {
    public int add(int a, int b) {
        return 5; // とりあえずテストを通すだけ
    }
}</code></pre>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold text-blue-700 mb-2">♻️ Refactor フェーズ：正しい実装に改善</h4>
                        <div class="code-block">
                            <pre><code class="language-java">public class Calculator {
    public int add(int a, int b) {
        return a + b; // 正しい実装に改善
    }
}</code></pre>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-green-50 p-4 rounded-lg">
                <h3 class="text-lg font-semibold text-green-800 mb-3">TDDのメリット</h3>
                <ul class="list-disc list-inside text-gray-700 space-y-2">
                    <li><strong>要件明確化：</strong>テストを書くことで「何を作るべきか」が明確になる</li>
                    <li><strong>バグ早期発見：</strong>実装と同時にテストが実行されるため、バグを素早く発見</li>
                    <li><strong>リファクタリング安全性：</strong>テストがあることで、安心してコード改善ができる</li>
                    <li><strong>設計改善：</strong>テストしやすいコードは、自然と良い設計になる</li>
                </ul>
            </div>
        </section>

        <!-- 2. JUnit 5・AssertJ完全活用 -->
        <section class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-blue-800 mb-4">
                <i class="fas fa-flask mr-2"></i>2. JUnit 5・AssertJ完全活用
            </h2>

            <div class="bg-blue-50 p-4 rounded-lg mb-6">
                <h3 class="text-lg font-semibold text-blue-800 mb-3">JUnit 5とAssertJの役割</h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <h4 class="font-semibold text-blue-700 mb-2">JUnit 5（ジェイユニット5）</h4>
                        <p class="text-gray-700 mb-2">Javaの標準的なテスティングフレームワーク。テストの実行・管理を担当します。</p>
                        <p class="text-sm text-gray-600">まるでテストの指揮者のような役割</p>
                    </div>
                    <div>
                        <h4 class="font-semibold text-green-700 mb-2">AssertJ（アサートジェー）</h4>
                        <p class="text-gray-700 mb-2">より読みやすく詳細な検証（アサーション）を提供するライブラリ。</p>
                        <p class="text-sm text-gray-600">テストの判定を分かりやすく表現</p>
                    </div>
                </div>
            </div>

            <!-- テストアノテーション比較表 -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">JUnit 5主要アノテーション詳細比較</h3>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="border border-gray-300 px-4 py-2 text-left">アノテーション</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">役割（日本語説明）</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">適用場面</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">実用例</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="border border-gray-300 px-4 py-2 font-mono">@Test</td>
                                <td class="border border-gray-300 px-4 py-2">テストメソッドの指定<br>（このメソッドがテストであることを明示）</td>
                                <td class="border border-gray-300 px-4 py-2">基本的な単体テスト</td>
                                <td class="border border-gray-300 px-4 py-2">計算ロジック検証<br>例外処理確認</td>
                            </tr>
                            <tr class="bg-gray-50">
                                <td class="border border-gray-300 px-4 py-2 font-mono">@ParameterizedTest</td>
                                <td class="border border-gray-300 px-4 py-2">パラメータ化テスト<br>（複数の入力値で同じテストを実行）</td>
                                <td class="border border-gray-300 px-4 py-2">境界値テスト<br>複数パターン確認</td>
                                <td class="border border-gray-300 px-4 py-2">異なる入力値での計算確認<br>バリデーション動作確認</td>
                            </tr>
                            <tr>
                                <td class="border border-gray-300 px-4 py-2 font-mono">@BeforeEach</td>
                                <td class="border border-gray-300 px-4 py-2">各テスト前の準備処理<br>（テストごとに初期化実行）</td>
                                <td class="border border-gray-300 px-4 py-2">テストデータ準備<br>オブジェクト初期化</td>
                                <td class="border border-gray-300 px-4 py-2">データベース初期化<br>モックオブジェクト準備</td>
                            </tr>
                            <tr class="bg-gray-50">
                                <td class="border border-gray-300 px-4 py-2 font-mono">@AfterEach</td>
                                <td class="border border-gray-300 px-4 py-2">各テスト後の清掃処理<br>（テストごとにクリーンアップ実行）</td>
                                <td class="border border-gray-300 px-4 py-2">リソース解放<br>データ削除</td>
                                <td class="border border-gray-300 px-4 py-2">ファイル削除<br>接続クローズ</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- AssertJ vs JUnit比較 -->
            <div class="bg-green-50 p-4 rounded-lg mb-6">
                <h3 class="text-lg font-semibold text-green-800 mb-3">AssertJ vs JUnit標準アサーション比較</h3>
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <h4 class="font-semibold text-red-700 mb-2">JUnit標準（読みにくい）</h4>
                        <div class="code-block">
                            <pre><code class="language-java">assertEquals(5, result);
assertTrue(list.contains("test"));
assertNull(user.getAddress());</code></pre>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold text-green-700 mb-2">AssertJ（読みやすい）</h4>
                        <div class="code-block">
                            <pre><code class="language-java">assertThat(result).isEqualTo(5);
assertThat(list).contains("test");
assertThat(user.getAddress()).isNull();</code></pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 実践例 -->
            <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4">
                <h3 class="text-lg font-semibold text-yellow-800 mb-3">実践例：ユーザー登録機能のテスト</h3>
                <div class="code-block">
                    <pre><code class="language-java">@Test
@DisplayName("有効なユーザー情報で登録が成功する")
void shouldRegisterUserWithValidInformation() {
    // Given（テストデータ準備）
    User newUser = new User("test@example.com", "password123");
    
    // When（テスト対象実行）
    RegistrationResult result = userService.register(newUser);
    
    // Then（結果検証）- AssertJで読みやすく
    assertThat(result.isSuccess()).isTrue();
    assertThat(result.getUserId()).isNotNull();
    assertThat(result.getMessage()).contains("登録完了");
}

@ParameterizedTest
@ValueSource(strings = {"", "   ", "invalid-email"})
@DisplayName("無効なメールアドレスで登録が失敗する")
void shouldFailWithInvalidEmail(String invalidEmail) {
    // Given
    User invalidUser = new User(invalidEmail, "password123");
    
    // When & Then
    assertThatThrownBy(() -> userService.register(invalidUser))
            .isInstanceOf(ValidationException.class)
            .hasMessageContaining("メールアドレス");
}</code></pre>
                </div>
            </div>
        </section>

        <!-- 3. Spring Boot Test・TestContainers統合 -->
        <section class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-blue-800 mb-4">
                <i class="fas fa-cubes mr-2"></i>3. Spring Boot Test・TestContainers統合
            </h2>

            <div class="bg-blue-50 p-4 rounded-lg mb-6">
                <h3 class="text-lg font-semibold text-blue-800 mb-3">統合テストの重要性</h3>
                <p class="text-gray-700 mb-4">
                    単体テストが「部品単体の動作確認」なら、統合テストは「部品を組み合わせた時の動作確認」です。
                    まるで個々の楽器が正しく演奏できても、オーケストラ全体での演奏確認が必要なのと同じです。
                </p>
            </div>

            <!-- テストレベル比較表 -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">テストレベル詳細比較</h3>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="border border-gray-300 px-4 py-2 text-left">テスト種類</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">対象範囲（日本語説明）</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">実行速度</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">実用例</th>
                                <th class="border border-gray-300 px-4 py-2 text-left">使用技術</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="border border-gray-300 px-4 py-2 font-semibold">Unit Test<br>（単体テスト）</td>
                                <td class="border border-gray-300 px-4 py-2">個別メソッドの動作確認<br>（1つの機能だけをテスト）</td>
                                <td class="border border-gray-300 px-4 py-2 text-green-600">高速<br>（ミリ秒）</td>
                                <td class="border border-gray-300 px-4 py-2">計算メソッドの正確性確認<br>バリデーション機能確認</td>
                                <td class="border border-gray-300 px-4 py-2">JUnit 5<br>Mockito</td>
                            </tr>
                            <tr class="bg-gray-50">
                                <td class="border border-gray-300 px-4 py-2 font-semibold">Integration Test<br>（統合テスト）</td>
                                <td class="border border-gray-300 px-4 py-2">複数コンポーネントの連携確認<br>（データベース接続含む）</td>
                                <td class="border border-gray-300 px-4 py-2 text-yellow-600">中速<br>（秒）</td>
                                <td class="border border-gray-300 px-4 py-2">データベース連携処理の確認<br>APIレスポンス検証</td>
                                <td class="border border-gray-300 px-4 py-2">@SpringBootTest<br>TestContainers</td>
                            </tr>
                            <tr>
                                <td class="border border-gray-300 px-4 py-2 font-semibold">E2E Test<br>（エンドツーエンドテスト）</td>
                                <td class="border border-gray-300 px-4 py-2">全システムの動作確認<br>（ユーザー視点での全工程）</td>
                                <td class="border border-gray-300 px-4 py-2 text-red-600">低速<br>（分）</td>
                                <td class="border border-gray-300 px-4 py-2">ユーザー登録から完了まで全工程確認<br>画面遷移テスト</td>
                                <td class="border border-gray-300 px-4 py-2">Selenium<br>Cypress</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Spring Boot Test -->
            <div class="bg-green-50 p-4 rounded-lg mb-6">
                <h3 class="text-lg font-semibold text-green-800 mb-3">Spring Boot Test主要アノテーション</h3>
                <div class="space-y-4">
                    <div>
                        <h4 class="font-semibold text-blue-700 mb-2">@SpringBootTest</h4>
                        <p class="text-gray-700 mb-2">アプリケーション全体のテスト環境を起動（Spring コンテキスト全体をロード）</p>
                        <div class="code-block">
                            <pre><code class="language-java">@SpringBootTest
class UserServiceIntegrationTest {
    @Autowired
    private UserService userService;
    
    @Test
    void shouldSaveUserToDatabase() {
        // 実際のデータベースを使用したテスト
    }
}</code></pre>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold text-purple-700 mb-2">@MockBean</h4>
                        <p class="text-gray-700 mb-2">Spring コンテキスト内でのモックオブジェクト注入（特定の依存関係だけをモック化）</p>
                        <div class="code-block">
                            <pre><code class="language-java">@SpringBootTest
class OrderServiceTest {
    @MockBean
    private PaymentService paymentService; // 決済サービスをモック化
    
    @Autowired
    private OrderService orderService;     // テスト対象は実物使用
}</code></pre>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TestContainers -->
            <div class="bg-purple-50 p-4 rounded-lg">
                <h3 class="text-lg font-semibold text-purple-800 mb-3">TestContainers（テストコンテナーズ）実践</h3>
                <p class="text-gray-700 mb-4">
                    <strong>TestContainers</strong>は、Dockerコンテナを使って実際のデータベースでテストを実行するツールです。
                    まるで「テスト専用の本物のデータベース」を毎回新しく用意してくれる便利な仕組みです。
                </p>
                
                <div class="code-block">
                    <pre><code class="language-java">@SpringBootTest
@Testcontainers
class UserRepositoryIntegrationTest {
    
    @Container
    static PostgreSQLContainer<?> postgres = new PostgreSQLContainer<>("postgres:13")
            .withDatabaseName("testdb")
            .withUsername("test")
            .withPassword("test");
    
    @DynamicPropertySource
    static void configureProperties(DynamicPropertyRegistry registry) {
        registry.add("spring.datasource.url", postgres::getJdbcUrl);
        registry.add("spring.datasource.username", postgres::getUsername);
        registry.add("spring.datasource.password", postgres::getPassword);
    }
    
    @Autowired
    private UserRepository userRepository;
    
    @Test
    void shouldSaveAndFindUser() {
        // 実際のPostgreSQLコンテナを使用したテスト
        User user = new User("test@example.com", "password");
        userRepository.save(user);
        
        Optional<User> found = userRepository.findByEmail("test@example.com");
        assertThat(found).isPresent();
        assertThat(found.get().getEmail()).isEqualTo("test@example.com");
    }
}</code></pre>
                </div>
                
                <div class="mt-4 bg-white p-3 rounded border-l-4 border-purple-500">
                    <h4 class="font-semibold text-purple-700 mb-2">TestContainersのメリット</h4>
                    <ul class="list-disc list-inside text-gray-700 space-y-1">
                        <li><strong>実環境に近いテスト：</strong>実際のデータベースを使用するため、本番に近い条件でテスト</li>
                        <li><strong>自動セットアップ：</strong>テスト実行時に自動でコンテナが起動・停止</li>
                        <li><strong>環境隔離：</strong>他のテストに影響を与えない独立した環境</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- 4. テストカバレッジと品質管理 -->
        <section class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-blue-800 mb-4">
                <i class="fas fa-chart-line mr-2"></i>4. テストカバレッジと品質管理
            </h2>

            <div class="bg-blue-50 p-4 rounded-lg mb-6">
                <h3 class="text-lg font-semibold text-blue-800 mb-3">テストカバレッジとは？</h3>
                <p class="text-gray-700 mb-4">
                    <strong>テストカバレッジ（Test Coverage：テスト網羅率）</strong>とは、テストがソースコードのどの程度をカバーしているかを示す指標です。
                    まるで「地図上でどの程度の道路を実際に歩いたか」を測るようなものです。
                </p>
            </div>

            <!-- カバレッジ種類と目標値 -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">カバレッジ種類と推奨目標値</h3>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-green-700 mb-3">
                            <i class="fas fa-code mr-2"></i>行カバレッジ（Line Coverage）
                        </h4>
                        <p class="text-gray-700 mb-2">実行されたコード行の割合</p>
                        <div class="bg-white p-2 rounded border-l-4 border-green-500">
                            <p class="font-semibold text-green-800">目標値：80%以上</p>
                            <p class="text-sm text-gray-600">単体テスト: 85%以上<br>統合テスト: 75%以上</p>
                        </div>
                    </div>
                    
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-blue-700 mb-3">
                            <i class="fas fa-sitemap mr-2"></i>分岐カバレッジ（Branch Coverage）
                        </h4>
                        <p class="text-gray-700 mb-2">if文やswitch文の分岐の割合</p>
                        <div class="bg-white p-2 rounded border-l-4 border-blue-500">
                            <p class="font-semibold text-blue-800">目標値：70%以上</p>
                            <p class="text-sm text-gray-600">複雑な条件分岐: 80%以上<br>シンプルな分岐: 60%以上</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- JaCoCoによるカバレッジ測定 -->
            <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 mb-6">
                <h3 class="text-lg font-semibold text-yellow-800 mb-3">JaCoCo（ジャココ）によるカバレッジ測定</h3>
                <p class="text-gray-700 mb-4">
                    <strong>JaCoCo（Java Code Coverage）</strong>は、Javaプロジェクトのテストカバレッジを測定・レポート生成するツールです。
                </p>
                
                <div class="code-block">
                    <pre><code class="language-xml">&lt;!-- Maven pom.xml設定例 --&gt;
&lt;plugin&gt;
    &lt;groupId&gt;org.jacoco&lt;/groupId&gt;
    &lt;artifactId&gt;jacoco-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;0.8.8&lt;/version&gt;
    &lt;executions&gt;
        &lt;execution&gt;
            &lt;goals&gt;
                &lt;goal&gt;prepare-agent&lt;/goal&gt;
            &lt;/goals&gt;
        &lt;/execution&gt;
        &lt;execution&gt;
            &lt;id&gt;report&lt;/id&gt;
            &lt;phase&gt;test&lt;/phase&gt;
            &lt;goals&gt;
                &lt;goal&gt;report&lt;/goal&gt;
            &lt;/goals&gt;
        &lt;/execution&gt;
        &lt;execution&gt;
            &lt;id&gt;check&lt;/id&gt;
            &lt;goals&gt;
                &lt;goal&gt;check&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
                &lt;rules&gt;
                    &lt;rule&gt;
                        &lt;element&gt;CLASS&lt;/element&gt;
                        &lt;limits&gt;
                            &lt;limit&gt;
                                &lt;counter&gt;LINE&lt;/counter&gt;
                                &lt;value&gt;COVEREDRATIO&lt;/value&gt;
                                &lt;minimum&gt;0.80&lt;/minimum&gt;
                            &lt;/limit&gt;
                        &lt;/limits&gt;
                    &lt;/rule&gt;
                &lt;/rules&gt;
            &lt;/configuration&gt;
        &lt;/execution&gt;
    &lt;/executions&gt;
&lt;/plugin&gt;</code></pre>
                </div>
            </div>

            <!-- CI/CD統合 -->
            <div class="bg-purple-50 p-4 rounded-lg">
                <h3 class="text-lg font-semibold text-purple-800 mb-3">CI/CD（継続的インテグレーション・デリバリー）統合</h3>
                <p class="text-gray-700 mb-4">
                    テストをCI/CDパイプラインに統合することで、コードの変更時に自動でテストが実行され、品質を継続的に監視できます。
                </p>
                
                <div class="grid md:grid-cols-2 gap-4">
                    <div class="bg-white p-4 rounded border-l-4 border-green-500">
                        <h4 class="font-semibold text-green-700 mb-2">GitHub Actions例</h4>
                        <div class="code-block text-sm">
                            <pre><code class="language-yaml">name: CI
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          java-version: '17'
      - name: Run tests
        run: mvn test
      - name: Generate coverage report
        run: mvn jacoco:report</code></pre>
                        </div>
                    </div>
                    
                    <div class="bg-white p-4 rounded border-l-4 border-blue-500">
                        <h4 class="font-semibold text-blue-700 mb-2">品質ゲート設定</h4>
                        <ul class="text-sm text-gray-700 space-y-1">
                            <li>• カバレッジ80%未満でビルド失敗</li>
                            <li>• テスト失敗時は自動でSlack通知</li>
                            <li>• プルリクエスト時に必須チェック</li>
                            <li>• 週次での品質レポート生成</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- 5. 演習問題 -->
        <section class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-blue-800 mb-4">
                <i class="fas fa-laptop-code mr-2"></i>5. 演習問題
            </h2>

            <div class="space-y-6">
                <!-- 演習1 -->
                <div class="bg-orange-50 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold text-orange-800 mb-3">
                        <i class="fas fa-tasks mr-2"></i>演習1: TDDで書籍管理システム開発
                    </h3>
                    <p class="text-gray-700 mb-4">
                        TDDアプローチを使って、以下の機能を持つBook（書籍）クラスを開発してください：
                    </p>
                    
                    <div class="bg-white p-4 rounded border-l-4 border-orange-500 mb-4">
                        <h4 class="font-semibold text-orange-700 mb-2">要件</h4>
                        <ul class="list-disc list-inside text-gray-700 space-y-1">
                            <li>書籍情報（タイトル、著者、ISBN、価格）を管理</li>
                            <li>価格に税率を適用して税込価格を計算</li>
                            <li>ISBN形式の妥当性検証（13桁の数字）</li>
                            <li>タイトルや著者の空文字チェック</li>
                        </ul>
                    </div>
                    
                    <button onclick="toggleAnswer('exercise1')" class="bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600">
                        <i class="fas fa-eye mr-2"></i>回答例を表示
                    </button>
                    
                    <div sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" id="exercise1" class="hidden mt-4 fade-in">
                        <div class="bg-gray-100 p-4 rounded">
                            <h4 class="font-semibold text-gray-800 mb-3">回答例: TDDアプローチでの実装</h4>
                            
                            <div class="mb-4">
                                <h5 class="font-semibold text-red-700 mb-2">🔴 Red: 失敗するテストを書く</h5>
                                <div class="code-block">
                                    <pre><code class="language-java">@Test
void shouldCalculateTaxIncludedPrice() {
    Book book = new Book("Java入門", "田中太郎", "9784123456789", 2000);
    
    assertThat(book.getTaxIncludedPrice(0.1)).isEqualTo(2200); // 10%税率
}

@Test
void shouldValidateISBN() {
    assertThatThrownBy(() -> new Book("Test", "Author", "invalid", 1000))
            .isInstanceOf(IllegalArgumentException.class)
            .hasMessageContaining("ISBN");
}</code></pre>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <h5 class="font-semibold text-green-700 mb-2">🟢 Green: 最小限の実装</h5>
                                <div class="code-block">
                                    <pre><code class="language-java">public class Book {
    private String title;
    private String author;
    private String isbn;
    private int price;
    
    public Book(String title, String author, String isbn, int price) {
        if (!isValidISBN(isbn)) {
            throw new IllegalArgumentException("Invalid ISBN format");
        }
        this.title = title;
        this.author = author;
        this.isbn = isbn;
        this.price = price;
    }
    
    public int getTaxIncludedPrice(double taxRate) {
        return (int) (price * (1 + taxRate));
    }
    
    private boolean isValidISBN(String isbn) {
        return isbn != null && isbn.matches("\\d{13}");
    }
}</code></pre>
                                </div>
                            </div>
                            
                            <div>
                                <h5 class="font-semibold text-blue-700 mb-2">♻️ Refactor: コード改善</h5>
                                <p class="text-gray-700 mb-2">バリデーション強化、エラーメッセージ改善、メソッド分割など</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 演習2 -->
                <div class="bg-green-50 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold text-green-800 mb-3">
                        <i class="fas fa-database mr-2"></i>演習2: Spring Boot統合テスト実装
                    </h3>
                    <p class="text-gray-700 mb-4">
                        以下のUserRepositoryとUserServiceについて、TestContainersを使用した統合テストを作成してください：
                    </p>
                    
                    <button onclick="toggleAnswer('exercise2')" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                        <i class="fas fa-eye mr-2"></i>回答例を表示
                    </button>
                    
                    <div sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" id="exercise2" class="hidden mt-4 fade-in">
                        <div class="bg-gray-100 p-4 rounded">
                            <div class="code-block">
                                <pre><code class="language-java">@SpringBootTest
@Testcontainers
class UserServiceIntegrationTest {
    
    @Container
    static PostgreSQLContainer<?> postgres = new PostgreSQLContainer<>("postgres:13");
    
    @DynamicPropertySource
    static void configureProperties(DynamicPropertyRegistry registry) {
        registry.add("spring.datasource.url", postgres::getJdbcUrl);
        registry.add("spring.datasource.username", postgres::getUsername);
        registry.add("spring.datasource.password", postgres::getPassword);
    }
    
    @Autowired
    private UserService userService;
    
    @Autowired
    private UserRepository userRepository;
    
    @Test
    @Transactional
    @Rollback
    void shouldCreateUserWithUniqueEmail() {
        // Given
        CreateUserRequest request = new CreateUserRequest(
            "test@example.com", "TestUser", "password123"
        );
        
        // When
        User createdUser = userService.createUser(request);
        
        // Then
        assertThat(createdUser.getId()).isNotNull();
        assertThat(createdUser.getEmail()).isEqualTo("test@example.com");
        
        // データベースからも確認
        Optional&lt;User&gt; foundUser = userRepository.findByEmail("test@example.com");
        assertThat(foundUser).isPresent();
        assertThat(foundUser.get().getName()).isEqualTo("TestUser");
    }
}</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 6. 理解度クイズ -->
        <section class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-blue-800 mb-4">
                <i class="fas fa-question-circle mr-2"></i>6. 理解度クイズ
            </h2>

            <div class="space-y-6">
                <!-- クイズ1 -->
                <div class="bg-purple-50 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold text-purple-800 mb-3">
                        <i class="fas fa-brain mr-2"></i>クイズ1: TDDサイクルの順序
                    </h3>
                    <p class="text-gray-700 mb-4">TDDの正しいサイクルの順序はどれでしょうか？</p>
                    
                    <div class="space-y-2 mb-4">
                        <label class="flex items-center">
                            <input type="radio" name="quiz1" value="a" class="mr-2">
                            <span>A) Green → Red → Refactor</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="quiz1" value="b" class="mr-2">
                            <span>B) Red → Green → Refactor</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="quiz1" value="c" class="mr-2">
                            <span>C) Refactor → Red → Green</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="quiz1" value="d" class="mr-2">
                            <span>D) Red → Refactor → Green</span>
                        </label>
                    </div>
                    
                    <button sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" onclick="showAnswer('quiz1')" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                        <i class="fas fa-check mr-2"></i>回答を表示
                    </button>
                    
                    <div sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" id="quiz1_answer" class="hidden mt-4 fade-in">
                        <div class="bg-green-100 border-l-4 border-green-500 p-4">
                            <p class="font-semibold text-green-800 mb-2">正解: B) Red → Green → Refactor</p>
                            <p class="text-gray-700">
                                TDDの基本サイクルは：<br>
                                1. <strong>Red</strong>：失敗するテストを書く<br>
                                2. <strong>Green</strong>：最小限のコードでテストを通す<br>
                                3. <strong>Refactor</strong>：コードを改善する<br>
                                この順序により、要件が明確化され、段階的に品質の高いコードが作成されます。
                            </p>
                        </div>
                    </div>
                </div>

                <!-- クイズ2 -->
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold text-blue-800 mb-3">
                        <i class="fas fa-chart-bar mr-2"></i>クイズ2: テストカバレッジの目標値
                    </h3>
                    <p class="text-gray-700 mb-4">一般的に推奨される単体テストの行カバレッジ目標値はどれでしょうか？</p>
                    
                    <div class="space-y-2 mb-4">
                        <label class="flex items-center">
                            <input type="radio" name="quiz2" value="a" class="mr-2">
                            <span>A) 50%以上</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="quiz2" value="b" class="mr-2">
                            <span>B) 70%以上</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="quiz2" value="c" class="mr-2">
                            <span>C) 80%以上</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="quiz2" value="d" class="mr-2">
                            <span>D) 100%（完全カバレッジ）</span>
                        </label>
                    </div>
                    
                    <button sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" onclick="showAnswer('quiz2')" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                        <i class="fas fa-check mr-2"></i>回答を表示
                    </button>
                    
                    <div sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" id="quiz2_answer" class="hidden mt-4 fade-in">
                        <div class="bg-green-100 border-l-4 border-green-500 p-4">
                            <p class="font-semibold text-green-800 mb-2">正解: C) 80%以上</p>
                            <p class="text-gray-700">
                                一般的に単体テストでは<strong>80%以上</strong>の行カバレッジが推奨されます。<br>
                                100%を目指すとコストが高くなりすぎる一方、80%程度あれば主要な機能をカバーできます。<br>
                                ただし、カバレッジ数値だけでなく、テストの品質も重要です。
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 7. まとめ -->
        <section class="bg-blue-50 rounded-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-blue-800 mb-4">
                <i class="fas fa-check-circle mr-2"></i>7. まとめ
            </h2>

            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-white p-4 rounded-lg shadow">
                    <h3 class="text-lg font-semibold text-green-700 mb-3">
                        <i class="fas fa-trophy mr-2"></i>習得した重要ポイント
                    </h3>
                    
                    <div class="space-y-4">
                        <div>
                            <h4 class="font-semibold text-blue-700 mb-2">TDD手法による品質向上</h4>
                            <p class="text-gray-700 text-sm">Red-Green-Refactorサイクルで要件明確化とバグ削減を実現。開発効率向上と保守性確保を同時達成。</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-purple-700 mb-2">JUnit 5・AssertJによる効率的テスト</h4>
                            <p class="text-gray-700 text-sm">パラメータ化テストで境界値確認、AssertJで読みやすい検証コード、モックで外部依存排除を実現。</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-green-700 mb-2">統合テストによる実環境検証</h4>
                            <p class="text-gray-700 text-sm">TestContainersで本物のデータベース使用、Spring Boot Testで全体統合確認を効率的に実行。</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-red-700 mb-2">カバレッジ測定による継続的品質管理</h4>
                            <p class="text-gray-700 text-sm">JaCoCoで80%以上のカバレッジ目標設定、CI/CDで自動品質監視、品質ゲートでリリース品質保証。</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-4 rounded-lg shadow">
                    <h3 class="text-lg font-semibold text-orange-700 mb-3">
                        <i class="fas fa-rocket mr-2"></i>実務での具体的メリット
                    </h3>
                    
                    <div class="space-y-4">
                        <div>
                            <h4 class="font-semibold text-green-700 mb-2">バグ発生率削減</h4>
                            <p class="text-gray-700 text-sm">TDD導入により本番バグ発生率を<strong>60%以上削減</strong>、デバッグ時間短縮で開発速度向上。</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-blue-700 mb-2">リファクタリング安全性確保</h4>
                            <p class="text-gray-700 text-sm">包括的なテストスイートにより、安心してコード改善・機能追加が可能。技術的負債削減。</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-purple-700 mb-2">チームでの品質標準化</h4>
                            <p class="text-gray-700 text-sm">テストファーストでコード設計が統一され、レビュー効率向上とチーム全体のスキル底上げ。</p>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-red-700 mb-2">継続的デリバリー実現</h4>
                            <p class="text-gray-700 text-sm">自動テスト基盤により、安全で高頻度なリリースが可能。市場への迅速な価値提供。</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="mt-6 bg-yellow-100 border-l-4 border-yellow-500 p-4">
                <h3 class="text-lg font-semibold text-yellow-800 mb-2">
                    <i class="fas fa-lightbulb mr-2"></i>次のステップ
                </h3>
                <p class="text-gray-700">
                    次は<strong>CI/CD・Docker・Kubernetes・DevOps</strong>について学習し、
                    テスト自動化をデプロイメントパイプラインに統合して、さらなる開発効率化を目指しましょう。
                </p>
            </div>
        </section>

        <!-- Footer -->
        <footer class="text-center mt-12 pt-8 border-t border-gray-200">
            <p class="text-gray-500 mb-4">
                <i class="fas fa-graduation-cap mr-2"></i>
                高品質ソフトウェア開発のためのテスト技術を完全マスター
            </p>
            <p class="text-gray-400">© 2025 APSA Co.,Ltd. All Rights Reserved.</p>
        </footer>
    </div>
    </main>

    <script>
        function toggleAnswer(id) {
            const element = document.getElementById(id);
            if (element.classList.contains('hidden')) {
                element.classList.remove('hidden');
                element.classList.add('fade-in');
            } else {
                element.classList.add('hidden');
                element.classList.remove('fade-in');
            }
        }

        function showAnswer(quizId) {
            const answerId = quizId + '_answer';
            const element = document.getElementById(answerId);
            if (element.classList.contains('hidden')) {
                element.classList.remove('hidden');
                element.classList.add('fade-in');
            }
        }

        // ページ読み込み時の初期化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Day52: テスト駆動開発・JUnit・統合テスト 講義ページ読み込み完了');
        });
    </script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDuusFF6MjGqs7WUvKyfz0wy5mTlLdR2Nse9Iwwll1umu%2BzRJl2jisNNgLSvC0p3l4%2BsYBCTMEGs4jrMcfBiTLV18pDtGLQa6uAq%2FmxUDX10uwvmQJr7efd3b8AARonBIH1urzFNN%2FoEEGmMXIRgks%2BLPbqDdZqqCIrNh8bMypX6cuDlkh8wA1jd8A5SC3dTT1yLO%2BNahJnu2vEHP9DXbp0QxeLs7e8EwjN0MTh9dqjYT8H%2F%2B35CLBk4C8XzxzJ1u%2BQ%2FArWeRoswS%2FFj7qdi7JYoG%2F%2FtNcoHwO1JYsdi1E6KMcH9OohkvjVpcpQaxssfMuVozd5FXZmw2dfQPl2OXsUUlGOvsLUuNvxyzobxN%2F460rO0xdJqU%2BOnMFG0YNwCtgwFT%2FnxdQ9G6aQZ8mb5U11ZxQwX3s8e9beEpyEGyXh8GKKT0lLKfPP%2FdlvrCWbz7AP75HWisfI76hMNrw0TxH5lLrKJ6HAfxImpTgCaTPd583nEeURW%2Fh7tRHh0%2FkiRTtQ%3D%3D";
        window.__genspark_locale = "ja-JP";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDuusFF6MjGqs7WUvKyfz0wy5mTlLdR2Nse9Iwwll1umu+zRJl2jisNNgLSvC0p3l4+sYBCTMEGs4jrMcfBiTLV18pDtGLQa6uAq/mxUDX10uwvmQJr7efd3b8AARonBIH1urzFNN/oEEGmMXIRgks+LPbqDdZqqCIrNh8bMypX6cuDlkh8wA1jd8A5SC3dTT1yLO+NahJnu2vEHP9DXbp0QxeLs7e8EwjN0MTh9dqjYT8H/+35CLBk4C8XzxzJ1u+Q/ArWeRoswS/Fj7qdi7JYoG//tNcoHwO1JYsdi1E6KMcH9OohkvjVpcpQaxssfMuVozd5FXZmw2dfQPl2OXsUUlGOvsLUuNvxyzobxN/460rO0xdJqU+OnMFG0YNwCtgwFT/nxdQ9G6aQZ8mb5U11ZxQwX3s8e9beEpyEGyXh8GKKT0lLKfPP/dlvrCWbz7AP75HWisfI76hMNrw0TxH5lLrKJ6HAfxImpTgCaTPd583nEeURW/h7tRHh0/kiRTtQ==";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    