<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day41: モダンJavaScript・Web制作実習</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        .hidden-content {
            display: none;
        }
        .show-content {
            display: block;
        }
        .code-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 1rem 0;
        }
        @media (max-width: 768px) {
            .code-comparison {
                grid-template-columns: 1fr;
            }
        }
        .fixed-nav {
            backdrop-filter: blur(10px);
            background-color: rgba(255, 255, 255, 0.95);
        }
        .nav-link:hover {
            background-color: rgba(59, 130, 246, 0.1);
        }
        .breadcrumb-separator::after {
            content: ">";
            margin: 0 8px;
            color: #9CA3AF;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <nav class="fixed top-0 left-0 right-0 z-50 fixed-nav border-b border-gray-200">
        <div class="bg-blue-600 text-white">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-12">
                    <div class="flex items-center">
                        <i class="fas fa-graduation-cap mr-2"></i>
                        <span class="font-semibold">ITエンジニア育成カリキュラム</span>
                    </div>
                    <div class="flex items-center space-x-4">
                        <a href="./lecture40.html" class="nav-link px-3 py-1 rounded text-sm hover:bg-blue-700 transition-colors">
                            <i class="fas fa-chevron-left mr-1"></i> 前の講義
                        </a>
                        <a href="./lecture42.html" class="nav-link px-3 py-1 rounded text-sm hover:bg-blue-700 transition-colors">
                            次の講義 <i class="fas fa-chevron-right ml-1"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="bg-white px-4 py-3">
            <div class="max-w-7xl mx-auto">
                <div class="flex items-center justify-between">
                    <div class="flex items-center text-sm text-gray-600">
                        <a href="../index.html" class="hover:text-blue-600"><i class="fas fa-home mr-1"></i>ホーム</a>
                        <span class="breadcrumb-separator"></span>
                        <a href="../month/month3.html" class="hover:text-blue-600">3ヶ月目: Webアプリケーション開発実践</a>
                        <span class="breadcrumb-separator"></span>
                        <a href="../week/week10.html" class="hover:text-blue-600">10週目: バックエンド基礎</a>
                        <span class="breadcrumb-separator"></span>
                        <span class="font-semibold text-blue-600">41日目: モダンJavaScript・Web制作実習</span>
                    </div>
                    <div class="flex items-center space-x-3">
                        <a href="../day/day41.html" class="inline-flex items-center px-3 py-1 border border-blue-300 rounded-md text-sm text-blue-600 hover:bg-blue-50 transition-colors">
                            <i class="fas fa-clipboard-list mr-1"></i> 本日の概要
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    <main class="pt-32">
    <div class="container mx-auto px-4 py-8">
        <!-- ヘッダー -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <div class="flex items-center mb-4">
                <i class="fas fa-code text-4xl text-blue-600 mr-4"></i>
                <div>
                    <h1 class="text-3xl font-bold text-gray-800">Day41: モダンJavaScript・Web制作実習</h1>
                    <p class="text-gray-600 mt-2">ES6+機能とPromise・async/awaitを活用した実践的Web開発</p>
                </div>
            </div>
        </div>

        <!-- 学習目標 -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-bullseye text-red-600 mr-3"></i>
                本日の学習目標
            </h2>
            <div class="grid md:grid-cols-2 gap-6">
                <div class="space-y-3">
                    <div class="flex items-start">
                        <i class="fas fa-check-circle text-green-500 mr-3 mt-1"></i>
                        <div>
                            <h3 class="font-semibold text-gray-800">ES6+構文を実用レベルで活用</h3>
                            <p class="text-gray-600">アロー関数・分割代入・スプレッド演算子の効果的な使い分けを習得</p>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <i class="fas fa-check-circle text-green-500 mr-3 mt-1"></i>
                        <div>
                            <h3 class="font-semibold text-gray-800">テンプレートリテラルとモジュール</h3>
                            <p class="text-gray-600">文字列処理の効率化とコード分割による保守性向上を実現</p>
                        </div>
                    </div>
                </div>
                <div class="space-y-3">
                    <div class="flex items-start">
                        <i class="fas fa-check-circle text-green-500 mr-3 mt-1"></i>
                        <div>
                            <h3 class="font-semibold text-gray-800">非同期処理の完全習得</h3>
                            <p class="text-gray-600">Promise・async/awaitによるAPI連携とエラーハンドリングをマスター</p>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <i class="fas fa-check-circle text-green-500 mr-3 mt-1"></i>
                        <div>
                            <h3 class="font-semibold text-gray-800">実用的Webアプリ構築</h3>
                            <p class="text-gray-600">天気予報アプリなど、実際に動作するアプリケーションを完成</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 推奨開発環境 -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-laptop-code text-purple-600 mr-3"></i>
                推奨開発環境
            </h2>
            <div class="grid md:grid-cols-3 gap-6">
                <div class="bg-purple-50 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold text-purple-800 mb-2">
                        <i class="fas fa-edit mr-2"></i>エディタ
                    </h3>
                    <p class="text-purple-700">Visual Studio Code + ES6 Snippets拡張機能</p>
                </div>
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold text-blue-800 mb-2">
                        <i class="fas fa-browser mr-2"></i>ブラウザ
                    </h3>
                    <p class="text-blue-700">Google Chrome + Developer Tools</p>
                </div>
                <div class="bg-green-50 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold text-green-800 mb-2">
                        <i class="fas fa-tools mr-2"></i>ツール
                    </h3>
                    <p class="text-green-700">Live Server + Postman（API テスト用）</p>
                </div>
            </div>
        </div>

        <!-- 1. ES6+基本機能の完全理解 -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-magic text-blue-600 mr-3"></i>
                1. ES6+基本機能の完全理解
            </h2>

            <!-- アロー関数 -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold text-blue-800 mb-4">
                    <i class="fas fa-arrow-right text-blue-600 mr-2"></i>
                    アロー関数（Arrow Function）の実用的使い分け
                </h3>
                
                <div class="bg-blue-50 p-4 rounded-lg mb-4">
                    <p class="text-blue-800 mb-2">
                        <strong>アロー関数とは？</strong> ES6で導入された、従来のfunction記法をより簡潔に書ける新しい関数定義方法です。
                        単に短く書けるだけでなく、<code class="bg-blue-200 px-2 py-1 rounded">this</code>の扱いが従来の関数と異なるため、用途に応じた使い分けが重要です。
                    </p>
                </div>

                <h4 class="text-lg font-semibold text-gray-800 mb-3">ES5 vs ES6+ 比較例</h4>
                <div class="code-comparison">
                    <div class="bg-gray-100 p-4 rounded-lg">
                        <h5 class="font-semibold text-gray-700 mb-2">❌ ES5（従来の書き方）</h5>
                        <pre><code class="language-javascript">// 通常の関数
function add(a, b) {
    return a + b;
}

// 配列処理
var numbers = [1, 2, 3, 4, 5];
var doubled = numbers.map(function(num) {
    return num * 2;
});

// コールバック関数
setTimeout(function() {
    console.log('3秒経過しました');
}, 3000);</code></pre>
                    </div>
                    <div class="bg-green-100 p-4 rounded-lg">
                        <h5 class="font-semibold text-green-700 mb-2">✅ ES6+（モダンな書き方）</h5>
                        <pre><code class="language-javascript">// アロー関数
const add = (a, b) => a + b;

// 配列処理（より簡潔）
const numbers = [1, 2, 3, 4, 5];
const doubled = numbers.map(num => num * 2);

// コールバック関数
setTimeout(() => {
    console.log('3秒経過しました');
}, 3000);</code></pre>
                    </div>
                </div>

                <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 mt-4">
                    <h5 class="font-semibold text-yellow-800 mb-2">⚠️ thisの違いに注意</h5>
                    <pre><code class="language-javascript">// オブジェクトのメソッドでは従来の関数を使用
const person = {
    name: '田中',
    greet: function() {
        // 正常動作：thisはpersonオブジェクトを指す
        console.log(`こんにちは、${this.name}です`);
    },
    greetArrow: () => {
        // ❌ 問題：thisはpersonを指さない
        console.log(`こんにちは、${this.name}です`); // undefined
    }
};</code></pre>
                </div>

                <div class="bg-green-50 p-4 rounded-lg mt-4">
                    <h5 class="font-semibold text-green-800 mb-2">✅ アロー関数が適している場面</h5>
                    <ul class="text-green-700 space-y-1">
                        <li>• 配列の処理（map, filter, reduce など）</li>
                        <li>• コールバック関数</li>
                        <li>• 簡単な計算処理</li>
                        <li>• イベントハンドラー（thisが不要な場合）</li>
                    </ul>
                </div>
            </div>

            <!-- 分割代入 -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold text-blue-800 mb-4">
                    <i class="fas fa-puzzle-piece text-blue-600 mr-2"></i>
                    分割代入（Destructuring Assignment）の実践パターン
                </h3>
                
                <div class="bg-blue-50 p-4 rounded-lg mb-4">
                    <p class="text-blue-800 mb-2">
                        <strong>分割代入とは？</strong> オブジェクトや配列から必要な値だけを取り出して変数に代入する記法です。
                        まるで荷物の中から必要なものだけを取り出すように、データ構造から特定の値を効率的に抽出できます。
                    </p>
                </div>

                <h4 class="text-lg font-semibold text-gray-800 mb-3">オブジェクトの分割代入</h4>
                <div class="code-comparison">
                    <div class="bg-gray-100 p-4 rounded-lg">
                        <h5 class="font-semibold text-gray-700 mb-2">❌ ES5（従来の書き方）</h5>
                        <pre><code class="language-javascript">// ユーザー情報の取得
var user = {
    name: '田中太郎',
    email: 'tanaka@example.com',
    age: 25,
    address: '東京都渋谷区'
};

var name = user.name;
var email = user.email;
var age = user.age;

console.log(name, email, age);</code></pre>
                    </div>
                    <div class="bg-green-100 p-4 rounded-lg">
                        <h5 class="font-semibold text-green-700 mb-2">✅ ES6+（分割代入）</h5>
                        <pre><code class="language-javascript">// ユーザー情報の取得
const user = {
    name: '田中太郎',
    email: 'tanaka@example.com',
    age: 25,
    address: '東京都渋谷区'
};

// 一行で複数の値を取得
const { name, email, age } = user;

console.log(name, email, age);</code></pre>
                    </div>
                </div>

                <h4 class="text-lg font-semibold text-gray-800 mb-3 mt-6">配列の分割代入</h4>
                <pre class="bg-gray-900 text-green-400 p-4 rounded-lg"><code class="language-javascript">// 配列の分割代入
const colors = ['赤', '青', '緑', '黄'];
const [first, second, ...rest] = colors;

console.log(first);  // '赤'
console.log(second); // '青'
console.log(rest);   // ['緑', '黄']

// 値の交換も簡単
let a = 10, b = 20;
[a, b] = [b, a]; // a=20, b=10</code></pre>

                <h4 class="text-lg font-semibold text-gray-800 mb-3 mt-6">関数の引数での分割代入</h4>
                <pre class="bg-gray-900 text-green-400 p-4 rounded-lg"><code class="language-javascript">// 従来の書き方
function showProfile(user) {
    console.log(`名前: ${user.name}`);
    console.log(`年齢: ${user.age}`);
    console.log(`メール: ${user.email}`);
}

// 分割代入を使った書き方
function showProfile({ name, age, email }) {
    console.log(`名前: ${name}`);
    console.log(`年齢: ${age}`);
    console.log(`メール: ${email}`);
}

// デフォルト値も設定可能
function createUser({ name, age = 20, email }) {
    return { name, age, email };
}</code></pre>
            </div>

            <!-- スプレッド演算子 -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold text-blue-800 mb-4">
                    <i class="fas fa-expand-arrows-alt text-blue-600 mr-2"></i>
                    スプレッド演算子（...）の効果的活用法
                </h3>
                
                <div class="bg-blue-50 p-4 rounded-lg mb-4">
                    <p class="text-blue-800 mb-2">
                        <strong>スプレッド演算子とは？</strong> 配列やオブジェクトを「展開」する演算子です。
                        <code class="bg-blue-200 px-2 py-1 rounded">...</code>（3つのドット）で表現し、データを散らばらせるように展開できるため「スプレッド（spread：広げる）」と呼ばれます。
                    </p>
                </div>

                <h4 class="text-lg font-semibold text-gray-800 mb-3">配列の結合・コピー</h4>
                <div class="code-comparison">
                    <div class="bg-gray-100 p-4 rounded-lg">
                        <h5 class="font-semibold text-gray-700 mb-2">❌ ES5（従来の書き方）</h5>
                        <pre><code class="language-javascript">// 配列の結合
var fruits = ['apple', 'banana'];
var vegetables = ['carrot', 'tomato'];
var foods = fruits.concat(vegetables);

// 配列のコピー
var originalArray = [1, 2, 3];
var copiedArray = originalArray.slice();</code></pre>
                    </div>
                    <div class="bg-green-100 p-4 rounded-lg">
                        <h5 class="font-semibold text-green-700 mb-2">✅ ES6+（スプレッド演算子）</h5>
                        <pre><code class="language-javascript">// 配列の結合
const fruits = ['apple', 'banana'];
const vegetables = ['carrot', 'tomato'];
const foods = [...fruits, ...vegetables];

// 配列のコピー
const originalArray = [1, 2, 3];
const copiedArray = [...originalArray];</code></pre>
                    </div>
                </div>

                <h4 class="text-lg font-semibold text-gray-800 mb-3 mt-6">オブジェクトの結合・更新</h4>
                <pre class="bg-gray-900 text-green-400 p-4 rounded-lg"><code class="language-javascript">// オブジェクトの結合
const basicInfo = { name: '田中', age: 25 };
const contactInfo = { email: 'tanaka@example.com', phone: '090-1234-5678' };
const userProfile = { ...basicInfo, ...contactInfo };

// オブジェクトの一部更新
const user = { name: '田中', age: 25, city: '東京' };
const updatedUser = { ...user, age: 26, country: '日本' };

console.log(updatedUser);
// { name: '田中', age: 26, city: '東京', country: '日本' }</code></pre>

                <h4 class="text-lg font-semibold text-gray-800 mb-3 mt-6">関数の引数での活用</h4>
                <pre class="bg-gray-900 text-green-400 p-4 rounded-lg"><code class="language-javascript">// 最大値を求める
const numbers = [10, 5, 8, 15, 3];
const maxValue = Math.max(...numbers); // Math.max(10, 5, 8, 15, 3)

// 配列を関数の引数として展開
function showColors(color1, color2, color3) {
    console.log(`1番目: ${color1}, 2番目: ${color2}, 3番目: ${color3}`);
}

const colors = ['赤', '青', '緑'];
showColors(...colors); // showColors('赤', '青', '緑')と同じ</code></pre>
            </div>
        </div>

        <!-- 2. テンプレートリテラルとモジュール -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-puzzle-piece text-green-600 mr-3"></i>
                2. テンプレートリテラルとモジュールシステム
            </h2>

            <!-- テンプレートリテラル -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold text-green-800 mb-4">
                    <i class="fas fa-quote-left text-green-600 mr-2"></i>
                    テンプレートリテラル：なぜ文字列結合より優れているか
                </h3>
                
                <div class="bg-green-50 p-4 rounded-lg mb-4">
                    <p class="text-green-800 mb-2">
                        <strong>テンプレートリテラルとは？</strong> バッククォート（`）で囲んだ文字列内で、変数や式を
                        <code class="bg-green-200 px-2 py-1 rounded">${}</code>記法で埋め込める文字列記法です。
                        従来の文字列結合と比べて、読みやすく、改行も自然に扱えます。
                    </p>
                </div>

                <h4 class="text-lg font-semibold text-gray-800 mb-3">文字列結合の比較</h4>
                <div class="code-comparison">
                    <div class="bg-gray-100 p-4 rounded-lg">
                        <h5 class="font-semibold text-gray-700 mb-2">❌ ES5（文字列結合）</h5>
                        <pre><code class="language-javascript">// 複雑な文字列結合
var name = '田中太郎';
var age = 25;
var city = '東京';

var message = 'こんにちは、' + name + 'さん。\n' +
              'あなたは' + age + '歳で、\n' +
              city + '在住ですね。';

// HTML生成
var html = '<div class="user-card">' +
           '<h3>' + name + '</h3>' +
           '<p>年齢: ' + age + '</p>' +
           '<p>居住地: ' + city + '</p>' +
           '</div>';</code></pre>
                    </div>
                    <div class="bg-green-100 p-4 rounded-lg">
                        <h5 class="font-semibold text-green-700 mb-2">✅ ES6+（テンプレートリテラル）</h5>
                        <pre><code class="language-javascript">// 読みやすい文字列作成
const name = '田中太郎';
const age = 25;
const city = '東京';

const message = `こんにちは、${name}さん。
あなたは${age}歳で、
${city}在住ですね。`;

// HTML生成も簡潔
const html = `
<div class="user-card">
    <h3>${name}</h3>
    <p>年齢: ${age}</p>
    <p>居住地: ${city}</p>
</div>`;</code></pre>
                    </div>
                </div>

                <h4 class="text-lg font-semibold text-gray-800 mb-3 mt-6">式の埋め込みと関数呼び出し</h4>
                <pre class="bg-gray-900 text-green-400 p-4 rounded-lg"><code class="language-javascript">// 計算式も埋め込める
const price = 1000;
const tax = 0.1;
const message = `税込価格は${price * (1 + tax)}円です`;

// 関数の結果も埋め込める
function formatDate(date) {
    return date.toLocaleDateString('ja-JP');
}

const today = new Date();
const report = `今日は${formatDate(today)}です。
気温は${Math.random() * 10 + 20}度です。`;

// 条件分岐も可能
const user = { name: '田中', isAdmin: true };
const greeting = `こんにちは、${user.name}さん。
あなたは${user.isAdmin ? '管理者' : '一般ユーザー'}です。`;</code></pre>
            </div>

            <!-- モジュールシステム -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold text-green-800 mb-4">
                    <i class="fas fa-cubes text-green-600 mr-2"></i>
                    モジュールシステム：import/exportによるコード分割
                </h3>
                
                <div class="bg-green-50 p-4 rounded-lg mb-4">
                    <p class="text-green-800 mb-2">
                        <strong>モジュールとは？</strong> 機能ごとにコードを分割し、必要な部分だけを他のファイルで使える仕組みです。
                        大きなアプリケーションを小さな部品に分けることで、保守性と再利用性が大幅に向上します。
                    </p>
                </div>

                <h4 class="text-lg font-semibold text-gray-800 mb-3">基本的なexport/import</h4>
                
                <div class="bg-blue-100 p-4 rounded-lg mb-4">
                    <h5 class="font-semibold text-blue-800 mb-2">📄 math.js（数学関数モジュール）</h5>
                    <pre><code class="language-javascript">// 名前付きエクスポート
export function add(a, b) {
    return a + b;
}

export function multiply(a, b) {
    return a * b;
}

export const PI = 3.14159;

// デフォルトエクスポート
export default function subtract(a, b) {
    return a - b;
}</code></pre>
                </div>

                <div class="bg-purple-100 p-4 rounded-lg mb-4">
                    <h5 class="font-semibold text-purple-800 mb-2">📄 main.js（メインファイル）</h5>
                    <pre><code class="language-javascript">// 名前付きインポート
import { add, multiply, PI } from './math.js';

// デフォルトインポート
import subtract from './math.js';

// 全体をインポート
import * as MathUtils from './math.js';

// 使用例
console.log(add(5, 3));           // 8
console.log(multiply(4, 7));      // 28
console.log(PI);                  // 3.14159
console.log(subtract(10, 3));     // 7
console.log(MathUtils.add(2, 4)); // 6</code></pre>
                </div>

                <h4 class="text-lg font-semibold text-gray-800 mb-3 mt-6">実践的なモジュール設計例</h4>
                
                <div class="bg-yellow-100 p-4 rounded-lg mb-4">
                    <h5 class="font-semibold text-yellow-800 mb-2">📄 api.js（API通信モジュール）</h5>
                    <pre><code class="language-javascript">// API通信用のユーティリティ
const API_BASE_URL = 'https://api.example.com';

export async function fetchUserData(userId) {
    try {
        const response = await fetch(`${API_BASE_URL}/users/${userId}`);
        if (!response.ok) {
            throw new Error(`HTTP Error: ${response.status}`);
        }
        return await response.json();
    } catch (error) {
        console.error('ユーザーデータの取得に失敗しました:', error);
        throw error;
    }
}

export async function createUser(userData) {
    try {
        const response = await fetch(`${API_BASE_URL}/users`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(userData)
        });
        return await response.json();
    } catch (error) {
        console.error('ユーザー作成に失敗しました:', error);
        throw error;
    }
}</code></pre>
                </div>

                <div class="bg-pink-100 p-4 rounded-lg">
                    <h5 class="font-semibold text-pink-800 mb-2">📄 app.js（アプリケーションメイン）</h5>
                    <pre><code class="language-javascript">import { fetchUserData, createUser } from './api.js';
import { formatDate, formatCurrency } from './utils.js';

// ユーザー表示機能
async function displayUser(userId) {
    try {
        const user = await fetchUserData(userId);
        const userElement = document.getElementById('user-info');
        
        userElement.innerHTML = `
            <h2>${user.name}</h2>
            <p>登録日: ${formatDate(user.createdAt)}</p>
            <p>残高: ${formatCurrency(user.balance)}</p>
        `;
    } catch (error) {
        document.getElementById('error-message').textContent = 
            'ユーザー情報の取得に失敗しました';
    }
}

// アプリケーション初期化
document.addEventListener('DOMContentLoaded', () => {
    displayUser(1);
});</code></pre>
                </div>
            </div>
        </div>

        <!-- 3. 非同期処理の実践マスター -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-clock text-purple-600 mr-3"></i>
                3. 非同期処理の実践マスター
            </h2>

            <!-- Promise -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold text-purple-800 mb-4">
                    <i class="fas fa-handshake text-purple-600 mr-2"></i>
                    Promise：コールバック地獄からの脱却
                </h3>
                
                <div class="bg-purple-50 p-4 rounded-lg mb-4">
                    <p class="text-purple-800 mb-2">
                        <strong>Promiseとは？</strong> 「将来的に値が得られる予定」を表すオブジェクトです。
                        まるで「注文した商品がいつか届く約束」のように、非同期処理の結果を約束として扱います。
                        これにより、従来のコールバック関数の入れ子（コールバック地獄）を解消できます。
                    </p>
                </div>

                <h4 class="text-lg font-semibold text-gray-800 mb-3">コールバック地獄の問題</h4>
                <div class="bg-red-100 p-4 rounded-lg mb-4">
                    <h5 class="font-semibold text-red-800 mb-2">❌ コールバック地獄（読みにくい）</h5>
                    <pre><code class="language-javascript">// 従来のコールバック方式
function fetchUserData(userId, callback) {
    setTimeout(() => {
        const userData = { id: userId, name: '田中太郎' };
        callback(null, userData);
    }, 1000);
}

// 地獄の始まり...
fetchUserData(1, (error, user) => {
    if (error) {
        console.error(error);
        return;
    }
    
    fetchUserPosts(user.id, (error, posts) => {
        if (error) {
            console.error(error);
            return;
        }
        
        fetchPostComments(posts[0].id, (error, comments) => {
            if (error) {
                console.error(error);
                return;
            }
            
            // さらに深くなる...
            console.log(comments);
        });
    });
});</code></pre>
                </div>

                <div class="bg-green-100 p-4 rounded-lg mb-4">
                    <h5 class="font-semibold text-green-800 mb-2">✅ Promiseによる解決</h5>
                    <pre><code class="language-javascript">// Promise版の関数
function fetchUserData(userId) {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            const userData = { id: userId, name: '田中太郎' };
            resolve(userData);
        }, 1000);
    });
}

function fetchUserPosts(userId) {
    return new Promise((resolve, reject) => {
        setTimeout(() => {
            const posts = [{ id: 1, title: '最初の投稿', userId }];
            resolve(posts);
        }, 800);
    });
}

// Promiseチェーンで読みやすく
fetchUserData(1)
    .then(user => {
        console.log('ユーザー取得:', user);
        return fetchUserPosts(user.id);
    })
    .then(posts => {
        console.log('投稿取得:', posts);
        return fetchPostComments(posts[0].id);
    })
    .then(comments => {
        console.log('コメント取得:', comments);
    })
    .catch(error => {
        console.error('エラーが発生しました:', error);
    });</code></pre>
                </div>
            </div>

            <!-- async/await -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold text-purple-800 mb-4">
                    <i class="fas fa-magic text-purple-600 mr-2"></i>
                    async/await：同期的な書き方で非同期処理
                </h3>
                
                <div class="bg-purple-50 p-4 rounded-lg mb-4">
                    <p class="text-purple-800 mb-2">
                        <strong>async/awaitとは？</strong> Promiseをより直感的に扱える記法です。
                        <code class="bg-purple-200 px-2 py-1 rounded">async</code>で非同期関数を定義し、
                        <code class="bg-purple-200 px-2 py-1 rounded">await</code>でPromiseの完了を待ちます。
                        まるで同期処理を書くような感覚で非同期処理を記述できます。
                    </p>
                </div>

                <h4 class="text-lg font-semibold text-gray-800 mb-3">Promise vs async/await 比較</h4>
                <div class="code-comparison">
                    <div class="bg-blue-100 p-4 rounded-lg">
                        <h5 class="font-semibold text-blue-800 mb-2">Promise チェーン</h5>
                        <pre><code class="language-javascript">function getUserProfile(userId) {
    return fetchUserData(userId)
        .then(user => {
            return fetchUserPosts(user.id)
                .then(posts => {
                    return {
                        user: user,
                        posts: posts,
                        postCount: posts.length
                    };
                });
        })
        .catch(error => {
            console.error('エラー:', error);
            throw error;
        });
}</code></pre>
                    </div>
                    <div class="bg-green-100 p-4 rounded-lg">
                        <h5 class="font-semibold text-green-800 mb-2">async/await</h5>
                        <pre><code class="language-javascript">async function getUserProfile(userId) {
    try {
        const user = await fetchUserData(userId);
        const posts = await fetchUserPosts(user.id);
        
        return {
            user: user,
            posts: posts,
            postCount: posts.length
        };
    } catch (error) {
        console.error('エラー:', error);
        throw error;
    }
}</code></pre>
                    </div>
                </div>

                <h4 class="text-lg font-semibold text-gray-800 mb-3 mt-6">実用的なAPI通信例</h4>
                <pre class="bg-gray-900 text-green-400 p-4 rounded-lg"><code class="language-javascript">// 天気情報取得の実例
async function getWeatherInfo(city) {
    const API_KEY = 'your-api-key';
    const API_URL = `https://api.openweathermap.org/data/2.5/weather`;
    
    try {
        // API呼び出し
        const response = await fetch(`${API_URL}?q=${city}&appid=${API_KEY}&units=metric&lang=ja`);
        
        // エラーチェック
        if (!response.ok) {
            throw new Error(`HTTP Error: ${response.status}`);
        }
        
        // JSON解析
        const weatherData = await response.json();
        
        // データ整形
        return {
            city: weatherData.name,
            temperature: Math.round(weatherData.main.temp),
            description: weatherData.weather[0].description,
            humidity: weatherData.main.humidity,
            icon: weatherData.weather[0].icon
        };
        
    } catch (error) {
        console.error('天気情報の取得に失敗しました:', error);
        
        // ユーザーフレンドリーなエラーメッセージ
        if (error.message.includes('404')) {
            throw new Error('指定された都市が見つかりません');
        } else if (error.message.includes('401')) {
            throw new Error('APIキーが無効です');
        } else {
            throw new Error('天気情報の取得に失敗しました');
        }
    }
}

// 使用例
async function displayWeather() {
    try {
        const weather = await getWeatherInfo('Tokyo');
        
        document.getElementById('weather-info').innerHTML = `
            <h3>${weather.city}の天気</h3>
            <p>気温: ${weather.temperature}°C</p>
            <p>状況: ${weather.description}</p>
            <p>湿度: ${weather.humidity}%</p>
        `;
    } catch (error) {
        document.getElementById('error-message').textContent = error.message;
    }
}</code></pre>

                <h4 class="text-lg font-semibold text-gray-800 mb-3 mt-6">並列処理の活用</h4>
                <pre class="bg-gray-900 text-green-400 p-4 rounded-lg"><code class="language-javascript">// 複数のAPI呼び出しを並列実行
async function getMultipleCityWeather(cities) {
    try {
        // Promise.allで並列実行（高速）
        const weatherPromises = cities.map(city => getWeatherInfo(city));
        const weatherResults = await Promise.all(weatherPromises);
        
        return weatherResults;
    } catch (error) {
        console.error('天気情報の取得でエラーが発生しました:', error);
        throw error;
    }
}

// 順次実行 vs 並列実行の比較
async function compareExecutionMethods() {
    const cities = ['Tokyo', 'Osaka', 'Kyoto'];
    
    console.time('順次実行');
    // 順次実行（遅い）
    const sequentialResults = [];
    for (const city of cities) {
        const weather = await getWeatherInfo(city);
        sequentialResults.push(weather);
    }
    console.timeEnd('順次実行'); // 約3秒
    
    console.time('並列実行');
    // 並列実行（速い）
    const parallelResults = await getMultipleCityWeather(cities);
    console.timeEnd('並列実行'); // 約1秒
}</code></pre>
            </div>
        </div>

        <!-- 4. 実践Web制作プロジェクト -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-project-diagram text-red-600 mr-3"></i>
                4. 実践Web制作プロジェクト
            </h2>

            <!-- 天気予報アプリ -->
            <div class="mb-8">
                <h3 class="text-xl font-semibold text-red-800 mb-4">
                    <i class="fas fa-cloud-sun text-red-600 mr-2"></i>
                    天気予報アプリ：API連携とモダンJS構文の総合活用
                </h3>
                
                <div class="bg-red-50 p-4 rounded-lg mb-4">
                    <p class="text-red-800 mb-2">
                        <strong>プロジェクト概要：</strong> 実際のWeb API（OpenWeatherMap API）を使用して、
                        都市名を入力すると現在の天気情報を表示するWebアプリケーションを作成します。
                        ES6+の機能を活用し、モジュール分割による保守性の高いコードを実装します。
                    </p>
                </div>

                <h4 class="text-lg font-semibold text-gray-800 mb-3">プロジェクト構成</h4>
                <div class="grid md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-blue-100 p-4 rounded-lg">
                        <h5 class="font-semibold text-blue-800 mb-2">📄 index.html</h5>
                        <p class="text-blue-700 text-sm">メインのHTMLファイル</p>
                    </div>
                    <div class="bg-green-100 p-4 rounded-lg">
                        <h5 class="font-semibold text-green-800 mb-2">📄 app.js</h5>
                        <p class="text-green-700 text-sm">アプリケーションのメインロジック</p>
                    </div>
                    <div class="bg-purple-100 p-4 rounded-lg">
                        <h5 class="font-semibold text-purple-800 mb-2">📄 weather-api.js</h5>
                        <p class="text-purple-700 text-sm">API通信専用モジュール</p>
                    </div>
                </div>

                <h4 class="text-lg font-semibold text-gray-800 mb-3">HTMLファイル（index.html）</h4>
                <pre class="bg-gray-900 text-green-400 p-4 rounded-lg mb-4"><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang="ja"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;天気予報アプリ&lt;/title&gt;
    &lt;link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"&gt;
&lt;/head&gt;
&lt;body class="bg-gradient-to-br from-blue-400 to-purple-500 min-h-screen"&gt;
    &lt;div class="container mx-auto px-4 py-8"&gt;
        &lt;div class="max-w-md mx-auto bg-white rounded-lg shadow-lg p-6"&gt;
            &lt;h1 class="text-2xl font-bold text-gray-800 mb-6 text-center"&gt;
                天気予報アプリ
            &lt;/h1&gt;
            
            &lt;div class="mb-4"&gt;
                &lt;input 
                    type="text" 
                    id="city-input" 
                    placeholder="都市名を入力（例：Tokyo）"
                    class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                &gt;
                &lt;button 
                    id="search-btn"
                    class="w-full mt-2 bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition duration-200"
                &gt;
                    天気を調べる
                &lt;/button&gt;
            &lt;/div&gt;
            
            &lt;div id="loading" class="hidden text-center py-4"&gt;
                &lt;div class="animate-pulse text-gray-600"&gt;読み込み中...&lt;/div&gt;
            &lt;/div&gt;
            
            &lt;div id="weather-result" class="hidden"&gt;
                &lt;!-- 天気情報がここに表示される --&gt;
            &lt;/div&gt;
            
            &lt;div id="error-message" class="hidden text-red-600 text-center py-4"&gt;
                &lt;!-- エラーメッセージがここに表示される --&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    
    &lt;script type="module" src="app.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>

                <h4 class="text-lg font-semibold text-gray-800 mb-3">API通信モジュール（weather-api.js）</h4>
                <pre class="bg-gray-900 text-green-400 p-4 rounded-lg mb-4"><code class="language-javascript">// weather-api.js - 天気API通信専用モジュール

const API_KEY = 'your-openweathermap-api-key'; // 実際のAPIキーに置き換え
const API_BASE_URL = 'https://api.openweathermap.org/data/2.5';

/**
 * 都市の天気情報を取得する
 * @param {string} cityName - 都市名
 * @returns {Promise&lt;Object&gt;} 天気情報オブジェクト
 */
export async function fetchWeatherData(cityName) {
    try {
        const url = `${API_BASE_URL}/weather?q=${encodeURIComponent(cityName)}&appid=${API_KEY}&units=metric&lang=ja`;
        
        const response = await fetch(url);
        
        if (!response.ok) {
            // HTTPエラーの詳細処理
            switch (response.status) {
                case 404:
                    throw new Error(`都市「${cityName}」が見つかりません`);
                case 401:
                    throw new Error('APIキーが無効です');
                case 429:
                    throw new Error('API呼び出し回数の上限に達しました');
                default:
                    throw new Error(`API呼び出しエラー: ${response.status}`);
            }
        }
        
        const data = await response.json();
        return transformWeatherData(data);
        
    } catch (error) {
        // ネットワークエラーなど
        if (error.name === 'TypeError') {
            throw new Error('ネットワーク接続を確認してください');
        }
        throw error;
    }
}

/**
 * APIレスポンスを使いやすい形式に変換
 * @param {Object} rawData - APIの生データ
 * @returns {Object} 整形された天気データ
 */
function transformWeatherData(rawData) {
    return {
        city: rawData.name,
        country: rawData.sys.country,
        temperature: Math.round(rawData.main.temp),
        feelsLike: Math.round(rawData.main.feels_like),
        description: rawData.weather[0].description,
        icon: rawData.weather[0].icon,
        humidity: rawData.main.humidity,
        pressure: rawData.main.pressure,
        windSpeed: rawData.wind.speed,
        sunrise: new Date(rawData.sys.sunrise * 1000),
        sunset: new Date(rawData.sys.sunset * 1000)
    };
}

/**
 * 天気アイコンのURLを生成
 * @param {string} iconCode - アイコンコード
 * @returns {string} アイコンURL
 */
export function getWeatherIconUrl(iconCode) {
    return `https://openweathermap.org/img/wn/${iconCode}@2x.png`;
}</code></pre>

                <h4 class="text-lg font-semibold text-gray-800 mb-3">メインアプリケーション（app.js）</h4>
                <pre class="bg-gray-900 text-green-400 p-4 rounded-lg"><code class="language-javascript">// app.js - メインアプリケーションロジック

import { fetchWeatherData, getWeatherIconUrl } from './weather-api.js';

// DOM要素の取得（分割代入を活用）
const {
    cityInput,
    searchBtn,
    loadingDiv,
    weatherResult,
    errorMessage
} = {
    cityInput: document.getElementById('city-input'),
    searchBtn: document.getElementById('search-btn'),
    loadingDiv: document.getElementById('loading'),
    weatherResult: document.getElementById('weather-result'),
    errorMessage: document.getElementById('error-message')
};

/**
 * UI状態管理クラス
 */
class UIManager {
    static showLoading() {
        loadingDiv.classList.remove('hidden');
        weatherResult.classList.add('hidden');
        errorMessage.classList.add('hidden');
    }
    
    static hideLoading() {
        loadingDiv.classList.add('hidden');
    }
    
    static showError(message) {
        errorMessage.textContent = message;
        errorMessage.classList.remove('hidden');
        weatherResult.classList.add('hidden');
    }
    
    static showWeather(data) {
        weatherResult.innerHTML = this.createWeatherHTML(data);
        weatherResult.classList.remove('hidden');
        errorMessage.classList.add('hidden');
    }
    
    // テンプレートリテラルで見やすいHTML生成
    static createWeatherHTML(weather) {
        return `
            &lt;div class="text-center"&gt;
                &lt;h2 class="text-xl font-bold text-gray-800 mb-2"&gt;
                    ${weather.city}, ${weather.country}
                &lt;/h2&gt;
                
                &lt;div class="flex items-center justify-center mb-4"&gt;
                    &lt;img 
                        src="${getWeatherIconUrl(weather.icon)}" 
                        alt="${weather.description}"
                        class="w-16 h-16"
                    &gt;
                    &lt;div class="ml-4"&gt;
                        &lt;div class="text-3xl font-bold text-gray-800"&gt;
                            ${weather.temperature}°C
                        &lt;/div&gt;
                        &lt;div class="text-gray-600"&gt;
                            体感 ${weather.feelsLike}°C
                        &lt;/div&gt;
                    &lt;/div&gt;
                &lt;/div&gt;
                
                &lt;p class="text-gray-700 mb-4 capitalize"&gt;
                    ${weather.description}
                &lt;/p&gt;
                
                &lt;div class="grid grid-cols-2 gap-4 text-sm text-gray-600"&gt;
                    &lt;div&gt;湿度: ${weather.humidity}%&lt;/div&gt;
                    &lt;div&gt;気圧: ${weather.pressure}hPa&lt;/div&gt;
                    &lt;div&gt;風速: ${weather.windSpeed}m/s&lt;/div&gt;
                    &lt;div&gt;日の出: ${weather.sunrise.toLocaleTimeString('ja-JP', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    })}&lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        `;
    }
}

/**
 * 天気検索の実行
 */
async function searchWeather() {
    const cityName = cityInput.value.trim();
    
    // 入力値検証
    if (!cityName) {
        UIManager.showError('都市名を入力してください');
        return;
    }
    
    try {
        UIManager.showLoading();
        
        // 天気データ取得
        const weatherData = await fetchWeatherData(cityName);
        
        // 成功時の表示
        UIManager.showWeather(weatherData);
        
        // 入力値をクリア
        cityInput.value = '';
        
    } catch (error) {
        console.error('天気検索エラー:', error);
        UIManager.showError(error.message);
    } finally {
        UIManager.hideLoading();
    }
}

// イベントリスナーの設定
function initializeApp() {
    // ボタンクリック時
    searchBtn.addEventListener('click', searchWeather);
    
    // Enter キー押下時
    cityInput.addEventListener('keypress', (event) => {
        if (event.key === 'Enter') {
            searchWeather();
        }
    });
    
    // 初期フォーカス
    cityInput.focus();
}

// アプリケーション初期化
document.addEventListener('DOMContentLoaded', initializeApp);</code></pre>

                <div class="bg-green-50 border-l-4 border-green-500 p-4 mt-6">
                    <h5 class="font-semibold text-green-800 mb-2">✅ このプロジェクトで学べるポイント</h5>
                    <ul class="text-green-700 space-y-1">
                        <li>• <strong>モジュール分割：</strong>API通信とUI制御を分離した保守性の高い設計</li>
                        <li>• <strong>async/await：</strong>読みやすい非同期処理の実装</li>
                        <li>• <strong>エラーハンドリング：</strong>様々なエラーケースへの対応</li>
                        <li>• <strong>テンプレートリテラル：</strong>複雑なHTMLの動的生成</li>
                        <li>• <strong>クラス設計：</strong>UIManagerクラスによる状態管理</li>
                        <li>• <strong>分割代入：</strong>DOM要素取得の効率化</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 5. 演習問題 -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-pencil-alt text-indigo-600 mr-3"></i>
                演習問題
            </h2>

            <!-- 演習問題1 -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-indigo-800 mb-3">演習1: ES6+構文の活用</h3>
                <div class="bg-indigo-50 p-4 rounded-lg mb-4">
                    <p class="text-indigo-800 mb-3">
                        以下のES5コードをES6+の機能（アロー関数、分割代入、テンプレートリテラル）を使って書き換えてください。
                    </p>
                    <pre class="bg-gray-800 text-green-300 p-3 rounded"><code class="language-javascript">// ES5コード
var users = [
    { name: '田中', age: 25, city: '東京' },
    { name: '佐藤', age: 30, city: '大阪' },
    { name: '山田', age: 28, city: '福岡' }
];

function createUserCard(user) {
    var name = user.name;
    var age = user.age;
    var city = user.city;
    
    return '<div class="user-card">' +
           '<h3>' + name + '</h3>' +
           '<p>年齢: ' + age + '</p>' +
           '<p>居住地: ' + city + '</p>' +
           '</div>';
}

var userCards = users.map(function(user) {
    return createUserCard(user);
});</code></pre>
                </div>
                
                <button onclick="toggleAnswer('answer1')" class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600 transition duration-200">
                    回答例を表示
                </button>
                
                <div sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" id="answer1" class="hidden-content mt-4">
                    <div class="bg-green-100 p-4 rounded-lg">
                        <h4 class="font-semibold text-green-800 mb-2">回答例（ES6+版）</h4>
                        <pre class="bg-gray-800 text-green-300 p-3 rounded"><code class="language-javascript">// ES6+コード
const users = [
    { name: '田中', age: 25, city: '東京' },
    { name: '佐藤', age: 30, city: '大阪' },
    { name: '山田', age: 28, city: '福岡' }
];

// 分割代入とテンプレートリテラルを活用
const createUserCard = ({ name, age, city }) => `
    &lt;div class="user-card"&gt;
        &lt;h3&gt;${name}&lt;/h3&gt;
        &lt;p&gt;年齢: ${age}&lt;/p&gt;
        &lt;p&gt;居住地: ${city}&lt;/p&gt;
    &lt;/div&gt;
`;

// アロー関数で簡潔に
const userCards = users.map(user => createUserCard(user));

// さらに簡潔に
const userCards2 = users.map(createUserCard);</code></pre>
                        
                        <div class="mt-3 text-green-700">
                            <p><strong>改善ポイント：</strong></p>
                            <ul class="list-disc ml-5 space-y-1">
                                <li>アロー関数により関数定義が簡潔になった</li>
                                <li>分割代入でプロパティ取得が一行で完了</li>
                                <li>テンプレートリテラルで文字列結合が読みやすくなった</li>
                                <li>全体的にコード量が削減され、可読性が向上</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 演習問題2 -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-indigo-800 mb-3">演習2: 非同期処理の実装</h3>
                <div class="bg-indigo-50 p-4 rounded-lg mb-4">
                    <p class="text-indigo-800 mb-3">
                        複数のAPIから並列してデータを取得し、すべての結果を統合して表示する関数を作成してください。
                        エラーハンドリングも含めて実装してください。
                    </p>
                    <pre class="bg-gray-800 text-green-300 p-3 rounded"><code class="language-javascript">// 要件：
// 1. 複数の都市の天気を並列取得
// 2. すべての結果を統合してオブジェクトで返す
// 3. エラーが発生した場合は適切に処理
// 4. async/awaitを使用

const cities = ['Tokyo', 'Osaka', 'Kyoto'];
// この配列の都市の天気をすべて取得する関数を作成</code></pre>
                </div>
                
                <button onclick="toggleAnswer('answer2')" class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600 transition duration-200">
                    回答例を表示
                </button>
                
                <div sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" id="answer2" class="hidden-content mt-4">
                    <div class="bg-green-100 p-4 rounded-lg">
                        <h4 class="font-semibold text-green-800 mb-2">回答例</h4>
                        <pre class="bg-gray-800 text-green-300 p-3 rounded"><code class="language-javascript">// 複数都市の天気を並列取得する関数
async function getMultipleCityWeather(cities) {
    try {
        console.log('天気データ取得開始...');
        
        // Promise.allで並列実行
        const weatherPromises = cities.map(async (city) => {
            try {
                const weather = await fetchWeatherData(city);
                return { city, weather, success: true };
            } catch (error) {
                console.warn(`${city}の天気取得に失敗:`, error.message);
                return { city, error: error.message, success: false };
            }
        });
        
        const results = await Promise.all(weatherPromises);
        
        // 成功・失敗を分類
        const successful = results.filter(result => result.success);
        const failed = results.filter(result => !result.success);
        
        return {
            totalCities: cities.length,
            successCount: successful.length,
            failedCount: failed.length,
            successful: successful.map(r => r.weather),
            failed: failed.map(r => ({ city: r.city, error: r.error })),
            summary: `${successful.length}/${cities.length} の都市の天気を取得しました`
        };
        
    } catch (error) {
        console.error('天気データ取得で予期しないエラー:', error);
        throw new Error('天気データの取得に失敗しました');
    }
}

// 使用例
async function displayMultipleCityWeather() {
    const cities = ['Tokyo', 'Osaka', 'Kyoto', 'InvalidCity'];
    
    try {
        const results = await getMultipleCityWeather(cities);
        
        console.log(results.summary);
        console.log('成功:', results.successful);
        console.log('失敗:', results.failed);
        
        // HTML表示
        const weatherContainer = document.getElementById('weather-container');
        weatherContainer.innerHTML = `
            &lt;h3&gt;${results.summary}&lt;/h3&gt;
            ${results.successful.map(weather => `
                &lt;div class="weather-card"&gt;
                    &lt;h4&gt;${weather.city}&lt;/h4&gt;
                    &lt;p&gt;${weather.temperature}°C - ${weather.description}&lt;/p&gt;
                &lt;/div&gt;
            `).join('')}
        `;
        
    } catch (error) {
        console.error('エラー:', error.message);
    }
}</code></pre>
                        
                        <div class="mt-3 text-green-700">
                            <p><strong>学習ポイント：</strong></p>
                            <ul class="list-disc ml-5 space-y-1">
                                <li>Promise.allによる並列処理で実行時間を短縮</li>
                                <li>各API呼び出しを独立してエラーハンドリング</li>
                                <li>成功・失敗の結果を分類して返す</li>
                                <li>部分的な失敗を許容する設計</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 6. 理解度クイズ -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-question-circle text-pink-600 mr-3"></i>
                理解度クイズ
            </h2>

            <!-- クイズ1 -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-pink-800 mb-3">クイズ1: アロー関数のthis</h3>
                <div class="bg-pink-50 p-4 rounded-lg mb-4">
                    <p class="text-pink-800 mb-3">次のコードの実行結果は何でしょうか？</p>
                    <pre class="bg-gray-800 text-green-300 p-3 rounded mb-3"><code class="language-javascript">const obj = {
    name: 'JavaScript',
    regularFunction: function() {
        console.log('Regular:', this.name);
    },
    arrowFunction: () => {
        console.log('Arrow:', this.name);
    }
};

obj.regularFunction();
obj.arrowFunction();</code></pre>
                    
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="radio" name="quiz1" value="a" class="mr-2">
                            <span>A) Regular: JavaScript, Arrow: JavaScript</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="quiz1" value="b" class="mr-2">
                            <span>B) Regular: JavaScript, Arrow: undefined</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="quiz1" value="c" class="mr-2">
                            <span>C) Regular: undefined, Arrow: JavaScript</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="quiz1" value="d" class="mr-2">
                            <span>D) 両方ともエラーになる</span>
                        </label>
                    </div>
                </div>
                
                <button sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" onclick="showAnswer('quiz1', 'b')" class="bg-pink-500 text-white px-4 py-2 rounded hover:bg-pink-600 transition duration-200">
                    回答を表示
                </button>
                
                <div sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" id="quiz1-answer" class="hidden-content mt-4">
                    <div class="bg-green-100 p-4 rounded-lg">
                        <h4 class="font-semibold text-green-800 mb-2">正解: B) Regular: JavaScript, Arrow: undefined</h4>
                        <div class="text-green-700">
                            <p class="mb-2"><strong>解説：</strong></p>
                            <ul class="list-disc ml-5 space-y-1">
                                <li><strong>通常の関数：</strong> thisは呼び出し元のオブジェクト（obj）を指すため、this.nameは'JavaScript'</li>
                                <li><strong>アロー関数：</strong> thisは定義時のスコープを継承するため、グローバルオブジェクトを指し、this.nameはundefined</li>
                                <li>これがアロー関数をオブジェクトのメソッドに使うべきでない理由です</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- クイズ2 -->
            <div class="mb-6">
                <h3 class="text-lg font-semibold text-pink-800 mb-3">クイズ2: 非同期処理の順序</h3>
                <div class="bg-pink-50 p-4 rounded-lg mb-4">
                    <p class="text-pink-800 mb-3">次のコードの出力順序は？</p>
                    <pre class="bg-gray-800 text-green-300 p-3 rounded mb-3"><code class="language-javascript">console.log('1');

setTimeout(() => {
    console.log('2');
}, 0);

Promise.resolve().then(() => {
    console.log('3');
});

console.log('4');</code></pre>
                    
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="radio" name="quiz2" value="a" class="mr-2">
                            <span>A) 1, 2, 3, 4</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="quiz2" value="b" class="mr-2">
                            <span>B) 1, 4, 2, 3</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="quiz2" value="c" class="mr-2">
                            <span>C) 1, 4, 3, 2</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="quiz2" value="d" class="mr-2">
                            <span>D) 1, 3, 4, 2</span>
                        </label>
                    </div>
                </div>
                
                <button sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" onclick="showAnswer('quiz2', 'c')" class="bg-pink-500 text-white px-4 py-2 rounded hover:bg-pink-600 transition duration-200">
                    回答を表示
                </button>
                
                <div sec:authorize="hasAnyRole('ADMIN','INSTRUCTOR')" id="quiz2-answer" class="hidden-content mt-4">
                    <div class="bg-green-100 p-4 rounded-lg">
                        <h4 class="font-semibold text-green-800 mb-2">正解: C) 1, 4, 3, 2</h4>
                        <div class="text-green-700">
                            <p class="mb-2"><strong>解説：</strong></p>
                            <ul class="list-disc ml-5 space-y-1">
                                <li><strong>1, 4：</strong> 同期処理のため即座に実行</li>
                                <li><strong>3：</strong> Promise（マイクロタスク）は次のイベントループで最優先実行</li>
                                <li><strong>2：</strong> setTimeout（マクロタスク）は一周遅れて実行</li>
                                <li>JavaScript のイベントループでは、マイクロタスクがマクロタスクより優先されます</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 7. まとめ -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                <i class="fas fa-clipboard-check text-teal-600 mr-3"></i>
                まとめ
            </h2>

            <div class="grid md:grid-cols-2 gap-6">
                <div class="space-y-4">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold text-blue-800 mb-2">
                            <i class="fas fa-magic mr-2"></i>ES6+構文の習得効果
                        </h3>
                        <ul class="text-blue-700 space-y-1">
                            <li>• <strong>コード量削減：</strong>アロー関数で関数定義が50%短縮</li>
                            <li>• <strong>可読性向上：</strong>テンプレートリテラルで複雑な文字列も直感的</li>
                            <li>• <strong>バグ減少：</strong>分割代入で変数取得ミスを防止</li>
                            <li>• <strong>保守性向上：</strong>モジュール分割で機能の独立性確保</li>
                        </ul>
                    </div>

                    <div class="bg-purple-50 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold text-purple-800 mb-2">
                            <i class="fas fa-clock mr-2"></i>非同期処理の実用性
                        </h3>
                        <ul class="text-purple-700 space-y-1">
                            <li>• <strong>Promise：</strong>コールバック地獄から解放</li>
                            <li>• <strong>async/await：</strong>同期的記述で非同期処理を直感化</li>
                            <li>• <strong>並列処理：</strong>Promise.allで処理時間を最大70%短縮</li>
                            <li>• <strong>エラー制御：</strong>try-catchで統一的な例外処理</li>
                        </ul>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold text-green-800 mb-2">
                            <i class="fas fa-project-diagram mr-2"></i>実践プロジェクトで身につくスキル
                        </h3>
                        <ul class="text-green-700 space-y-1">
                            <li>• <strong>API連携：</strong>実際のWebサービスとの通信技術</li>
                            <li>• <strong>エラーハンドリング：</strong>ユーザーフレンドリーなエラー対応</li>
                            <li>• <strong>モジュール設計：</strong>スケーラブルなアーキテクチャ構築</li>
                            <li>• <strong>UI/UX：</strong>レスポンシブで使いやすいインターフェース</li>
                        </ul>
                    </div>

                    <div class="bg-red-50 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold text-red-800 mb-2">
                            <i class="fas fa-arrow-right mr-2"></i>次のステップ
                        </h3>
                        <ul class="text-red-700 space-y-1">
                            <li>• より複雑なAPI連携（認証・ページネーション）</li>
                            <li>• フレームワーク学習（React、Vue.js）への準備完了</li>
                            <li>• TypeScriptでの型安全なコード作成</li>
                            <li>• テストコード記述によるコード品質向上</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="mt-6 bg-yellow-50 border-l-4 border-yellow-500 p-4">
                <h3 class="text-lg font-semibold text-yellow-800 mb-2">
                    <i class="fas fa-lightbulb mr-2"></i>実務での活用ポイント
                </h3>
                <p class="text-yellow-700">
                    本日学習したモダンJavaScript技術は、現代のWeb開発の基盤となる重要なスキルです。
                    特にasync/awaitによる非同期処理とモジュール分割による設計は、
                    大規模開発プロジェクトでの生産性と保守性を大幅に向上させます。
                    継続的に実践を重ね、より複雑なアプリケーション開発にチャレンジしていきましょう。
                </p>
            </div>
        </div>

        <!-- フッター -->
        <div class="text-center mt-8 text-gray-600">
            <p>© 2025 APSA Co.,Ltd. All Rights Reserved.</p>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // 回答表示/非表示の切り替え
        function toggleAnswer(answerId) {
            const element = document.getElementById(answerId);
            if (element.classList.contains('hidden-content')) {
                element.classList.remove('hidden-content');
                element.classList.add('show-content');
            } else {
                element.classList.add('hidden-content');
                element.classList.remove('show-content');
            }
        }

        // クイズの回答表示
        function showAnswer(quizId, correctAnswer) {
            const answerElement = document.getElementById(quizId + '-answer');
            answerElement.classList.remove('hidden-content');
            answerElement.classList.add('show-content');
            
            // 選択された答えをチェック
            const radios = document.querySelectorAll(`input[name="${quizId}"]`);
            let selectedAnswer = null;
            
            radios.forEach(radio => {
                if (radio.checked) {
                    selectedAnswer = radio.value;
                }
            });
            
            // 結果表示
            if (selectedAnswer === correctAnswer) {
                answerElement.querySelector('.bg-green-100').classList.add('border-green-500', 'border-2');
            }
        }

        // ページロード時の初期化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Day41 モダンJavaScript講義ページが読み込まれました');
            
            // すべての隠されたコンテンツを初期化
            const hiddenElements = document.querySelectorAll('.hidden-content');
            hiddenElements.forEach(element => {
                element.style.display = 'none';
            });
        });

        // 表示切り替えのCSS制御
        document.addEventListener('DOMContentLoaded', function() {
            const style = document.createElement('style');
            style.textContent = `
                .hidden-content {
                    display: none;
                }
                .show-content {
                    display: block;
                    animation: fadeIn 0.3s ease-in-out;
                }
                @keyframes fadeIn {
                    from { opacity: 0; transform: translateY(-10px); }
                    to { opacity: 1; transform: translateY(0); }
                }
            `;
            document.head.appendChild(style);
        });
    </script>
    </div>
    </main>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDh2zw12V6h%2F3AnSJcJmL4pgolyNRvlgHOauqvav3VndUs1e5U0ScI24dNvAKWk%2B5d4E1Q6EN6E9DKnl7jp9btUChgiLN8d1M4ZvuVtaVMzrVQNL7%2FBeRvieZ2jtx0LjodFbOzPoTJddRPoNg%2BlLSiUEyxhAS36%2BAh4XFod0qTjLfhCekBFEu2cgdWeO%2B3R1dgEkdpaTb1sXlGKvcUlRWeCw3vZgVCSklgNi3%2BxAXn9xAUV2g%2FBnIDPmtZsBiNhFTdJj%2BW8JokswWWPBOshuHThXdhuwL9TTR0Gn7tgW23dW0m6fPimt%2FiUICJbqgyXg2Kinkga1TAX4EQlekjs7lGDlhqwVkIPsVpCNyiBAGt3IwnOxQu1kFFw6wj3O4QHYLDmg1KwMbl0M%2B%2F%2BFDmPjc8tx37PQuh0LV8o8x8530IGQf6%2BdwqboE8uiAAGJzeaO%2FHP%2FQ0kGqLSsGa1yLwj1QYHLzhiAViGy5ZOgJrbZRlba94%2FcRPzO9xy%2FqrsN%2FXXrudg%3D%3D";
        window.__genspark_locale = "ja-JP";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDh2zw12V6h/3AnSJcJmL4pgolyNRvlgHOauqvav3VndUs1e5U0ScI24dNvAKWk+5d4E1Q6EN6E9DKnl7jp9btUChgiLN8d1M4ZvuVtaVMzrVQNL7/BeRvieZ2jtx0LjodFbOzPoTJddRPoNg+lLSiUEyxhAS36+Ah4XFod0qTjLfhCekBFEu2cgdWeO+3R1dgEkdpaTb1sXlGKvcUlRWeCw3vZgVCSklgNi3+xAXn9xAUV2g/BnIDPmtZsBiNhFTdJj+W8JokswWWPBOshuHThXdhuwL9TTR0Gn7tgW23dW0m6fPimt/iUICJbqgyXg2Kinkga1TAX4EQlekjs7lGDlhqwVkIPsVpCNyiBAGt3IwnOxQu1kFFw6wj3O4QHYLDmg1KwMbl0M+/+FDmPjc8tx37PQuh0LV8o8x8530IGQf6+dwqboE8uiAAGJzeaO/HP/Q0kGqLSsGa1yLwj1QYHLzhiAViGy5ZOgJrbZRlba94/cRPzO9xy/qrsN/XXrudg==";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    